<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>塔羅生命靈數與兼容性計算器</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        body {
            background-color: #f3e8ff; /* Light purple background for the whole page */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, Fragment } = React;

        // --- SHARED ICON COMPONENTS ---
        const Calendar = () => <span>📅</span>;
        const Sparkles = ({ className }) => <span className={className}>✨</span>;
        const Hash = ({ className }) => <span className={className}>#</span>;
        const User = ({ className }) => <span className={className}>👤</span>;
        const BookOpen = () => <span>📖</span>;
        const ChevronDown = ({ className }) => <span className={className}>▼</span>;
        const ChevronUp = ({ className }) => <span className={className}>▲</span>;
        const Gift = ({ className }) => <span className={className}>🎁</span>;
        const Shield = ({ className }) => <span className={className}>🛡️</span>;
        // Icons for Compatibility Calculator
        const HeartIcon = ({ className }) => <span className={className}>💖</span>;
        const UsersIcon = ({ className }) => <span className={className}>👥</span>;
        const MoonIcon = ({ className }) => <span className={className}>🌙</span>;
        const StarIcon = ({ className }) => <span className={className}>⭐</span>;
        const AlertCircleIcon = ({ className }) => <span className={className}>⚠️</span>;
        const InfoIcon = ({ className }) => <span className={className}>ℹ️</span>;

        // --- SHARED CARD DETAILS ---
        const cardDetails = {
          0: {
            name: '愚者',
            shortMeaning: '純真、勇氣、無限可能',
            soulMission: '0號愚者作為靈魂卡牌時，靈魂使命是學習無條件的信任與勇氣，擁抱未知的人生旅程。內在潛能包括純真的智慧和與宇宙直接連結的能力。',
            personalityTrait: '作為個性卡牌時，表現為樂觀充滿活力的外在特質，傾向於衝動決策和勇於嘗試新事物。心理層面代表原始自我和無意識智慧，潛能是無限的可能性和創新思維，挑戰則是魯莽行為和缺乏方向感。'
          },
          1: {
            name: '魔術師',
            shortMeaning: '創造力、意志力、新開始',
            soulMission: '1號魔術師的靈魂使命是學習如何將靈性能量轉化為物質現實，成為天地之間的橋樑。需要發展專注力、創造力和整合不同元素的智慧。',
            personalityTrait: '作為個性卡牌時展現自信魅力、目標導向的特質，善於規劃執行和溝通說服。魔術師象徵意識的力量和自我實現能力，潛能包括創造顯化和多元才能，但需警惕操控傾向和自我膨脹。'
          },
          2: {
            name: '女祭司',
            shortMeaning: '直覺、潛意識、神秘智慧',
            soulMission: '2號女祭司的靈魂使命是發展直覺智慧，成為內在與外在世界的守護者。靈性潛能包括深度直覺和接收宇宙訊息的能力。',
            personalityTrait: '個性層面表現為神秘內斂、具有深度的特質，傾向於觀察反思和深層次交流。女祭司代表潛意識智慧和陰性原則，擁有靈性洞察的潛能，但可能過度內向或與現實脫節。'
          },
          3: {
            name: '女帝',
            shortMeaning: '豐饒、母性、創造與成長',
            soulMission: '3號女帝學習無條件的愛與創造，成為生命力的源泉。內在潛能是豐盛創造力和與自然的深度連結。',
            personalityTrait: '外在表現為溫暖關愛、富有創造力的照顧者特質。女帝象徵創造力和無條件的愛，能創造豐盛和滋養他人，挑戰是過度保護和缺乏邊界。'
          },
          4: {
            name: '皇帝',
            shortMeaning: '權威、結構、穩定基礎',
            soulMission: '4號皇帝的靈魂使命是學習建立穩定的結構，成為智慧的領導者。需要發展責任感、公正和領導智慧。',
            personalityTrait: '個性表現為權威實際、有組織的領導者特質，重視秩序效率和目標達成。皇帝代表建設性的男性力量，潛能是領導能力和建立秩序，需注意過度控制和缺乏彈性。'
          },
          5: {
            name: '教皇',
            shortMeaning: '精神指引、傳統、教育',
            soulMission: '5號教皇成為智慧的傳承者，建立精神與物質的橋樑。靈性潛能包括教導能力和傳統智慧。',
            personalityTrait: '個性特質是傳統有原則、具有教導傾向，重視道德規範和深度交流。教皇代表集體無意識和傳統智慧，能進行智慧傳承和精神指導，但可能過度保守或權威主義。'
          },
          6: {
            name: '戀人',
            shortMeaning: '愛情、選擇、和諧關係',
            soulMission: '6號戀人學習愛的真諦，在關係中找到整合與平衡。需要發展愛、選擇的智慧和整合能力。',
            personalityTrait: '外在表現為魅力善交際、重視關係的特質。戀人代表整合過程和愛的力量，潛能是和諧關係和美學天賦，挑戰是猶豫不決和依賴他人。'
          },
          7: {
            name: '戰車',
            shortMeaning: '決心、勝利、掌控方向',
            soulMission: '7號戰車學習掌控內在力量，朝向目標勇敢前進。靈魂潛能是意志力和整合對立力量的能力。',
            personalityTrait: '個性表現為決心堅定、目標導向的競爭者。戰車代表自我控制和意志的勝利，擁有強大意志力和目標達成能力，但可能過度競爭或固執己見。'
          },
          8: {
            name: '力量',
            shortMeaning: '內在力量、勇氣、耐心',
            soulMission: '8號力量學習內在真正的力量，以愛征服恐懼。靈性潛能包括內在勇氣和治療能力。',
            personalityTrait: '個性表現為溫和而堅定、有耐心的治療性存在。力量代表內在的勇氣和愛的力量，能以溫柔的力量面對挑戰，需避免過度犧牲和壓抑情感。'
          },
          9: {
            name: '隱士',
            shortMeaning: '內省、尋求真理、智慧',
            soulMission: '9號隱者通過內在探索獲得智慧，成為他人的指路明燈。需要發展孤獨中的智慧和靈性指導能力。',
            personalityTrait: '外在表現為內省智慧、喜歡獨處的深度思考者。隱者象徵通過孤獨獲得的深度洞察，擁有深度智慧和指導能力，但可能過度孤立或悲觀。'
          },
          10: {
            name: '命運之輪',
            shortMeaning: '命運轉變、機會、週期',
            soulMission: '10號命運之輪學習接受生命的循環和變化，在變化中找到機會。靈魂潛能是適應變化和理解生命循環的智慧。',
            personalityTrait: '個性特質是樂觀適應力強、相信運氣。命運之輪代表生命的循環和宇宙法則，能把握機會和適應變化，挑戰是過度依賴運氣和缺乏穩定性。'
          },
          11: {
            name: '正義',
            shortMeaning: '公正、平衡、因果法則',
            soulMission: '11號正義的靈魂驅動力是追求真理與平衡，生命目標是達到內外的完美平衡。',
            personalityTrait: '作為個性卡牌時展現強烈的公平正義感、邏輯清晰的特質。早期可能過度追求完美，成熟期成為他人的道德指南針。挑戰是過度嚴厲的內在批評。'
          },
          12: {
            name: '倒吊人',
            shortMeaning: '犧牲、新視角、等待',
            soulMission: '12號倒吊人的靈魂渴望通過犧牲獲得更高理解，目標是達到完全的放下和接納。',
            personalityTrait: '個性特徵是深具耐心、善於反思，能從逆境中成長。早期可能感到格格不入，成熟後成為精神導師。需克服過度拖延和受害者心態。'
          },
          13: {
            name: '死神',
            shortMeaning: '結束與新生、轉變、重生',
            soulMission: '13號死神理解生死輪回的奧秘，協助他人完成重要的生命轉換。',
            personalityTrait: '個性表現為深具洞察力、不懼怕改變的轉化者。經常成為他人生命中的轉折點觸發者。早期可能經歷較多分離，成熟後成為生命轉化的引導者。'
          },
          14: {
            name: '節制',
            shortMeaning: '平衡、調和、中庸之道',
            soulMission: '14號節制尋求完美的平衡和和諧，整合對立的力量。',
            personalityTrait: '外在表現為調和能力強的天生外交家，善於促進群體和諧。需要學會在極端之間找到平衡點，避免過度妥協。'
          },
          15: {
            name: '惡魔',
            shortMeaning: '慾望、束縛、物質主義',
            soulMission: '15號惡魔的靈魂課題是理解和整合陰影面，將本能慾望轉化為創造力。',
            personalityTrait: '個性特徵是充滿激情活力、直接坦率。早期可能過度放縱或壓抑，成熟後能將激情轉化為創造力。需警惕成癮傾向。'
          },
          16: {
            name: '塔',
            shortMeaning: '突變、覺醒、解放',
            soulMission: '16號高塔的使命是破除虛假結構，重建更真實的基礎。',
            personalityTrait: '表現為強大意志力的天生變革者，經常帶來意想不到的改變。早期可能經歷較多意外，成熟後成為他人生命中的轉機製造者。'
          },
          17: {
            name: '星星',
            shortMeaning: '希望、靈感、精神指引',
            soulMission: '17號星星成為他人的希望之光，傳播治癒和靈感。',
            personalityTrait: '個性特質是樂觀希望、具有治癒天賦。靈性成長方向是發展直覺和治癒能力，成為光的工作者。早期可能過於理想化，成熟後成為靈感源泉。'
          },
          18: {
            name: '月亮',
            shortMeaning: '幻象、直覺、潛意識',
            soulMission: '18號月亮探索潛意識深處的奧秘，成為連接意識與無意識的橋樑。',
            personalityTrait: '個性敏感多情、具有強烈直覺力。需要學會區分幻象與真實，克服內在恐懼。早期容易迷惑情緒不穩，成熟後成為精神嚮導。'
          },
          19: {
            name: '太陽',
            shortMeaning: '快樂、成功、生命力',
            soulMission: '19號太陽散發光明和歡樂，成為純粹的光和愛的化身。',
            personalityTrait: '外在表現為樂觀開朗、充滿活力的領袖氣質。生命課題是學會在困境中保持樂觀。早期可能過於天真，成熟後成為他人的激勵者。'
          },
          20: {
            name: '審判',
            shortMeaning: '覺醒、重生、召喚',
            soulMission: '20號審判協助他人覺醒和重生，成為覺醒的催化劑。',
            personalityTrait: '個性具有強烈使命感，能感知超自然現象。經常扮演覺醒者和革新者角色。挑戰是過於執著信念。'
          },
          21: {
            name: '世界',
            shortMeaning: '完成、成就、宇宙意識',
            soulMission: '21號世界追求完整和圓滿，達到開悟和宇宙意識。',
            personalityTrait: '表現為具有宇宙觀和包容性的整合者。生命目標是達到無條件的愛和完美平衡。可能過於追求完美。'
          },
        };

        // --- TAROT BIRTH CARDS CALCULATOR (Mary K. Greer System) ---
        const TarotBirthCardsCalculator = () => {
          const [birthDate, setBirthDate] = useState('');
          const [result, setResult] = useState(null);
          const [detailedReport, setDetailedReport] = useState(null);
          const [showProcess, setShowProcess] = useState(false);
          const [showInfo, setShowInfo] = useState(false);
          const [viewMode, setViewMode] = useState('simple');

          // 顯示詳細理論的組件
          const TarotTheoryInfo = () => (
            <div className="mt-8 p-6 bg-white rounded-lg shadow-md space-y-6 text-gray-700 transition-all duration-500 ease-in-out">
              <h2 className="text-2xl font-bold text-purple-800 text-center flex items-center justify-center gap-2">
                <BookOpen /> 塔羅生命靈數系統深度解碼
              </h2>
              
              <section>
                <h3 className="text-xl font-semibold text-purple-700 mb-2">靈魂藍圖與個性表現的深度解碼</h3>
                <p className="text-base leading-relaxed">
                  塔羅牌生命靈數系統揭示了每個人獨特的靈魂藍圖和人生使命，透過出生日期計算得出的大阿爾卡納牌，能深入理解個人的內在本質與外在表現。這套系統不僅是占卜工具，更是一份詳盡的自我成長地圖。每個人都擁有代表靈魂核心的「靈魂卡牌」和展現今生學習課題的「個性卡牌」，這兩張牌的互動關係描繪出個人從出生到死亡的生命主題。
                </p>
              </section>

              <section>
                 <h3 className="text-xl font-semibold text-purple-700 mb-2">理論架構與計算方法</h3>
                 <p className="text-base leading-relaxed mb-2">
                  此計算器採用 Mary K. Greer 的方法：將出生日期的所有數字相加，如果總和大於21，則繼續將結果的數字相加，直到小於或等於21為止。
                 </p>
                 <div className="bg-blue-50 rounded-lg p-4 text-sm text-blue-800">
                      <p className="font-semibold mb-1">計算範例：</p>
                      <ul className="list-disc list-inside space-y-1">
                        <li><b>靈魂卡牌</b>：將出生日期的每個數字相加（例：2000-08-05 → 2+0+0+0+0+8+0+5 = 15）。如果總和大於21（例：1992-02-21 → 26），持續將數字相加直到小於等於21（2+6 = 8）。</li>
                        <li><b>個性卡牌</b>：將靈魂卡牌的數字相加得到個性卡牌（如果靈魂卡牌已是個位數，則兩者相同）。</li>
                        <li><b>特殊組合</b>：當靈魂卡牌是19時，會產生三張牌：19 (太陽), 10 (命運之輪), 1 (魔術師)。</li>
                      </ul>
                  </div>
              </section>

              <section>
                 <h3 className="text-xl font-semibold text-purple-700 mb-2">靈魂卡牌 vs. 個性卡牌</h3>
                 <div className="grid md:grid-cols-2 gap-4">
                      <div className="bg-purple-50 p-3 rounded-lg">
                          <h4 className="font-bold text-purple-800">靈魂卡牌 (Soul Card)</h4>
                          <p className="text-sm">代表個人的<b>靈魂目的</b>和<b>最深層核心</b>，是跨越多個生世的永恆特質。它反映靈魂的根本使命、與生俱來的天賦和能力。</p>
                      </div>
                      <div className="bg-pink-50 p-3 rounded-lg">
                          <h4 className="font-bold text-pink-800">個性卡牌 (Personality Card)</h4>
                          <p className="text-sm">描述個人在<b>此生需要學習的課題</b>和<b>人格發展的方向</b>。它代表外在世界的表現方式，以及需要掌握和整合的人生功課。</p>
                      </div>
                 </div>
              </section>

              <section>
                  <h3 className="text-xl font-semibold text-purple-700 mb-2">生命牌卡組合的特殊情況</h3>
                  <div className="space-y-4">
                      <div className="p-4 bg-gray-50 rounded-lg">
                          <h4 className="font-bold text-gray-800">情況一：統一型 (1張主牌)</h4>
                          <p className="text-sm mt-1">當生日數字總和為 1-9 時，您的「靈魂牌」與「個性牌」是同一張牌。這代表您的內在本質與外在表現高度一致，人生課題非常專注和強烈。您的挑戰與天賦都集中在這張牌的能量中，沒有額外的陰影牌。</p>
                      </div>
                      <div className="p-4 bg-gray-50 rounded-lg">
                          <h4 className="font-bold text-gray-800">情況二：標準雙牌組 (2張主牌 + 1張陰影牌)</h4>
                          <p className="text-sm mt-1">當生日數字總和為 10-18、20 或 21 時，您會有兩張主要牌卡。額外計算的「陰影牌」（靈魂牌 - 個性牌）代表您潛意識中的挑戰、隱藏的才能或需要整合的課題。這三張牌共同構成您此生的學習藍圖。</p>
                      </div>
                      <div className="p-4 bg-gray-50 rounded-lg">
                          <h4 className="font-bold text-gray-800">情況三：太陽特殊三重牌組 (3張主牌)</h4>
                          <p className="text-sm mt-1">當生日數字總和為 19 (太陽) 時，這是一個非常特殊的組合。它不會產生傳統的陰影牌，而是形成一個完整的創造循環：<br/><b>19 (太陽)</b> → <b>10 (命運之輪)</b> → <b>1 (魔術師)</b>。<br/>這三張牌分別代表實現、機遇和意志，共同構成您強大的創造潛能。</p>
                      </div>
                  </div>
              </section>

              <section>
                <h3 className="text-xl font-semibold text-purple-700 mb-2">整合與實踐</h3>
                <p className="text-base leading-relaxed">
                  生命的前半段（約35歲前）主要發展個性卡牌的特質，學習在社會中建立身份。生命後半段則轉向靈魂卡牌的深度探索，尋求生命意義。理解您的生命牌卡不是限制，而是指引。透過認識自己的天賦與挑戰，每個人都能更好地實現潛能，在人生旅程中找到方向和意義。
                </p>
              </section>
            </div>
          );

          // 報告生成器 - 極端詳細的多維度分析系統
          const generateDetailedTarotReport = (cardSet) => {
              const { soulCard, personalityCard, shadowCard, giftCard } = cardSet;
              
              let introduction = '';
              let cardsAnalysis = [];
              let dynamicsAnalysis = '';
              
              const getCardName = (id) => cardDetails[id]?.name || '未知卡牌';

              if (giftCard !== null) { // 太陽特殊三重牌組
                  introduction = `您的生命牌卡組合是極其罕見且強大的「太陽三重奏」(${soulCard}/${personalityCard}/${giftCard})。這是一個動態的創造循環，而非靜態的人格特質。您的生命本質是一個不斷運作的創造引擎，從意志(${giftCard})→機遇(${personalityCard})→實現(${soulCard})的永恆循環。這意味著您天生擁有將夢想轉化為現實的非凡能力，是真正的「顯化大師」。`;
                  
                  cardsAnalysis = [
                      { cardId: soulCard, role: '靈魂牌：光輝實現的最高表達', roleKey: 'soul' },
                      { cardId: personalityCard, role: '個性牌：把握宇宙時機的智慧', roleKey: 'personality' }, // Role corrected as personality
                      { cardId: giftCard, role: '天賦牌：主動創造的核心動力', roleKey: 'gift' }
                  ];
                  
                  dynamicsAnalysis = `在您的太陽三重奏中，${getCardName(giftCard)}是「點火器」，代表您個人意志和創造衝動的源頭；${getCardName(personalityCard)}是「放大器」，讓宇宙為您打開正確的門，提供必要的機遇和資源；${getCardName(soulCard)}是「展現台」，將您的創造成果以最光輝的形式展現給世界。您的人生課題是學會協調這三股能量，讓它們形成一個和諧的創造循環，而非各自為政。`;
                  
              } else if (shadowCard === null) { // 統一型
                  introduction = `您是極其特殊的「統一型」人格 - 靈魂牌與個性牌均為 ${soulCard} 號「${getCardName(soulCard)}」。這意味著您的內在本質與外在表現高度統一，沒有表裡不一的困擾，但也意味著您的人生課題異常集中和強烈。您此生的所有學習、挑戰與天賦都聚焦在這一張牌的深層奧義中。您既是${getCardName(soulCard)}能量的純粹體現，也是其最大的考驗者。`;
                  
                  cardsAnalysis = [
                      { cardId: soulCard, role: '靈魂卡牌：您存在的根本核心', roleKey: 'soul' },
                      { cardId: personalityCard, role: '個性卡牌：您表達的根本方式', roleKey: 'personality' }
                  ];
                  
                  dynamicsAnalysis = `作為統一型，您的內外能量完全集中，這賦予您巨大的專注力和潛能，但也可能讓您陷入${getCardName(soulCard)}的極端表現或盲點中。您的成長關鍵在於發展對自身核心能量的深度覺察，有意識地平衡其天賦與挑戰面，避免其陰影面過度顯現。您需要成為${getCardName(soulCard)}的「完美化身」，既體現其所有光明面，又能整合其陰影，達到該原型的最高表達。`;
                  
              } else { // 標準雙牌組 + 陰影牌
                  introduction = `您的生命牌卡構成了一個完整的三維學習藍圖：靈魂牌「${getCardName(soulCard)}」(${soulCard})定義了您的核心使命和最高潛能，個性牌「${getCardName(personalityCard)}」(${personalityCard})是您今生需要掌握的主要課題和外在表達方式，而陰影牌「${getCardName(shadowCard)}」(${shadowCard})則揭示了前兩張牌之間的潛在張力，以及您需要整合的深層挑戰與隱藏力量。`;
                  
                  cardsAnalysis = [
                      { cardId: soulCard, role: '靈魂牌：您永恆的本質與最高使命', roleKey: 'soul' },
                      { cardId: personalityCard, role: '個性牌：您今生的學習課題', roleKey: 'personality' },
                      { cardId: shadowCard, role: '陰影牌：需要整合的內在力量', roleKey: 'shadow' }
                  ];
                  
                  dynamicsAnalysis = `您的生命藍圖的核心動力學在於${getCardName(shadowCard)}(${shadowCard})這張陰影牌。它既是${getCardName(soulCard)}與${getCardName(personalityCard)}之間可能出現的衝突源泉，也是整合它們的關鍵橋樑。當您用${getCardName(personalityCard)}的特質去過度補償或逃避${getCardName(shadowCard)}所代表的恐懼和挑戰時，您的能量就會失衡。只有當您有意識地擁抱並轉化${getCardName(shadowCard)}的課題時，您的靈魂使命(${getCardName(soulCard)})才能更自然、更強大地通過您的個性(${getCardName(personalityCard)})表達出來。`;
              }
              
              return { introduction, cardsAnalysis, dynamicsAnalysis, cardSet };
          };

          const calculateTarotCards = (date) => {
            const digits = date.replace(/-/g, '').split('').map(Number);
            let total = digits.reduce((sum, digit) => sum + digit, 0);
            const steps = [`出生年月日數字相加: ${digits.join(' + ')} = ${total}`];

            while (total > 21) {
              const newDigits = total.toString().split('').map(Number);
              const newTotal = newDigits.reduce((sum, digit) => sum + digit, 0);
              steps.push(`總和 > 21，繼續相加: ${newDigits.join(' + ')} = ${newTotal}`);
              total = newTotal;
            }

            const soulCard = total;
            let personalityCard = null;
            let shadowCard = null;
            let giftCard = null;
            
            const getCardName = (id) => cardDetails[id]?.name || '未知卡牌';

            if (soulCard >= 10) {
              const personalityDigits = soulCard.toString().split('').map(Number);
              personalityCard = personalityDigits.reduce((sum, digit) => sum + digit, 0);
              
              if (soulCard === 19) {
                // 情況三：太陽特殊三重牌組
                // Personality card is sum of digits of soul card (1+9=10)
                // Gift card is sum of digits of personality card (1+0=1)
                giftCard = personalityCard.toString().split('').map(Number).reduce((s,d)=>s+d,0); // 1+0=1
                steps.push(`靈魂卡牌為 19 (${getCardName(19)})，此為特殊三重牌組。`);
                steps.push(`個性卡牌: 1 + 9 = ${personalityCard} (${getCardName(personalityCard)})`);
                steps.push(`隱藏/天賦卡牌: ${personalityCard.toString().split('').join(' + ')} = ${giftCard} (${getCardName(giftCard)})`);
              } else {
                // 情況二：標準雙牌組 + 陰影牌
                shadowCard = soulCard - personalityCard;
                steps.push(`靈魂卡牌為 ${soulCard} (${getCardName(soulCard)})。`);
                steps.push(`個性卡牌: ${personalityDigits.join(' + ')} = ${personalityCard} (${getCardName(personalityCard)})`);
                steps.push(`陰影牌: ${soulCard} - ${personalityCard} = ${shadowCard} (${getCardName(shadowCard)})`);
              }
            } else {
              // 情況一：統一型
              personalityCard = soulCard;
              steps.push(`靈魂卡牌為個位數，個性卡牌與其相同: ${personalityCard} (${getCardName(personalityCard)})。`);
              steps.push(`此為統一型，無額外陰影牌。`);
            }

            return { soulCard, personalityCard, shadowCard, giftCard, steps };
          };

          const handleCalculate = () => {
            if (!birthDate) {
              alert('請輸入出生日期');
              return;
            }
            const cardSet = calculateTarotCards(birthDate);
            setResult(cardSet);
            
            const report = generateDetailedTarotReport(cardSet);
            setDetailedReport(report);
            
            setShowProcess(false);
            setViewMode('simple'); // Reset to simple view on new calculation
          };

          const formatDate = (date) => {
            if (!date) return '';
            const parts = date.split('-');
            return `${parts[0]}年${parts[1]}月${parts[2]}日`;
          };

          const CardDisplay = ({ icon, title, cardId, bgColor, textColor, borderColor, description }) => {
            if (cardId === null || cardId === undefined || !cardDetails[cardId]) return null;
            const details = cardDetails[cardId];
            return (
              <div className={`${bgColor} rounded-lg p-4 shadow-sm border-l-4 ${borderColor}`}>
                <div className="flex items-center gap-2 mb-2">
                  {icon}
                  <h3 className={`font-semibold ${textColor}`}>{title}</h3>
                </div>
                <div className={`text-2xl font-bold ${textColor} mb-2`}>
                  {cardId} - {details.name}
                </div>
                <p className={`text-sm font-semibold ${textColor} mb-2`}>{details.shortMeaning}</p>
                <p className={`text-xs ${textColor} opacity-80`}>{description}</p>
              </div>
            );
          };

          const DetailedTarotReport = ({ reportData }) => {
            const [openSections, setOpenSections] = useState({});
            const [expandedAnalysis, setExpandedAnalysis] = useState(false);

            const toggleSection = (id) => {
                setOpenSections(prev => ({...prev, [id]: !prev[id]}));
            };

            return (
                <div className="bg-white rounded-lg p-6 shadow-lg mt-6 animate-fade-in">
                    <h2 className="text-3xl font-bold text-purple-900 mb-3 text-center">您的深度塔羅生命藍圖報告</h2>
                    <p className="text-center text-gray-700 mb-6 text-lg leading-relaxed">{reportData.introduction}</p>

                    <div className="space-y-6 mb-8">
                        <h3 className="text-2xl font-bold text-purple-800 text-center mb-4">多維度卡牌分析</h3>
                        {reportData.cardsAnalysis.map((cardAnalysis, index) => {
                            const cardData = cardDetails[cardAnalysis.cardId];
                            if (!cardData) return null; // Skip if card data is missing
                            
                            return (
                                <div key={index} className="border-2 border-purple-200 rounded-lg overflow-hidden shadow-md">
                                    <button 
                                        onClick={() => toggleSection(`card-${cardAnalysis.cardId}-${index}`)} 
                                        className="w-full p-5 bg-gradient-to-r from-purple-100 to-pink-100 hover:from-purple-200 hover:to-pink-200 flex justify-between items-center transition-all duration-300"
                                    >
                                        <div className="text-left">
                                            <span className="text-xl font-bold text-purple-800">
                                                {cardAnalysis.role}: {cardData.name} ({cardAnalysis.cardId})
                                            </span>
                                            <div className="text-sm text-purple-600 mt-1">
                                                {cardData.shortMeaning || ''}
                                            </div>
                                        </div>
                                        <span className="text-purple-600 text-2xl">
                                            {openSections[`card-${cardAnalysis.cardId}-${index}`] ? <ChevronUp /> : <ChevronDown />}
                                        </span>
                                    </button>
                                    
                                    {openSections[`card-${cardAnalysis.cardId}-${index}`] && (
                                        <div className="p-6 bg-white space-y-6 animate-fade-in">
                                            <div className="p-4 bg-purple-50 rounded-lg border-l-4 border-purple-500">
                                                <h4 className="font-bold text-purple-800 text-lg mb-2">🎭 核心意義</h4>
                                                <p className="text-gray-700 leading-relaxed">{cardData.shortMeaning}</p>
                                            </div>
                                            
                                            <div className="grid md:grid-cols-2 gap-4">
                                                <div className="p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                                                    <h4 className="font-bold text-green-800 mb-2">✨ 天賦與潛能</h4>
                                                    <p className="text-sm text-gray-700">{cardData.soulMission}</p>
                                                </div>
                                                
                                                <div className="p-4 bg-orange-50 rounded-lg border-l-4 border-orange-500">
                                                    <h4 className="font-bold text-orange-800 mb-2">⚠️ 挑戰與課題</h4>
                                                    <p className="text-sm text-gray-700">{cardData.personalityTrait}</p>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>

                    <div className="mb-8">
                        <button
                            onClick={() => setExpandedAnalysis(!expandedAnalysis)}
                            className="w-full p-5 bg-gradient-to-r from-blue-100 to-indigo-100 hover:from-blue-200 hover:to-indigo-200 rounded-lg shadow-md transition-all duration-300 flex items-center justify-between"
                        >
                            <h3 className="text-2xl font-bold text-blue-900">🌌 牌組互動分析：能量的神聖共舞</h3>
                            <span className="text-blue-600 text-2xl">
                                {expandedAnalysis ? <ChevronUp /> : <ChevronDown />}
                            </span>
                        </button>
                        
                        {expandedAnalysis && (
                            <div className="mt-4 p-6 bg-blue-50 rounded-lg border-2 border-blue-200 animate-fade-in">
                                <p className="text-blue-900 leading-relaxed text-lg">{reportData.dynamicsAnalysis}</p>
                            </div>
                        )}
                    </div>
                    
                    <div className="text-center p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-200">
                        <h4 className="text-xl font-bold text-purple-800 mb-3">🙏 整合與實踐</h4>
                        <p className="text-gray-700 leading-relaxed">
                            這份報告提供了一個關於您生命藍圖的深度視角。請記住，這些牌卡不是對您的限制，而是一份珍貴的指引。
                            它們揭示了您的天賦、挑戰與最高的潛能。通過理解和整合這些原型能量，
                            您將能更有意識地走在屬於自己的獨特生命道路上，活出最真實、最完整的自己。
                        </p>
                    </div>
                </div>
            );
          };

          return (
            <div className="max-w-3xl mx-auto p-4 sm:p-6 bg-gradient-to-br from-purple-100 to-pink-100 rounded-xl shadow-xl font-sans">
              <div className="text-center mb-8">
                <h1 className="text-3xl font-bold text-purple-800 mb-2 flex items-center justify-center gap-2">
                  <Sparkles className="w-8 h-8" />
                  塔羅生命靈數計算器
                </h1>
                <p className="text-gray-600">依據 Mary K. Greer 系統，解碼您的主牌與陰影牌</p>
              </div>

              <div className="bg-white rounded-lg p-6 shadow-md mb-6">
                <div className="mb-6">
                  <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                    <Calendar />
                    請輸入您的出生日期
                  </label>
                  <input
                    type="date"
                    value={birthDate}
                    onChange={(e) => setBirthDate(e.target.value)}
                    className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  />
                </div>
                <button
                  onClick={handleCalculate}
                  className="w-full bg-purple-600 text-white py-3 rounded-md hover:bg-purple-700 transition-colors font-semibold flex items-center justify-center gap-2"
                >
                  <Sparkles className="w-5 h-5" /> 計算我的生命牌卡
                </button>
              </div>

              {result && (
                <div className="space-y-6 animate-fade-in">
                  <div className="bg-white rounded-lg p-4 shadow-md">
                    <div className="flex justify-center space-x-2 sm:space-x-4">
                      <button
                        onClick={() => setViewMode('simple')}
                        className={`px-4 py-2 sm:px-6 sm:py-3 rounded-lg font-semibold transition-all text-sm sm:text-base ${
                          viewMode === 'simple'
                            ? 'bg-purple-600 text-white shadow-lg transform scale-105'
                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                        }`}
                      >
                        📊 簡要概覽
                      </button>
                      <button
                        onClick={() => setViewMode('detailed')}
                        className={`px-4 py-2 sm:px-6 sm:py-3 rounded-lg font-semibold transition-all text-sm sm:text-base ${
                          viewMode === 'detailed'
                            ? 'bg-purple-600 text-white shadow-lg transform scale-105'
                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                        }`}
                      >
                        📚 詳細分析
                      </button>
                    </div>
                  </div>

                  {viewMode === 'simple' ? (
                    <div className="bg-white rounded-lg p-6 shadow-md">
                      <h2 className="text-xl font-bold text-gray-800 mb-4">
                        您的塔羅生命靈數結果 ({formatDate(birthDate)})
                      </h2>
                      
                      <div className="grid md:grid-cols-1 gap-6">
                        <CardDisplay 
                          icon={<Hash className="w-5 h-5 text-purple-600" />} 
                          title="靈魂卡牌 (Soul Card)"
                          cardId={result.soulCard}
                          bgColor="bg-purple-100"
                          textColor="text-purple-900"
                          borderColor="border-purple-500"
                          description={cardDetails[result.soulCard]?.soulMission}
                        />
                        <CardDisplay 
                          icon={<User className="w-5 h-5 text-pink-600" />} 
                          title="個性卡牌 (Personality Card)"
                          cardId={result.personalityCard}
                          bgColor="bg-pink-100"
                          textColor="text-pink-900"
                          borderColor="border-pink-500"
                          description={cardDetails[result.personalityCard]?.personalityTrait}
                        />

                        {result.shadowCard !== null && cardDetails[result.shadowCard] && (
                            <CardDisplay 
                              icon={<Shield className="w-5 h-5 text-slate-600" />} 
                              title="陰影牌 (Shadow Card)"
                              cardId={result.shadowCard}
                              bgColor="bg-slate-100"
                              textColor="text-slate-900"
                              borderColor="border-slate-500"
                              description="這是您需要面對與整合的內在挑戰，也是隱藏的潛能所在。"
                            />
                        )}

                        {result.giftCard !== null && cardDetails[result.giftCard] && (
                            <CardDisplay 
                              icon={<Gift className="w-5 h-5 text-yellow-600" />} 
                              title="隱藏/天賦卡牌 (Hidden/Gift Card)"
                              cardId={result.giftCard}
                              bgColor="bg-yellow-100"
                              textColor="text-yellow-900"
                              borderColor="border-yellow-500"
                              description="作為太陽三重奏的一部分，這代表您的核心意志與天賦才能。"
                            />
                        )}
                      </div>

                      <button
                        onClick={() => setShowProcess(!showProcess)}
                        className="mt-6 text-purple-600 hover:text-purple-800 text-sm font-medium flex items-center gap-1"
                      >
                        {showProcess ? '隱藏' : '顯示'}計算過程
                        <span className="text-purple-600">{showProcess ? <ChevronUp /> : <ChevronDown />}</span>
                      </button>

                      {showProcess && (
                        <div className="mt-4 p-4 bg-gray-50 rounded-lg animate-fade-in">
                          <h4 className="font-semibold text-gray-700 mb-2">計算步驟：</h4>
                          <p className="text-sm text-gray-600 mb-2">
                            出生日期：{formatDate(birthDate)}
                          </p>
                          <div className="space-y-1">
                            {result.steps.map((step, index) => (
                              <p key={index} className="text-sm font-mono text-gray-700">
                                {step}
                              </p>
                            ))}
                          </div>
                        </div>
                      )}
                    </div>
                  ) : (
                    detailedReport && <DetailedTarotReport reportData={detailedReport} />
                  )}
                </div>
              )}

              <div className="text-center mt-8">
                <button
                  onClick={() => setShowInfo(!showInfo)}
                  className="inline-flex items-center gap-2 px-6 py-3 bg-white text-purple-700 rounded-full shadow-md hover:bg-purple-50 transition-transform transform hover:scale-105"
                >
                  <span className="font-semibold">了解更多關於塔羅生命靈數</span>
                  {showInfo ? <ChevronUp className="w-5 h-5" /> : <ChevronDown className="w-5 h-5" />}
                </button>
              </div>

              {showInfo && <TarotTheoryInfo />}
            </div>
          );
        };
        
        // --- TAROT COMPATIBILITY SYSTEM ---
        const TarotCompatibilitySystem = () => {
          const [person1Date, setPerson1Date] = useState('');
          const [person2Date, setPerson2Date] = useState('');
          const [person1Name, setPerson1Name] = useState('');
          const [person2Name, setPerson2Name] = useState('');
          const [result, setResult] = useState(null);
          const [showDetails, setShowDetails] = useState({
            soul: false,
            personality: false,
            shadow: false
          });

          // Compatibility Matrix (remains internal to this component)
          const compatibilityMatrix = {
            1: {1:{score:85,type:'鏡像關係',desc:'兩個創造者相遇，能量強大但需避免競爭'},2:{score:75,type:'互補關係',desc:'行動與直覺的完美結合'},3:{score:80,type:'創造關係',desc:'共同創造豐盛的可能'},4:{score:70,type:'建設關係',desc:'意志與結構的結合'},5:{score:65,type:'學習關係',desc:'創新與傳統的對話'},6:{score:90,type:'和諧關係',desc:'創造力在愛中綻放'},7:{score:85,type:'動力關係',desc:'共同推進目標'},8:{score:80,type:'力量關係',desc:'意志與內在力量的結合'},9:{score:60,type:'成長關係',desc:'外向與內向的平衡'},10:{score:85,type:'機遇關係',desc:'創造力遇上機會'},11:{score:70,type:'平衡關係',desc:'創造需要公正的評估'},12:{score:65,type:'轉化關係',desc:'行動與等待的學習'},13:{score:75,type:'重生關係',desc:'創造與轉化的循環'},14:{score:80,type:'調和關係',desc:'創造力需要平衡'},15:{score:70,type:'激情關係',desc:'創造力與慾望的結合'},16:{score:75,type:'突破關係',desc:'創新帶來改變'},17:{score:85,type:'靈感關係',desc:'創造力與希望相遇'},18:{score:70,type:'直覺關係',desc:'意識與潛意識的對話'},19:{score:90,type:'光明關係',desc:'創造力在陽光下綻放'},20:{score:80,type:'覺醒關係',desc:'創造新的開始'},21:{score:85,type:'完成關係',desc:'創造力達到圓滿'}},
            2: {1:{score:75,type:'互補關係',desc:'直覺引導行動'},2:{score:85,type:'深度連結',desc:'心靈的深度共鳴'},3:{score:80,type:'陰性力量',desc:'直覺與創造的結合'},4:{score:65,type:'對立統一',desc:'陰性與陽性的平衡'},5:{score:70,type:'靈性關係',desc:'內在與外在教導的結合'},6:{score:85,type:'心靈關係',desc:'深度的情感連結'},7:{score:60,type:'內外平衡',desc:'靜與動的學習'},8:{score:75,type:'內在力量',desc:'直覺與力量的結合'},9:{score:90,type:'靈魂關係',desc:'深度的靈性連結'},10:{score:70,type:'命運關係',desc:'直覺感知命運'},11:{score:75,type:'智慧關係',desc:'直覺與理性的平衡'},12:{score:85,type:'神秘關係',desc:'共同的內在探索'},13:{score:80,type:'轉化關係',desc:'深度的心靈轉化'},14:{score:80,type:'靈性平衡',desc:'內在的和諧'},15:{score:65,type:'陰影關係',desc:'面對內在陰影'},16:{score:70,type:'啟示關係',desc:'直覺帶來洞察'},17:{score:90,type:'神聖關係',desc:'靈性的指引'},18:{score:95,type:'月光關係',desc:'潛意識的深度連結'},19:{score:75,type:'光影關係',desc:'內在與外在的平衡'},20:{score:85,type:'覺醒關係',desc:'靈性的覺醒'},21:{score:80,type:'智慧圓滿',desc:'內在智慧的完成'}},
            3: {1:{score:80,type:'創造關係',desc:'共創豐盛'},2:{score:80,type:'陰性力量',desc:'母性與靈性的結合'},3:{score:85,type:'豐盛關係',desc:'雙倍的創造力'},4:{score:90,type:'完美配對',desc:'陰陽平衡的典範'},5:{score:70,type:'成長關係',desc:'創造與指導'},6:{score:95,type:'愛的化身',desc:'愛與美的極致表現'},7:{score:75,type:'推進關係',desc:'創造力需要方向'},8:{score:85,type:'溫柔力量',desc:'母性與力量的結合'},9:{score:65,type:'內外關係',desc:'豐盛與簡樸的平衡'},10:{score:80,type:'豐盛循環',desc:'創造的自然循環'},11:{score:70,type:'公正創造',desc:'創造需要平衡'},12:{score:75,type:'等待豐收',desc:'創造需要耐心'},13:{score:70,type:'生死循環',desc:'創造與毀滅的自然法則'},14:{score:85,type:'和諧創造',desc:'平衡的創造力'},15:{score:65,type:'慾望關係',desc:'創造力與慾望'},16:{score:60,type:'重建關係',desc:'破壞後的重建'},17:{score:90,type:'希望關係',desc:'創造帶來希望'},18:{score:75,type:'月光滋養',desc:'潛意識的滋養'},19:{score:95,type:'陽光豐盛',desc:'最高的創造表現'},20:{score:80,type:'新生關係',desc:'創造新的開始'},21:{score:90,type:'圓滿豐盛',desc:'創造的最高境界'}},
            4: {1:{score:70,type:'建設關係',desc:'意志與結構'},2:{score:65,type:'對立統一',desc:'理性與直覺'},3:{score:90,type:'完美配對',desc:'帝后相配'},4:{score:80,type:'權力關係',desc:'需要權力平衡'},5:{score:85,type:'權威關係',desc:'世俗與精神權威'},6:{score:70,type:'責任關係',desc:'權力與愛的平衡'},7:{score:85,type:'征服關係',desc:'共同的目標'},8:{score:80,type:'力量聯盟',desc:'不同形式的力量'},9:{score:60,type:'對比關係',desc:'外在與內在的差異'},10:{score:75,type:'掌控命運',desc:'控制與放手'},11:{score:90,type:'公正統治',desc:'權力與正義'},12:{score:55,type:'挑戰關係',desc:'控制與臣服的衝突'},13:{score:85,type:'權力轉換',desc:'舊秩序的終結'},14:{score:75,type:'穩定關係',desc:'權力需要節制'},15:{score:70,type:'權力慾望',desc:'權力的陰暗面'},16:{score:80,type:'權力崩塌',desc:'結構的瓦解'},17:{score:65,type:'理想關係',desc:'權力與理想'},18:{score:60,type:'意識差異',desc:'理性與非理性'},19:{score:85,type:'光明統治',desc:'開明的領導'},20:{score:80,type:'審判關係',desc:'權力的審判'},21:{score:85,type:'完美統治',desc:'達到統治的最高境界'}},
            5: {1:{score:65,type:'學習關係',desc:'創新與傳統'},2:{score:70,type:'靈性關係',desc:'不同的靈性道路'},3:{score:70,type:'成長關係',desc:'物質與精神'},4:{score:85,type:'權威關係',desc:'兩種權威形式'},5:{score:85,type:'同道關係',desc:'共同的信念'},6:{score:75,type:'神聖之愛',desc:'精神與世俗之愛'},7:{score:70,type:'信念行動',desc:'信念化為行動'},8:{score:75,type:'精神力量',desc:'信念的力量'},9:{score:90,type:'導師關係',desc:'精神導師'},10:{score:70,type:'信仰考驗',desc:'信念與變化'},11:{score:80,type:'道德關係',desc:'精神與法律'},12:{score:85,type:'犧牲關係',desc:'精神的犧牲'},13:{score:75,type:'信仰轉化',desc:'信念的死亡與重生'},14:{score:90,type:'精神平衡',desc:'完美的精神和諧'},15:{score:60,type:'誘惑關係',desc:'精神與物質的衝突'},16:{score:70,type:'信仰崩塌',desc:'信念體系的瓦解'},17:{score:85,type:'精神指引',desc:'信仰帶來希望'},18:{score:75,type:'神秘教導',desc:'隱藏的智慧'},19:{score:80,type:'光明教導',desc:'開悟的教導'},20:{score:85,type:'精神覺醒',desc:'集體的覺醒'},21:{score:80,type:'智慧傳承',desc:'完整的智慧體系'}},
            6: {1:{score:90,type:'和諧關係',desc:'創造力在愛中綻放'},2:{score:85,type:'心靈關係',desc:'深度的情感連結'},3:{score:95,type:'愛的化身',desc:'愛與美的結合'},4:{score:70,type:'責任關係',desc:'愛與責任'},5:{score:75,type:'神聖之愛',desc:'世俗與神聖的愛'},6:{score:90,type:'完美之愛',desc:'愛的最高表現'},7:{score:75,type:'愛的方向',desc:'愛需要方向'},8:{score:85,type:'愛的力量',desc:'愛就是力量'},9:{score:65,type:'內外之愛',desc:'社交與獨處'},10:{score:80,type:'命運之愛',desc:'愛的命運'},11:{score:75,type:'公正之愛',desc:'愛需要平衡'},12:{score:70,type:'犧牲之愛',desc:'愛的犧牲'},13:{score:65,type:'愛的轉化',desc:'愛的死亡與重生'},14:{score:85,type:'和諧之愛',desc:'完美的平衡'},15:{score:90,type:'激情之愛',desc:'愛與慾望'},16:{score:60,type:'愛的考驗',desc:'關係的崩塌'},17:{score:90,type:'希望之愛',desc:'愛帶來希望'},18:{score:75,type:'夢幻之愛',desc:'愛的幻想'},19:{score:95,type:'光明之愛',desc:'純粹的愛'},20:{score:80,type:'神聖結合',desc:'靈魂的結合'},21:{score:90,type:'圓滿之愛',desc:'愛的最高境界'}},
            7: {1:{score:85,type:'動力關係',desc:'共同推進'},2:{score:60,type:'內外平衡',desc:'行動與靜止'},3:{score:75,type:'推進關係',desc:'創造需要方向'},4:{score:85,type:'征服關係',desc:'共同的征服'},5:{score:70,type:'信念行動',desc:'將信念化為行動'},6:{score:75,type:'愛的方向',desc:'為愛而戰'},7:{score:80,type:'競爭關係',desc:'健康的競爭'},8:{score:85,type:'雙重力量',desc:'意志與內在力量'},9:{score:55,type:'速度差異',desc:'快與慢的衝突'},10:{score:80,type:'掌控命運',desc:'駕馭命運之輪'},11:{score:75,type:'公正勝利',desc:'正義的勝利'},12:{score:60,type:'行動暫停',desc:'前進與等待'},13:{score:70,type:'征服死亡',desc:'超越限制'},14:{score:70,type:'控制平衡',desc:'速度需要節制'},15:{score:75,type:'慾望驅動',desc:'被慾望驅動'},16:{score:75,type:'突破障礙',desc:'衝破阻礙'},17:{score:80,type:'理想追求',desc:'向理想前進'},18:{score:65,type:'夜間旅程',desc:'在迷霧中前進'},19:{score:90,type:'勝利之光',desc:'光明的勝利'},20:{score:80,type:'最終勝利',desc:'達到最終目標'},21:{score:85,type:'完成征途',desc:'旅程的完成'}},
            8: {1:{score:80,type:'力量關係',desc:'不同形式的力量'},2:{score:75,type:'內在力量',desc:'直覺的力量'},3:{score:85,type:'溫柔力量',desc:'母性的力量'},4:{score:80,type:'力量聯盟',desc:'剛柔並濟'},5:{score:75,type:'精神力量',desc:'信念的力量'},6:{score:85,type:'愛的力量',desc:'愛就是最大的力量'},7:{score:85,type:'雙重力量',desc:'內外力量的結合'},8:{score:85,type:'力量共鳴',desc:'力量的倍增'},9:{score:70,type:'靜默力量',desc:'不同的力量表達'},10:{score:75,type:'命運力量',desc:'掌控命運的力量'},11:{score:80,type:'公正力量',desc:'正義的力量'},12:{score:75,type:'臣服力量',desc:'臣服也是力量'},13:{score:80,type:'轉化力量',desc:'死亡與重生的力量'},14:{score:85,type:'平衡力量',desc:'力量的完美平衡'},15:{score:70,type:'原始力量',desc:'馴服原始慾望'},16:{score:70,type:'重建力量',desc:'從廢墟中重建'},17:{score:85,type:'希望力量',desc:'希望給予力量'},18:{score:75,type:'直覺力量',desc:'潛意識的力量'},19:{score:90,type:'光明力量',desc:'陽光般的力量'},20:{score:85,type:'覺醒力量',desc:'覺醒的力量'},21:{score:85,type:'圓滿力量',desc:'力量的最高境界'}},
            9: {1:{score:60,type:'成長關係',desc:'外向與內向的學習'},2:{score:90,type:'靈魂關係',desc:'深度的靈性連結'},3:{score:65,type:'內外關係',desc:'豐盛與簡樸'},4:{score:60,type:'對比關係',desc:'權力與智慧'},5:{score:90,type:'導師關係',desc:'精神導師的相遇'},6:{score:65,type:'內外之愛',desc:'獨處與相伴'},7:{score:55,type:'速度差異',desc:'快與慢的平衡'},8:{score:70,type:'靜默力量',desc:'內在的力量'},9:{score:95,type:'智慧相遇',desc:'智者的共鳴'},10:{score:65,type:'內在循環',desc:'內在的命運'},11:{score:75,type:'智慧公正',desc:'智慧的判斷'},12:{score:85,type:'內省關係',desc:'共同的內在探索'},13:{score:80,type:'智慧轉化',desc:'通過智慧轉化'},14:{score:80,type:'內在平衡',desc:'智慧的平衡'},15:{score:60,type:'光影關係',desc:'面對內在陰影'},16:{score:65,type:'內在重建',desc:'內在的重建'},17:{score:85,type:'內在之光',desc:'內在的指引'},18:{score:85,type:'夜間智慧',desc:'潛意識的智慧'},19:{score:70,type:'內外光明',desc:'內在與外在的光'},20:{score:80,type:'智慧覺醒',desc:'內在的覺醒'},21:{score:85,type:'智慧圓滿',desc:'智慧的完成'}},
            10: {1:{score:85,type:'機遇關係',desc:'創造機會'},2:{score:70,type:'命運關係',desc:'感知命運'},3:{score:80,type:'豐盛循環',desc:'自然的循環'},4:{score:75,type:'掌控命運',desc:'控制與放手'},5:{score:70,type:'信仰考驗',desc:'命運的考驗'},6:{score:80,type:'命運之愛',desc:'命中注定的愛'},7:{score:80,type:'掌控命運',desc:'駕馭命運'},8:{score:75,type:'命運力量',desc:'改變命運的力量'},9:{score:65,type:'內在循環',desc:'內在的命運輪迴'},10:{score:85,type:'雙重命運',desc:'命運的交織'},11:{score:75,type:'因果關係',desc:'命運的因果'},12:{score:70,type:'命運等待',desc:'等待命運轉變'},13:{score:85,type:'命運轉換',desc:'命運的死亡與重生'},14:{score:80,type:'命運平衡',desc:'平衡的命運'},15:{score:70,type:'命運束縛',desc:'被命運束縛'},16:{score:80,type:'命運突變',desc:'命運的突然改變'},17:{score:85,type:'幸運之星',desc:'好運的到來'},18:{score:75,type:'命運迷霧',desc:'不確定的命運'},19:{score:90,type:'幸運之光',desc:'光明的命運'},20:{score:85,type:'命運審判',desc:'命運的最終審判'},21:{score:85,type:'命運完成',desc:'命運的圓滿'}},
            11: {1:{score:70,type:'平衡關係',desc:'創造與評估'},2:{score:75,type:'智慧關係',desc:'直覺與理性'},3:{score:70,type:'公正創造',desc:'平衡的創造'},4:{score:90,type:'公正統治',desc:'權力與正義'},5:{score:80,type:'道德關係',desc:'法律與道德'},6:{score:75,type:'公正之愛',desc:'愛的平衡'},7:{score:75,type:'公正勝利',desc:'正義的勝利'},8:{score:80,type:'公正力量',desc:'正義的力量'},9:{score:75,type:'智慧公正',desc:'智慧的判斷'},10:{score:75,type:'因果關係',desc:'因果法則'},11:{score:85,type:'雙重正義',desc:'正義的共鳴'},12:{score:65,type:'判斷暫停',desc:'暫停判斷'},13:{score:70,type:'終極審判',desc:'最終的公正'},14:{score:85,type:'完美平衡',desc:'正義與節制'},15:{score:60,type:'道德考驗',desc:'正義與誘惑'},16:{score:70,type:'正義崩塌',desc:'不公的瓦解'},17:{score:80,type:'理想正義',desc:'正義的理想'},18:{score:65,type:'隱藏真相',desc:'真相的迷霧'},19:{score:85,type:'光明正義',desc:'真理之光'},20:{score:90,type:'最終審判',desc:'終極的正義'},21:{score:85,type:'宇宙正義',desc:'宇宙的平衡'}},
            12: {1:{score:65,type:'轉化關係',desc:'行動與等待'},2:{score:85,type:'神秘關係',desc:'內在的探索'},3:{score:75,type:'等待豐收',desc:'耐心等待'},4:{score:55,type:'挑戰關係',desc:'控制與臣服'},5:{score:85,type:'犧牲關係',desc:'精神的犧牲'},6:{score:70,type:'犧牲之愛',desc:'為愛犧牲'},7:{score:60,type:'行動暫停',desc:'暫停前進'},8:{score:75,type:'臣服力量',desc:'臣服的力量'},9:{score:85,type:'內省關係',desc:'共同內省'},10:{score:70,type:'命運等待',desc:'等待轉機'},11:{score:65,type:'判斷暫停',desc:'暫緩判斷'},12:{score:90,type:'共同犧牲',desc:'深度的理解'},13:{score:85,type:'死亡準備',desc:'為轉化做準備'},14:{score:80,type:'耐心平衡',desc:'等待中的平衡'},15:{score:65,type:'束縛覺察',desc:'覺察束縛'},16:{score:75,type:'崩塌前夕',desc:'改變前的等待'},17:{score:80,type:'希望等待',desc:'在等待中保持希望'},18:{score:85,type:'潛意識探索',desc:'深入潛意識'},19:{score:70,type:'黎明前夕',desc:'等待光明'},20:{score:80,type:'覺醒準備',desc:'準備覺醒'},21:{score:75,type:'完成等待',desc:'等待圓滿'}},
            13: {1:{score:75,type:'重生關係',desc:'創造與毀滅'},2:{score:80,type:'轉化關係',desc:'深度轉化'},3:{score:70,type:'生死循環',desc:'自然循環'},4:{score:85,type:'權力轉換',desc:'舊秩序終結'},5:{score:75,type:'信仰轉化',desc:'信念的轉變'},6:{score:65,type:'愛的轉化',desc:'關係的轉變'},7:{score:70,type:'征服死亡',desc:'超越限制'},8:{score:80,type:'轉化力量',desc:'轉化的力量'},9:{score:80,type:'智慧轉化',desc:'智慧的轉變'},10:{score:85,type:'命運轉換',desc:'命運的轉折'},11:{score:70,type:'終極審判',desc:'最終的結算'},12:{score:85,type:'死亡準備',desc:'轉化的準備'},13:{score:90,type:'雙重轉化',desc:'深度的轉變'},14:{score:80,type:'轉化平衡',desc:'平衡的轉變'},15:{score:75,type:'陰影轉化',desc:'面對陰影'},16:{score:85,type:'徹底改變',desc:'完全的轉變'},17:{score:75,type:'重生希望',desc:'轉化帶來希望'},18:{score:80,type:'潛意識死亡',desc:'深層的轉變'},19:{score:80,type:'黑暗黎明',desc:'死亡後的光明'},20:{score:85,type:'最終轉化',desc:'終極的重生'},21:{score:80,type:'循環完成',desc:'生死的圓滿'}},
            14: {1:{score:80,type:'調和關係',desc:'創造的平衡'},2:{score:80,type:'靈性平衡',desc:'內在和諧'},3:{score:85,type:'和諧創造',desc:'平衡的創造'},4:{score:75,type:'穩定關係',desc:'權力的節制'},5:{score:90,type:'精神平衡',desc:'完美的和諧'},6:{score:85,type:'和諧之愛',desc:'愛的平衡'},7:{score:70,type:'控制平衡',desc:'速度的節制'},8:{score:85,type:'平衡力量',desc:'力量的和諧'},9:{score:80,type:'內在平衡',desc:'智慧的平衡'},10:{score:80,type:'命運平衡',desc:'平衡的命運'},11:{score:85,type:'完美平衡',desc:'正義與和諧'},12:{score:80,type:'耐心平衡',desc:'等待的平衡'},13:{score:80,type:'轉化平衡',desc:'平衡的轉變'},14:{score:90,type:'雙重和諧',desc:'完美的平衡'},15:{score:65,type:'極端平衡',desc:'平衡極端'},16:{score:70,type:'重建平衡',desc:'崩塌後的平衡'},17:{score:90,type:'希望平衡',desc:'和諧的希望'},18:{score:75,type:'情緒平衡',desc:'平衡情緒'},19:{score:85,type:'光明和諧',desc:'陽光般的和諧'},20:{score:85,type:'神聖平衡',desc:'神聖的和諧'},21:{score:90,type:'宇宙和諧',desc:'宇宙的平衡'}},
            15: {1:{score:70,type:'激情關係',desc:'創造與慾望'},2:{score:65,type:'陰影關係',desc:'面對陰影'},3:{score:65,type:'慾望關係',desc:'創造與慾望'},4:{score:70,type:'權力慾望',desc:'權力的陰暗面'},5:{score:60,type:'誘惑關係',desc:'精神的考驗'},6:{score:90,type:'激情之愛',desc:'愛與慾望'},7:{score:75,type:'慾望驅動',desc:'被慾望驅動'},8:{score:70,type:'原始力量',desc:'原始的力量'},9:{score:60,type:'光影關係',desc:'光明與黑暗'},10:{score:70,type:'命運束縛',desc:'被命運束縛'},11:{score:60,type:'道德考驗',desc:'正義的考驗'},12:{score:65,type:'束縛覺察',desc:'覺察束縛'},13:{score:75,type:'陰影轉化',desc:'轉化陰影'},14:{score:65,type:'極端平衡',desc:'平衡極端'},15:{score:85,type:'陰影共舞',desc:'共同面對陰影'},16:{score:80,type:'束縛破除',desc:'打破枷鎖'},17:{score:70,type:'黑暗之光',desc:'黑暗中的希望'},18:{score:85,type:'潛意識慾望',desc:'深層的慾望'},19:{score:75,type:'光影對比',desc:'極端的對比'},20:{score:75,type:'陰影覺醒',desc:'覺醒的陰影'},21:{score:70,type:'整合陰影',desc:'陰影的整合'}},
            16: {1:{score:75,type:'突破關係',desc:'創新突破'},2:{score:70,type:'啟示關係',desc:'直覺的洞察'},3:{score:60,type:'重建關係',desc:'破壞與重建'},4:{score:80,type:'權力崩塌',desc:'結構瓦解'},5:{score:70,type:'信仰崩塌',desc:'信念動搖'},6:{score:60,type:'愛的考驗',desc:'關係的考驗'},7:{score:75,type:'突破障礙',desc:'衝破阻礙'},8:{score:70,type:'重建力量',desc:'廢墟中重建'},9:{score:65,type:'內在重建',desc:'內在的重建'},10:{score:80,type:'命運突變',desc:'突然的改變'},11:{score:70,type:'正義崩塌',desc:'不公的瓦解'},12:{score:75,type:'崩塌前夕',desc:'改變的準備'},13:{score:85,type:'徹底改變',desc:'完全的轉變'},14:{score:70,type:'重建平衡',desc:'崩塌後的平衡'},15:{score:80,type:'束縛破除',desc:'打破枷鎖'},16:{score:85,type:'雙重崩塌',desc:'共同的改變'},17:{score:75,type:'廢墟希望',desc:'廢墟中的希望'},18:{score:70,type:'幻象破滅',desc:'幻覺的破滅'},19:{score:80,type:'破曉時分',desc:'破壞後的光明'},20:{score:85,type:'覺醒震撼',desc:'震撼的覺醒'},21:{score:75,type:'破後重生',desc:'完全的重建'}},
            17: {1:{score:85,type:'靈感關係',desc:'創造的靈感'},2:{score:90,type:'神聖關係',desc:'靈性的指引'},3:{score:90,type:'希望關係',desc:'創造希望'},4:{score:65,type:'理想關係',desc:'理想與現實'},5:{score:85,type:'精神指引',desc:'信仰的希望'},6:{score:90,type:'希望之愛',desc:'愛的希望'},7:{score:80,type:'理想追求',desc:'追求理想'},8:{score:85,type:'希望力量',desc:'希望的力量'},9:{score:85,type:'內在之光',desc:'內在的指引'},10:{score:85,type:'幸運之星',desc:'好運降臨'},11:{score:80,type:'理想正義',desc:'正義的理想'},12:{score:80,type:'希望等待',desc:'希望中等待'},13:{score:75,type:'重生希望',desc:'轉化的希望'},14:{score:90,type:'希望平衡',desc:'和諧的希望'},15:{score:70,type:'黑暗之光',desc:'黑暗中的光'},16:{score:75,type:'廢墟希望',desc:'廢墟中的希望'},17:{score:95,type:'雙重希望',desc:'希望的共鳴'},18:{score:80,type:'夢想希望',desc:'夢中的希望'},19:{score:95,type:'光明希望',desc:'最高的希望'},20:{score:90,type:'神聖希望',desc:'神聖的指引'},21:{score:90,type:'宇宙希望',desc:'宇宙的祝福'}},
            18: {1:{score:70,type:'直覺關係',desc:'意識與潛意識'},2:{score:95,type:'月光關係',desc:'潛意識的共鳴'},3:{score:75,type:'月光滋養',desc:'潛意識滋養'},4:{score:60,type:'意識差異',desc:'理性與非理性'},5:{score:75,type:'神秘教導',desc:'隱藏的智慧'},6:{score:75,type:'夢幻之愛',desc:'愛的幻想'},7:{score:65,type:'夜間旅程',desc:'迷霧中前進'},8:{score:75,type:'直覺力量',desc:'潛意識力量'},9:{score:85,type:'夜間智慧',desc:'潛意識智慧'},10:{score:75,type:'命運迷霧',desc:'不確定的命運'},11:{score:65,type:'隱藏真相',desc:'真相的迷霧'},12:{score:85,type:'潛意識探索',desc:'深入潛意識'},13:{score:80,type:'潛意識死亡',desc:'深層轉變'},14:{score:75,type:'情緒平衡',desc:'平衡情緒'},15:{score:85,type:'潛意識慾望',desc:'深層慾望'},16:{score:70,type:'幻象破滅',desc:'幻覺破滅'},17:{score:80,type:'夢想希望',desc:'夢中希望'},18:{score:90,type:'雙重幻象',desc:'共同的夢境'},19:{score:75,type:'月光日光',desc:'陰陽平衡'},20:{score:80,type:'潛意識覺醒',desc:'深層覺醒'},21:{score:80,type:'宇宙潛意識',desc:'集體潛意識'}},
            19: {1:{score:90,type:'光明關係',desc:'創造的光明'},2:{score:75,type:'光影關係',desc:'內外平衡'},3:{score:95,type:'陽光豐盛',desc:'最高的創造'},4:{score:85,type:'光明統治',desc:'開明的領導'},5:{score:80,type:'光明教導',desc:'開悟的教導'},6:{score:95,type:'光明之愛',desc:'純粹的愛'},7:{score:90,type:'勝利之光',desc:'光明的勝利'},8:{score:90,type:'光明力量',desc:'陽光的力量'},9:{score:70,type:'內外光明',desc:'內外的光'},10:{score:90,type:'幸運之光',desc:'光明的命運'},11:{score:85,type:'光明正義',desc:'真理之光'},12:{score:70,type:'黎明前夕',desc:'等待光明'},13:{score:80,type:'黑暗黎明',desc:'死亡後的光明'},14:{score:85,type:'光明和諧',desc:'陽光的和諧'},15:{score:75,type:'光影對比',desc:'極端對比'},16:{score:80,type:'破曉時分',desc:'破壞後的光明'},17:{score:95,type:'光明希望',desc:'最高的希望'},18:{score:75,type:'月光日光',desc:'陰陽平衡'},19:{score:95,type:'雙重光明',desc:'光明的共鳴'},20:{score:90,type:'光明覺醒',desc:'光明的覺醒'},21:{score:95,type:'宇宙光明',desc:'宇宙的光輝'}},
            20: {1:{score:80,type:'覺醒關係',desc:'創造新開始'},2:{score:85,type:'覺醒關係',desc:'靈性覺醒'},3:{score:80,type:'新生關係',desc:'創造新生'},4:{score:80,type:'審判關係',desc:'權力的審判'},5:{score:85,type:'精神覺醒',desc:'集體覺醒'},6:{score:80,type:'神聖結合',desc:'靈魂結合'},7:{score:80,type:'最終勝利',desc:'最終目標'},8:{score:85,type:'覺醒力量',desc:'覺醒的力量'},9:{score:80,type:'智慧覺醒',desc:'內在覺醒'},10:{score:85,type:'命運審判',desc:'最終審判'},11:{score:90,type:'最終審判',desc:'終極正義'},12:{score:80,type:'覺醒準備',desc:'準備覺醒'},13:{score:85,type:'最終轉化',desc:'終極重生'},14:{score:85,type:'神聖平衡',desc:'神聖和諧'},15:{score:75,type:'陰影覺醒',desc:'覺醒陰影'},16:{score:85,type:'覺醒震撼',desc:'震撼覺醒'},17:{score:90,type:'神聖希望',desc:'神聖指引'},18:{score:80,type:'潛意識覺醒',desc:'深層覺醒'},19:{score:90,type:'光明覺醒',desc:'光明覺醒'},20:{score:90,type:'雙重覺醒',desc:'共同覺醒'},21:{score:95,type:'最終完成',desc:'終極圓滿'}},
            21: {1:{score:85,type:'完成關係',desc:'創造圓滿'},2:{score:80,type:'智慧圓滿',desc:'內在完成'},3:{score:90,type:'圓滿豐盛',desc:'創造的最高境界'},4:{score:85,type:'完美統治',desc:'統治的最高境界'},5:{score:80,type:'智慧傳承',desc:'完整的智慧'},6:{score:90,type:'圓滿之愛',desc:'愛的最高境界'},7:{score:85,type:'完成征途',desc:'旅程完成'},8:{score:85,type:'圓滿力量',desc:'力量的最高境界'},9:{score:85,type:'智慧圓滿',desc:'智慧完成'},10:{score:85,type:'命運完成',desc:'命運圓滿'},11:{score:85,type:'宇宙正義',desc:'宇宙平衡'},12:{score:75,type:'完成等待',desc:'等待圓滿'},13:{score:80,type:'循環完成',desc:'生死圓滿'},14:{score:90,type:'宇宙和諧',desc:'宇宙平衡'},15:{score:70,type:'整合陰影',desc:'陰影整合'},16:{score:75,type:'破後重生',desc:'完全重建'},17:{score:90,type:'宇宙希望',desc:'宇宙祝福'},18:{score:80,type:'宇宙潛意識',desc:'集體潛意識'},19:{score:95,type:'宇宙光明',desc:'宇宙光輝'},20:{score:95,type:'最終完成',desc:'終極圓滿'},21:{score:95,type:'雙重圓滿',desc:'完美的完成'}}
          };

          const getCardName = (id) => cardDetails[id]?.name || '未知卡牌';

          const calculatePersonTarotCards = (date) => {
            const digits = date.replace(/-/g, '').split('').map(Number);
            let total = digits.reduce((sum, digit) => sum + digit, 0);
            
            while (total > 21) {
              const newDigits = total.toString().split('').map(Number);
              total = newDigits.reduce((sum, digit) => sum + digit, 0);
            }
            
            const soulCard = total;
            let personalityCard;
            
            if (soulCard < 10) {
              personalityCard = soulCard;
            } else {
              const personalityDigits = soulCard.toString().split('').map(Number);
              personalityCard = personalityDigits.reduce((sum, digit) => sum + digit, 0);
            }
            
            let shadowCard = 22 - soulCard;
            if (shadowCard <= 0) { // Should not happen if soulCard is 1-21
                 shadowCard = 1; // Default or error case
            } else if (shadowCard > 21) { // Only if soulCard is 0 (not standard)
                 shadowCard = 21;
            }
            // Ensure shadow card is always between 1 and 21 (or 0 for愚者 if applicable)
            // The provided compatibility matrix starts from 1.
            // If soulCard is 21, shadowCard is 1. If soulCard is 1, shadowCard is 21.

            return { soulCard, personalityCard, shadowCard };
          };

          const getCompatibility = (card1, card2) => {
            if (compatibilityMatrix[card1] && compatibilityMatrix[card1][card2]) {
              return compatibilityMatrix[card1][card2];
            }
            if (compatibilityMatrix[card2] && compatibilityMatrix[card2][card1]) {
              return compatibilityMatrix[card2][card1]; // Return symmetric result
            }
            return { score: 50, type: '中性關係', desc: '一段充滿未知與探索空間的關係。' }; // Default
          };

          const getOverallCompatibility = (soulComp, personalityComp, shadowComp) => {
            const avgScore = (soulComp.score + personalityComp.score + shadowComp.score) / 3;
            let level = '';
            let advice = '';
            
            if (avgScore >= 85) { level = '靈魂伴侶'; advice = '你們有著深刻的靈魂連結，彼此能夠相互理解和支持。這是一段具有巨大潛力的關係。'; }
            else if (avgScore >= 75) { level = '高度契合'; advice = '你們在多個層面上都有良好的共鳴，通過相互學習可以達到更深的連結。'; }
            else if (avgScore >= 65) { level = '互補成長'; advice = '你們的差異可以成為彼此成長的催化劑，關鍵是保持開放和理解。'; }
            else if (avgScore >= 55) { level = '挑戰與機遇'; advice = '這段關係需要更多的努力和理解，但也蘊含著深刻的成長機會。'; }
            else { level = '學習關係'; advice = '你們相遇是為了學習重要的人生課題，保持耐心和慈悲是關鍵。'; }
            
            return { avgScore: Math.round(avgScore), level, advice };
          };

          const handleAnalyze = () => {
            if (!person1Date || !person2Date || !person1Name || !person2Name) {
              alert('請填寫所有資訊');
              return;
            }
            
            const person1Cards = calculatePersonTarotCards(person1Date);
            const person2Cards = calculatePersonTarotCards(person2Date);
            
            const soulCompatibility = getCompatibility(person1Cards.soulCard, person2Cards.soulCard);
            const personalityCompatibility = getCompatibility(person1Cards.personalityCard, person2Cards.personalityCard);
            const shadowCompatibility = getCompatibility(person1Cards.shadowCard, person2Cards.shadowCard);
            
            const overall = getOverallCompatibility(soulCompatibility, personalityCompatibility, shadowCompatibility);
            
            setResult({
              person1: { name: person1Name, ...person1Cards },
              person2: { name: person2Name, ...person2Cards },
              compatibility: { soul: soulCompatibility, personality: personalityCompatibility, shadow: shadowCompatibility, overall }
            });
            setShowDetails({ soul: false, personality: false, shadow: false }); // Reset details view
          };

          const getScoreColor = (score) => {
            if (score >= 85) return 'text-green-600'; if (score >= 75) return 'text-blue-600';
            if (score >= 65) return 'text-yellow-600'; return 'text-orange-600';
          };
          const getScoreBg = (score) => {
            if (score >= 85) return 'bg-green-100'; if (score >= 75) return 'bg-blue-100';
            if (score >= 65) return 'bg-yellow-100'; return 'bg-orange-100';
          };

          return (
            <div className="max-w-4xl mx-auto p-4 sm:p-6 bg-gradient-to-br from-purple-100 via-pink-100 to-indigo-100 rounded-xl shadow-xl font-sans">
              <div className="text-center mb-8">
                <h1 className="text-3xl font-bold text-purple-800 mb-2 flex items-center justify-center gap-2">
                  <HeartIcon className="w-8 h-8" />
                  塔羅牌雙人兼容性分析
                </h1>
                <p className="text-gray-600">深入分析兩人的靈魂契合度、個性相容性與陰影整合潛力</p>
              </div>

              <div className="grid md:grid-cols-2 gap-6 mb-6">
                <div className="bg-white rounded-lg p-6 shadow-md">
                  <h3 className="font-semibold text-gray-800 mb-4 flex items-center gap-2">
                    <UsersIcon className="w-5 h-5" /> 第一位
                  </h3>
                  <input type="text" placeholder="姓名" value={person1Name} onChange={(e) => setPerson1Name(e.target.value)}
                    className="w-full px-4 py-2 border border-gray-300 rounded-md mb-3 focus:ring-2 focus:ring-purple-500"/>
                  <input type="date" value={person1Date} onChange={(e) => setPerson1Date(e.target.value)}
                    className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500"/>
                </div>
                <div className="bg-white rounded-lg p-6 shadow-md">
                  <h3 className="font-semibold text-gray-800 mb-4 flex items-center gap-2">
                    <UsersIcon className="w-5 h-5" /> 第二位
                  </h3>
                  <input type="text" placeholder="姓名" value={person2Name} onChange={(e) => setPerson2Name(e.target.value)}
                    className="w-full px-4 py-2 border border-gray-300 rounded-md mb-3 focus:ring-2 focus:ring-purple-500"/>
                  <input type="date" value={person2Date} onChange={(e) => setPerson2Date(e.target.value)}
                    className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500"/>
                </div>
              </div>

              <button onClick={handleAnalyze}
                className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-md hover:from-purple-700 hover:to-pink-700 transition-colors font-semibold">
                分析兼容性
              </button>

              {result && (
                <div className="mt-8 space-y-6 animate-fade-in">
                  <div className="grid md:grid-cols-2 gap-6">
                    <div className="bg-white rounded-lg p-6 shadow-md">
                      <h3 className="font-semibold text-gray-800 mb-4">{result.person1.name}的生命牌</h3>
                      <div className="space-y-2 text-sm">
                        <p><span className="font-medium">靈魂牌：</span>{result.person1.soulCard} - {getCardName(result.person1.soulCard)}</p>
                        <p><span className="font-medium">個性牌：</span>{result.person1.personalityCard} - {getCardName(result.person1.personalityCard)}</p>
                        <p><span className="font-medium">陰影牌 (22-Soul)：</span>{result.person1.shadowCard} - {getCardName(result.person1.shadowCard)}</p>
                      </div>
                    </div>
                    <div className="bg-white rounded-lg p-6 shadow-md">
                      <h3 className="font-semibold text-gray-800 mb-4">{result.person2.name}的生命牌</h3>
                      <div className="space-y-2 text-sm">
                        <p><span className="font-medium">靈魂牌：</span>{result.person2.soulCard} - {getCardName(result.person2.soulCard)}</p>
                        <p><span className="font-medium">個性牌：</span>{result.person2.personalityCard} - {getCardName(result.person2.personalityCard)}</p>
                        <p><span className="font-medium">陰影牌 (22-Soul)：</span>{result.person2.shadowCard} - {getCardName(result.person2.shadowCard)}</p>
                      </div>
                    </div>
                  </div>

                  <div className="bg-gradient-to-r from-purple-100 to-pink-100 rounded-lg p-6 text-center">
                    <h3 className="text-2xl font-bold text-purple-800 mb-2">總體兼容性：{result.compatibility.overall.level}</h3>
                    <div className={`text-4xl font-bold ${getScoreColor(result.compatibility.overall.avgScore)} mb-4`}>
                      {result.compatibility.overall.avgScore}%
                    </div>
                    <p className="text-gray-700 max-w-2xl mx-auto">{result.compatibility.overall.advice}</p>
                  </div>

                  <div className="space-y-4">
                    {[
                      { key: 'soul', title: '靈魂層面兼容性', icon: <Sparkles className="w-5 h-5 text-purple-600" />, cards: [result.person1.soulCard, result.person2.soulCard] },
                      { key: 'personality', title: '個性層面兼容性', icon: <StarIcon className="w-5 h-5 text-pink-600" />, cards: [result.person1.personalityCard, result.person2.personalityCard] },
                      { key: 'shadow', title: '陰影整合兼容性', icon: <MoonIcon className="w-5 h-5 text-indigo-600" />, cards: [result.person1.shadowCard, result.person2.shadowCard], info: "陰影牌代表需要整合的潛意識面向，兩人共同面對陰影可以帶來深層的療癒與成長。" }
                    ].map(item => (
                      <div key={item.key} className="bg-white rounded-lg p-6 shadow-md">
                        <div className="flex items-center justify-between cursor-pointer"
                             onClick={() => setShowDetails(prev => ({...prev, [item.key]: !prev[item.key]}))}>
                          <h3 className="font-semibold text-gray-800 flex items-center gap-2">{item.icon} {item.title}</h3>
                          <div className="flex items-center gap-2 sm:gap-4">
                            <span className={`text-lg sm:text-2xl font-bold ${getScoreColor(result.compatibility[item.key].score)}`}>
                              {result.compatibility[item.key].score}%
                            </span>
                            <span className={`px-2 py-1 sm:px-3 rounded-full text-xs sm:text-sm ${getScoreBg(result.compatibility[item.key].score)}`}>
                              {result.compatibility[item.key].type}
                            </span>
                            {showDetails[item.key] ? <ChevronUp /> : <ChevronDown />}
                          </div>
                        </div>
                        {showDetails[item.key] && (
                          <div className="mt-4 pt-4 border-t animate-fade-in">
                            <p className="text-gray-700 mb-2">{result.compatibility[item.key].desc}</p>
                            <div className="flex items-center gap-4 text-sm text-gray-600">
                              <span>{getCardName(item.cards[0])} ({item.cards[0]}) × {getCardName(item.cards[1])} ({item.cards[1]})</span>
                            </div>
                            {item.info && (
                              <div className="mt-3 p-3 bg-gray-50 rounded-lg">
                                <p className="text-sm text-gray-600 flex items-start">
                                  <InfoIcon className="w-4 h-4 inline mr-2 mt-1 flex-shrink-0" />
                                  <span>{item.info}</span>
                                </p>
                              </div>
                            )}
                          </div>
                        )}
                      </div>
                    ))}
                  </div>

                  <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-6">
                    <h3 className="font-semibold text-gray-800 mb-4 flex items-center gap-2">
                      <AlertCircleIcon className="w-5 h-5" /> 關係發展建議
                    </h3>
                    <div className="space-y-3 text-sm text-gray-700">
                      <p>• <strong>靈魂連結：</strong>定期進行深度對話，分享內心的夢想和恐懼，探索你們靈魂牌之間的共鳴與課題。</p>
                      <p>• <strong>個性互動：</strong>欣賞並學習彼此個性牌的優點，尊重差異，將其視為學習和共同成長的機會。</p>
                      <p>• <strong>陰影整合：</strong>當衝突出現時，觀察是否觸發了彼此陰影牌所代表的面向。這為雙方提供了共同療癒的機會。</p>
                      <p>• <strong>共同成長：</strong>設定共同的靈性或個人成長目標，利用你們牌組的綜合力量，相互支持，共同進化。</p>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // --- MAIN APP COMPONENT ---
        const App = () => {
          const [activeCalculator, setActiveCalculator] = useState('birth'); // 'birth' or 'compatibility'

          const navButtonBaseClass = "px-4 py-2 sm:px-6 sm:py-3 rounded-lg font-semibold transition-all text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-offset-2";
          const activeNavButtonClass = "bg-purple-600 text-white shadow-lg transform scale-105 focus:ring-purple-500";
          const inactiveNavButtonClass = "bg-white text-purple-700 hover:bg-purple-100 focus:ring-purple-400";
          
          return (
            <div className="container mx-auto p-4 min-h-screen">
              <nav className="text-center mb-6 sm:mb-10 p-4 bg-purple-200 rounded-lg shadow-md">
                <div className="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4">
                    <button 
                        onClick={() => setActiveCalculator('birth')}
                        className={`${navButtonBaseClass} ${activeCalculator === 'birth' ? activeNavButtonClass : inactiveNavButtonClass}`}
                    >
                        <Sparkles className="inline-block w-5 h-5 mr-2" /> 個體生命靈數
                    </button>
                    <button 
                        onClick={() => setActiveCalculator('compatibility')}
                        className={`${navButtonBaseClass} ${activeCalculator === 'compatibility' ? activeNavButtonClass : inactiveNavButtonClass}`}
                    >
                        <HeartIcon className="inline-block w-5 h-5 mr-2" /> 雙人兼容性分析
                    </button>
                </div>
              </nav>

              {activeCalculator === 'birth' && <TarotBirthCardsCalculator />}
              {activeCalculator === 'compatibility' && <TarotCompatibilitySystem />}
              
              <footer className="text-center text-gray-500 mt-12 pb-6 text-sm">
                塔羅靈數工具 © {new Date().getFullYear()}
              </footer>
            </div>
          );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
