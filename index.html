```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>塔羅生命靈數與運勢計算器</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        
        /* Tarot card image styles */
        .tarot-card-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .tarot-card-image:hover {
            transform: scale(1.05);
        }

        /* Loading state */
        .image-loading {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        body {
            background-color: #f3e8ff; /* Light purple background for the whole page */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, Fragment, useMemo, useRef } = React;

        // --- SHARED ICON COMPONENTS ---
        const Calendar = () => <span>📅</span>;
        const Sparkles = ({ className }) => <span className={className}>✨</span>;
        const Hash = ({ className }) => <span className={className}>#</span>;
        const User = ({ className }) => <span className={className}>👤</span>;
        const BookOpen = () => <span>📖</span>;
        const ChevronDown = ({ className }) => <span className={className}>▼</span>;
        const ChevronUp = ({ className }) => <span className={className}>▲</span>;
        const Gift = ({ className }) => <span className={className}>🎁</span>;
        const Shield = ({ className }) => <span className={className}>🛡️</span>;
        const HeartIcon = ({ className }) => <span className={className}>💖</span>;
        const UsersIcon = ({ className }) => <span className={className}>👥</span>;
        const MoonIcon = ({ className }) => <span className={className}>🌙</span>;
        const StarIcon = ({ className }) => <span className={className}>⭐</span>;
        const AlertCircleIcon = ({ className }) => <span className={className}>⚠️</span>;
        const InfoIcon = ({ className }) => <span className={className}>ℹ️</span>;
        const BrainIcon = () => <span>🧠</span>;
        const ClockIcon = () => <span>🕰️</span>;
        const SunIcon = () => <span>☀️</span>;
        const TargetIcon = () => <span>🎯</span>;

        // --- SHARED CARD DETAILS ---
        const cardDetails = {
          0: {
            name: '愚者',
            shortMeaning: '純真、勇氣、無限可能、新的開始',
            soulMission: '0號愚者作為靈魂卡牌，您的核心使命是踏上一場偉大的英雄之旅，學習無條件信任宇宙的引導，帶著純真的心和無畏的勇氣去擁抱生命中無限的可能性，並活在當下。這份信任並非盲目或天真，而是一種高度的靈性修為，是放下小我對結果的控制欲，全然相信每一步都蘊含著神聖的指引。您的內在潛能包括不受限的創造力、敏銳的直覺以及與神性直接連結的能力。您的靈魂渴望自由探索，並在每一次看似偶然的冒險中，發現深刻的智慧與生命的喜悅。您的任務是向世界證明，當一個人帶著全然的信任和開放的心投入生命之流時，宇宙會在其腳下鋪設道路。您需要學會聆聽那超越邏輯的內在衝動，將每一次失足都視為學習跳舞的契機。',
            personalityTrait: '個性上，愚者展現為充滿好奇心、樂觀積極且富有感染力的冒險家，是人群中永遠的“新鮮空氣”。您傾向於憑直覺行事，勇於嘗試新事物，不喜歡墨守成規或受到任何形式的束縛。在心理層面，這代表您與內在的“神聖孩童”保持著緊密連結，保有著那份未受世俗污染的原始智慧與驚奇感。您的思維不受傳統框架限制，能夠產生“跳躍式”的連結，這使您成為天生的創意工作者、發明家或任何需要突破性思維領域的先驅。您的天賦在於創新思維、開闢新道路和為周圍帶來輕鬆活潑的氛圍。您提醒著世界，生命本質上是一場充滿樂趣的遊戲，而非沉重的負擔。在社交場域中，您是那個能瞬間打破僵局、帶來歡笑與新奇觀點的人。',
            challenges: '愚者的主要挑戰在於將這份飄逸的能量“落地”。可能缺乏長遠規劃、容易因一時衝動而忽略現實後果、難以承擔長期的責任或完成既定任務。這種對自由的極致追求，在陰影面可能演變成一種對責任的恐懼與逃避，導致在關係、事業或學業上留下許多未竟之事。有時可能過於天真爛漫，不願面對現實的嚴肅面，或在自由與紀律之間難以取得平衡。需要學習在擁抱自由的同時，也腳踏實地，並為自己的選擇與行動全然負責，避免不必要的風險。成長的關鍵在於學習“有意識的愚者”之道：在躍下懸崖前，懂得檢查降落傘是否完好；在享受旅途的同時，也清楚自己的大致方向。學會將熱情投入到一個能貫穿始終的項目中，將是您靈魂成熟的重要標誌。'
          },
          1: {
            name: '魔術師',
            shortMeaning: '創造力、意志力、顯化、溝通',
            soulMission: '1號魔術師的靈魂使命是成為連接天地能量的橋樑，深刻理解“心想事成”背後的運作法則，學習運用高度集中的意志力和清晰的意圖，將靈界的靈感與個人潛能顯化為物質世界的現實。您的靈魂渴望掌握創造的法則，自信地運用天賦與資源去實現目標，成為自身實相的積極創造者，而非被動的接受者。您的內在潛能包括強大的創造力、如雷射般集中的意志、以及整合宇宙四元素（思想、情感、行動、物質）的智慧。您在此生的功課是學習如何成為一個純淨的管道，讓創造的能量通過您，服務於一個清晰且有益的目標，體驗到作為“共同創造者”的無上喜悅。',
            personalityTrait: '個性上，魔術師展現出自信、魅力、足智多謀和目標導向的特質，天生具備將想法付諸實踐的驅動力。您善於溝通說服，擁有卓越的規劃與執行能力，能夠有效地運用手邊的任何資源達成目的。在心理層面，象徵著有意識的自我（Ego）的成熟與力量，代表清晰的思維和實現個人意志的強大能力。您的天賦在於化腐朽為神奇，將不可能變為可能，是天生的創業者、演說家、銷售員或任何需要將抽象概念具象化的角色。您相信“方法總比問題多”，並能以積極的心態感染和引導他人，清晰地闡述願景，並將其分解為可執行的步驟。',
            challenges: '魔術師的挑戰在於個人意志的“陰影面”。可能過度依賴個人意志，導致操控傾向、自負、甚至為了達成目的而不擇手段，成為巧言令色的欺騙者。有時可能因為想掌控一切而感到過度焦慮，或因害怕失敗而不敢真正施展才華，僅僅停留在“紙上談兵”的階段。需要警惕語言的誤用（如欺騙、誇大或操縱），並學習將個人意志與更高的智慧（或集體福祉）相結合。真正的力量不在於控制，而在於引導。當您的行動不僅僅為了滿足自我，而是為了服務於更廣泛的益處時，您的顯化能力將會達到巔峰。課題是區分自信與自大，並學會在專注目標的同時，對過程保持開放與信任。'
          },
          2: {
            name: '女祭司',
            shortMeaning: '直覺、潛意識、神秘智慧、靜默',
            soulMission: '2號女祭司的靈魂使命是深入探索內在世界的神秘領域，成為潛意識海洋的守護者與潛航員。您要學習超越二元對立的思維，連結潛意識的龐大智慧與宇宙的奧秘，成為內在與外在知識之間那道神聖的門扉。您的靈魂渴望發展深邃、精準的直覺力，學會聆聽內心最細微的聲音，並在靜默中接收超越語言的啟示。您的靈性潛能包括超凡的直覺、洞察力、預知夢境、以及直接下載宇宙集體意識信息的能力。您的任務是守護這份神聖的知識，並在適當的時機，以神秘而隱晦的方式，將智慧傳遞給準備好接收的人，成為一位無言的靈性導師。',
            personalityTrait: '個性上，女祭司表現為神秘、內斂、沉靜且具有深不可測的深度。您傾向於觀察與反思，而非直接行動，喜歡獨處以連結內在的能量。您對深層次的心靈交流和神秘學、心理學等領域極感興趣。在心理層面，代表潛意識的智慧、陰性接收原則以及對未知領域的敬畏與探索。您的天賦在於洞察事物的本質，能夠輕易看穿表面的虛飾，直達問題的核心。您像是擁有一面“真實之鏡”，能反映出他人內心深處的動機與真相。您散發著一種寧靜而強大的氣場，讓人不自覺地對您吐露心聲，尋求指引。',
            challenges: '女祭司的挑戰在於可能過度內向，沉浸在自己的內心世界裡，與現實生活產生脫節，或因情感的過度壓抑而顯得冷漠、難以親近。有時可能因害怕被誤解或智慧被濫用，而選擇徹底的沉默，隱藏真實的感受與洞見，錯失了將智慧付諸實踐的機會。在直覺與邏輯之間，您可能會經歷劇烈的掙扎，懷疑自己接收到的信息。需要學習將內在的智慧適當地表達和應用於現實世界，找到一種“翻譯”內在語言的方式。在獨處與社交之間找到健康的平衡，避免自我孤立，並信任自己有能力去分辨何時該分享、何時該靜默。'
          },
          3: {
            name: '女帝',
            shortMeaning: '豐饒、母性、創造、滋養與感官享受',
            soulMission: '3號女帝的靈魂使命是成為生命力、豐盛與無條件之愛的管道，全然地體現並散播宇宙的創造能量。您的靈魂渴望體驗並分享生活中的一切喜悅與美好，不僅在物質層面創造豐盛，更在情感與精神層面滋養自己與他人。您需要學習與大地母親（Gaia）的頻率校準，與自然的生長週期和諧共處。您的內在潛能是源源不絕的創造力、強大的療癒能量、以及與萬物生長節律的深度連結。您的任務是在地球上建立一個充滿愛、美與和諧的“伊甸園”，無論這個伊甸園是一個家、一個社群、一個藝術項目，還是一種生活態度。您是來慶祝生命本身的。',
            personalityTrait: '個性上，女帝展現出溫暖、關愛、慷慨且富有創造力的照顧者特質。您熱愛一切美好事物，享受美食、藝術、音樂等感官體驗，並具有將任何平凡事物變得更美好的天賦。在心理層面，象徵著創造力、無條件的愛、以及接納與包容的母性原型。您擅長營造和諧、舒適、滋養的環境，無論身在何處，都能讓人感到放鬆與被接納。您能自然地吸引豐盛來到生命中，因為您從內心深處相信宇宙是富足的。您是天生的藝術家、園丁、廚師、治療師，或任何能為世界帶來美與滋養的角色。',
            challenges: '女帝的挑戰在於豐盛能量的失衡。可能過度沉溺於物質享受與感官逸樂，變得懶散、奢侈或過度放縱。在人際關係中，可能因過度保護或控制所愛的人而演變成“窒息的愛”，或因情感氾濫而缺乏健康的個人邊界感。有時可能在付出與接受之間嚴重失衡，不斷地給予而忽略了自我照顧，導致耗竭；或者因為害怕匱乏而緊抓不放，阻礙了豐盛的流動。需要學習設定健康的界線，明白真正的愛是允許他人獨立成長。同時，要將強大的創造力導向有意識的、建設性的方向，而非僅僅是無節制的享樂，找到付出與自我滋養的完美平衡。'
          },
          4: {
            name: '皇帝',
            shortMeaning: '權威、結構、穩定、領導與秩序',
            soulMission: '4號皇帝的靈魂使命是在物質世界中學習建立穩固、持久且有益的結構與秩序，成為一位充滿智慧、負責任且公正的領導者。您的靈魂渴望將混亂轉化為條理，將願景構建成可行的藍圖，並運用權威來保護、建設與維護一個安全穩定的環境。您需要發展卓越的自律精神、堅定的責任感、高瞻遠矚的策略思維以及在混亂中建立秩序的智慧。您的任務不僅是為自己建立王國，更是要創造一個能讓他人安心成長與發展的系統，成為社會的中流砥柱，體現神聖的陽性原則——那份創造穩定與安全的父性力量。',
            personalityTrait: '個性上，皇帝展現出權威、務實、有組織且具決斷力的領導者特質。您重視規則、效率和目標達成，擁有強大的執行力與與生俱來的責任感。您相信“沒有規矩，不成方圓”，並以此為準則行事。在心理層面，代表陽性原則、邏輯思維、社會規範以及掌控外在局面的能力。您的天賦在於建立系統、制定長遠計劃並有效地管理資源與人員。您是天生的管理者、創業者、政治家或任何需要結構性思維與領導力的角色。在他人眼中，您是可靠的、值得信賴的靠山，能夠在危機時刻保持冷靜，指明方向。',
            challenges: '皇帝的挑戰在於權威的僵化。可能過於固執己見、缺乏彈性或控制慾過強，導致專斷獨行，聽不進不同的意見。有時可能因害怕失控而過度壓抑自己和他人的情感，將生活變得像一部精密的機器，缺乏溫情與人性。因為追求完美與效率，可能對自己和他人過於嚴苛，成為一位暴君而非明君。需要學習在權威與仁慈之間取得平衡，在堅持原則的同時，保持靈活的適應性。真正的力量不僅在於掌控，也在於賦權。學會聆聽他人的意見，適應變化，並理解秩序的最終目的是為了服務生命，而非扼殺創造力與情感的流動。'
          },
          5: {
            name: '教皇',
            shortMeaning: '精神指引、傳統、教育、信仰與規範',
            soulMission: '5號教皇的靈魂使命是成為智慧的傳承者與道德的指引者，在精神信仰與物質社會之間建立一座堅實的橋樑。您的靈魂渴望探索並分享那些經得起時間考驗的真理與信仰體系，遵循並傳播有益於集體意識成長的傳統與規範。您的任務是將高深的智慧“翻譯”成普通人能夠理解和遵循的語言與儀式，為迷茫者提供結構性的精神指引。您的靈性潛能包括卓越的教導能力、諮詢天賦、以及對集體智慧和文化傳承的深刻理解。您是來幫助人們找到歸屬感與生命意義，將個體與更大的社群、傳統和信仰連結起來。',
            personalityTrait: '個性上，教皇展現出傳統、有原則、重視道德且具有教導傾向的特質。您喜歡探索事物的深層意義，對歷史、哲學、宗教等領域有濃厚興趣，尋求知識，並樂於將所學系統化地分享出去。在心理層面，代表著超我（Superego）、良知以及對更高意義和社群歸屬感的追尋。您通常是值得信賴的顧問、老師或導師，能夠提供有結構、有步驟的指引。您尊重權威和既定體系，相信通過學習和遵循前人智慧，可以少走彎路。您是團體中的“定心丸”，為組織提供價值觀和行為準則。',
            challenges: '教皇的挑戰在於可能過於固守傳統、墨守成規，或變得教條主義、思想僵化，批判性過強。有時可能因為害怕偏離既定的規範而扼殺創新精神，或將個人的信念體系當作唯一的真理，強加於人，缺乏包容性。在陰影面，可能變成一個“偽善者”，說一套做一套，或是盲目地崇拜權威而喪失獨立思考的能力。需要學習區分盲從與智慧傳承的區別，保持思想的開放性，並理解所有教條的最終目的都是為了引導人通向內在的智慧，而非成為新的枷鎖。學會尊重個體的自由意志與不同的人生道路，明白真理有多種樣貌，是您成熟的關鍵。'
          },
          6: {
            name: '戀人',
            shortMeaning: '愛情、選擇、關係、價值觀與和諧',
            soulMission: '6號戀人的靈魂使命是深刻地學習愛的真諦，這不僅僅指浪漫愛情，更包含對自我不同面向的愛與整合。您需要在各種關係（親情、友情、愛情）中實現個人的完整與平衡，並根據內心最真實的價值觀做出重大的生命抉擇。您的靈魂渴望體驗深刻的連結、共鳴與和諧，並在愛與被愛的雙向流動中療癒與成長。您需要發展出愛的能力、在十字路口做出明智選擇的智慧，以及整合內在陽性與陰性、理性與感性等對立面的能力。您的終極任務是達成內在的“神聖婚姻”，從而能在外在世界中建立真正健康、平等的夥伴關係。',
            personalityTrait: '個性上，戀人展現出迷人、友善、善於交際且極度重視人際關係的特質。您渴望和諧，注重美感，天生就懂得如何建立連結與促進合作。在做決定時，您會本能地考慮他人的感受與關係的整體和諧。在心理層面，這張牌代表著整合內心不同面向（如阿尼瑪與阿尼姆斯）的過程、對深刻連結的渴望以及個人價值觀的形成與確立。您通常是團隊中受歡迎的“黏著劑”，能夠促進團隊合作與溝通。您對美與和諧有著敏銳的感知力，無論是在人際互動還是藝術創作中都能體現出來。',
            challenges: '戀人的挑戰在於選擇的困境與關係的依賴。在面對重要的生命選擇時，您可能因為害怕做出錯誤決定而陷入長時間的猶豫不決，或是過度依賴他人的意見而失去主見。在關係中，可能因過度追求表面的和諧而壓抑、犧牲自己真實的感受與需求，或者在情感中迷失自我，界線不清。對承諾可能感到恐懼，害怕選擇了一方就意味著永遠失去另一方的可能性。需要學習為自己的選擇勇敢地負起責任，並忠於內心最深處的價值觀，即使這意味著可能會產生暫時的衝突。發展獨立性和清晰的自我認知是您此生的重要課題，學會先與自己戀愛，才能擁有健康的對外關係。'
          },
          7: {
            name: '戰車',
            shortMeaning: '決心、勝利、掌控方向、意志力與行動',
            soulMission: '7號戰車的靈魂使命是學習駕馭內在的矛盾力量——如同駕馭兩匹方向相反的黑白 Sphinx（人面獅身獸），以鋼鐵般的意志力和高度專注的行動力，克服內外在的重重障礙，朝向一個明確、有價值的目標勇敢前進，並最終贏得世俗與心靈的雙重勝利。您的靈魂渴望體驗到通過自律與整合，完全掌控自我與環境的強大力量。您的靈魂潛能是無堅不摧的意志力、卓越的自律精神以及整合對立力量（如情感與理智、野心與耐心）以達成宏大目標的能力。您的任務是證明，堅定的意志是穿越人生戰場、達成使命的最強大武器。',
            personalityTrait: '個性上，戰車展現出決心堅定、目標導向、充滿自信且富有競爭力的特質。您是天生的行動派，一旦設定目標，便會全力以赴，不達目的誓不罷休。您勇於面對挑戰，享受克服困難帶來的成就感，並渴望獲得勝利與公眾的認可。在心理層面，代表著強大的自我（Ego）力量的展現、意志力的有效運用以及成功克服內心衝突的過程。您的天賦在於領導眾人衝鋒陷陣，完成艱難的任務。您是項目經理、運動員、軍事領袖的絕佳原型，總能在高壓環境下保持專注，驅動自己和團隊向前。',
            challenges: '戰車的挑戰在於意志力的過度使用與方向的偏失。可能變得過度好鬥、缺乏耐心，或為了追求目標而不顧一切，忽略他人的感受與需求，給人以冷酷、橫衝直撞的印象。有時可能因意志力過強而顯得固執己見，無法聽取忠告；或反過來，因害怕失敗而將自己“包裹”在堅硬的盔甲之下，逃避真正的挑戰。需要學習平衡野心與同情心，控制內心的衝動，並時常反思：自己前進的方向是否真的符合內心最高的價值與益處，而非僅僅是出於自我的征服慾。學會慢下來，聆聽內在的聲音，確保您的“戰車”行駛在正確的道路上，是成熟的關鍵。'
          },
          8: {
            name: '力量',
            shortMeaning: '內在力量、勇氣、耐心、慈悲與整合本能',
            soulMission: '8號力量的靈魂使命是發現並運用內在真正的力量——那並非來自肌肉或強權，而是源於愛、勇氣、耐心與慈悲的力量。您需要學習去溫柔地“馴服”內在的野獸，即我們的原始本能、激情、恐懼與憤怒，將其從具有破壞性的衝動轉化為源源不絕的生命力與創造力。您的靈魂渴望以柔克剛，以溫柔而堅定的方式克服內外挑戰，展現出靈魂的堅韌與優雅。您的靈性潛能包括深厚的內在勇氣、強大的情緒療癒能力和不動聲色化解衝突的智慧。您的任務是向世界展示，真正的強大在於整合而非壓抑，在於慈悲而非控制。',
            personalityTrait: '個性上，力量展現出溫和而堅定、富有耐心、同情心且具有強大安撫人心的特質。您不喜歡用外在的強勢或音量來取勝，而是以內在的毅力、沉著與慈悲來影響和引導他人。在心理層面，這代表著本能（Id）與超我（Superego）的和諧整合，是情緒成熟、內心和諧的象徵。您的天賦在於在困境中保持冷靜與韌性，能夠安撫激動的人群，療癒受傷的心靈。您是天生的治療師、諮詢師、教師或任何需要耐心與同理心的角色。您身上散發出一種寧靜的自信，讓人感到安全與被理解。',
            challenges: '力量的挑戰在於“溫柔”的陰影面。可能因過度壓抑自身的需求與正常的憤怒情緒，以維持表面的和平與形象，導致內在能量的瘀堵。或因害怕衝突而逃避必要的對抗，難以設定健康的個人界線，最終導致自我消耗或被他人利用。有時，您可能會懷疑自己內在的力量，錯誤地認為只有外在的強硬才算強大。需要學習平衡溫柔與堅定，肯定自我價值，並在適當的時候展現果斷，“溫柔地說不”。明白真正的力量並非軟弱，它包含著在需要時展示獠牙以保護自己和所愛之人的勇氣。學會擁抱並健康地表達自己的全部情緒，是您力量完全綻放的關鍵。'
          },
          9: {
            name: '隱士',
            shortMeaning: '內省、尋求真理、智慧、指引與獨處',
            soulMission: '9號隱士的靈魂使命是通過深入的內在探索、反思與獨處，點亮內在智慧的提燈，尋求並獲得關於生命、宇宙與自我的深刻真理。您的旅程是向內的，而非向外的。在遠離塵世喧囂的靜默中，與您內在的導師（Higher Self）建立穩固的連結。當您自身的智慧之光足夠明亮時，您的下一個任務便是成為他人生命旅程中的指路明燈，以溫和、不干預的方式，為後來者照亮前方的道路。您需要發展在孤獨中汲取智慧而非陷入孤僻的能力，以及用溫和低調的方式分享深刻洞見的靈性指導能力。您是真理的尋求者，最終成為智慧的給予者。',
            personalityTrait: '個性上，隱士展現出內省、沉靜、智慧且享受獨處的深度思考者特質。您不追求外在的社交喧囂，更傾向於探索事物的本質與背後的深刻意義。您是人群中的“老靈魂”，對膚淺的談話不感興趣。在心理層面，代表著對內在智慧的追尋、審慎的態度以及高度獨立思考的能力。您的天賦在於提供深刻的、經過深思熟慮的洞見與指導。您是天生的學者、研究員、哲學家或靈性顧問。別人遇到複雜難解的問題時，會來尋求您的意見，因為您總能從一個更高、更宏觀的角度提供獨到的見解。',
            challenges: '隱士的挑戰在於可能過度孤立自我，與社會和現實生活脫節，或因過度沉思而變得悲觀、憤世嫉俗或猶豫不前，錯失行動的良機。有時可能因害怕被外界打擾或智慧被誤解，而將自己封閉起來，拒絕與人分享寶貴的智慧，變成一個孤僻的怪人。由於追求智慧的標準極高，可能對自己和他人顯得過於挑剔。需要學習在獨處充電與融入社群之間找到健康的平衡，將內在的智慧應用於實際生活，而不只是停留在腦海裡。學會信任他人的成長過程，用更輕鬆、更具互動性的方式分享您的光，而非僅僅是站在山頂上遙遙指引。'
          },
          10: {
            name: '命運之輪',
            shortMeaning: '命運轉變、機會、週期、轉捩點與順應潮流',
            soulMission: '10號命運之輪的靈魂使命是深刻理解並全然接受生命的週期性、無常變化與因果法則。您要學習在每一次起落浮沉中保持內在的中心與平靜，在命運的順境中保持謙遜，在逆境中保持希望。您的靈魂渴望順應宇宙的宏大節奏，而非與之抗衡，並在每一次轉變中找到靈性成長的機會與更深層的生命意義。您的靈魂潛能是卓越的適應能力、洞察生命週期背後運作模式的智慧，以及在關鍵時刻把握時機的能力。您的任務是成為一個活生生的例子，證明真正的自由並非控制命運，而是在命運的輪轉中，保持覺知，優雅共舞。',
            personalityTrait: '個性上，命運之輪展現出樂觀、適應力強、具有哲學思維且樂於接受改變的特質。您通常能從容應對生活中的突如其來，並本能地從中看到新的可能性與契機。您對“運氣”、“同步性”和“命運”等概念有著天生的理解。在心理層面，代表著對生命循環往復的認知、對未知的好奇心，以及相信“一切都是最好的安排”的根本信念。您擅長抓住機會，隨遇而安，是那種“總在對的時間出現在對的地點”的人。您的人生往往充滿了戲劇性的轉折和有趣的巧合，您也樂在其中，視其為一場宏大的冒險。',
            challenges: '命運之輪的挑戰在於可能在主動與被動之間失衡。可能過度依賴“運氣”或“命運”而缺乏主動創造的意願，變得消極宿命。或在面對逆境時，感到徹底的無力，完全聽天由命，放棄了自己可以努力的部分。另一方面，可能因害怕錯過任何一個機會而變得焦躁不安，追逐每一個可能性，結果在不斷的變化中缺乏穩定性與扎根感，無法積累任何實質性的成果。需要學習在順應宇宙大潮流的同時，也穩穩地掌好自己的小船之舵，在可控的範圍內積極行動。從每一次的順逆循環中學習寶貴的經驗，建立內在永恆不變的定力，這才是您真正的財富。'
          },
          11: {
            name: '正義',
            shortMeaning: '公正、平衡、真理、因果法則與責任',
            soulMission: '11號正義的靈魂驅動力是追求並體現宇宙的絕對真理、公平與內外在世界的完美平衡。您的生命目標是深刻理解並活出因果法則（Karma）的智慧，即：我們所有思想、言語和行為都會產生相應的結果。您被召喚為自己的所有選擇負起全部責任，並致力於在個人生活乃至更廣泛的社群中，創造一個更公正、透明與和諧的環境。您的潛能是如水晶般清晰的判斷力、不受個人情感偏見影響的無私客觀性，以及維護宇宙平衡的堅定意志。您的任務是成為真理的代言人與平衡的守護者。',
            personalityTrait: '作為個性卡牌時，您展現出強烈的公平正義感、清晰的邏輯思維和高度的誠實與正直。您極度重視事實、證據與邏輯，力求在任何情況下都保持客觀中立，並期望他人也能如此。在做決定時，您會仔細權衡所有利弊，追求最合理、最公平的解決方案。在早期，您可能因為對真理的執著而顯得過於理想化或不善變通，但在成熟期，您則能成為他人極為信賴的道德指南針、可靠的仲裁者與顧問，總能以理服人，清晰地剖析複雜問題的根源。您是法律、科學、會計或任何需要精確與公正領域的理想人選。',
            challenges: '正義的挑戰在於可能變得過度嚴厲、批判、缺乏彈性或不近人情，成為一台冰冷的“審判機器”。您對自己或他人可能有不切實際的完美標準，這會導致過度的自我批評或對他人吹毛求疵，難以原諒錯誤。在追求絕對公平的過程中，有時會忽略人類情感的複雜性與個體差異，顯得冷酷無情。需要學習在理智與情感、公正與慈悲之間取得精妙的平衡。理解“法理不外乎人情”，學會寬恕（對自己和他人），是您重要的功課。真正的智慧不僅在於看到黑與白，更在於理解并接納其間廣闊的灰色地帶，避免陷入僵化的律法主義。'
          },
          12: {
            name: '倒吊人',
            shortMeaning: '犧牲、新視角、等待、臣服與頓悟',
            soulMission: '12號倒吊人的靈魂渴望通過自願的暫停、放下舊有觀念或在看似停滯的狀態中，來獲得更高層次的理解與靈性覺醒。您的生命目標是學習“臣服”的藝術，這不是消極的放棄，而是積極地將個人意志與宇宙的更高意志校準，從而在全然的接納中體驗到內在的平靜與神聖的智慧。您的潛能是超凡的耐心、超越常規二元對立的洞察力，以及從逆境和等待中轉化出深刻智慧與頓悟的能力。您的任務是向世界展示，有時候，真正的進展發生在靜止之中，而放手，是為了獲得更多。',
            personalityTrait: '個性特徵上，您深具耐心與與眾不同的視角，善於反思，不畏懼從一個完全相反的角度去看待人和事。您能夠在逆境和漫長的等待中保持內心的平靜與成長。您的人生哲學往往與主流格格不入，但卻蘊含著深刻的智慧。在早期，您可能因為觀點獨特而感到與周圍世界格格不入，甚至被誤解。但隨著成熟，您可能成為一位具有非凡洞察力的精神導師、藝術家或思想家，幫助那些陷入僵局的人看到全新的可能性，打破他們的思維定式。您擁有一種“靜水流深”的魅力。',
            challenges: '倒吊人的挑戰在於可能將“臣服”誤解為“ निष्क्रिय”，陷入長期的拖延、被動等待、自我犧牲到失去自我的境地，或發展出無助的受害者心態。有時可能因為過於沉浸在自己的內在世界或獨特的觀點中，而與現實生活完全脫節，變得不切實際。需要學習區分必要的、有意識的臣服與無謂的、逃避責任的犧牲。在等待的過程中，要保持積極的內在探索與覺知，而非消極地停滯不前。設定清晰的界限，確保您的“犧牲”是為了更高目的的投資，而非自我價值的貶低。學會分辨何時該掛起，何時該把自己“放下來”採取行動，是智慧的體現。'
          },
          13: {
            name: '死神',
            shortMeaning: '結束與新生、轉變、放下、徹底改變',
            soulMission: '13號死神的靈魂使命是深刻理解並擁抱生命中無可避免的、持續發生的結束與開始的宏大循環。您被召喚去成為“轉化”的代理人，不僅要勇敢地協助自己放下所有不再服務於靈魂最高利益的人事物、信念和模式，也要在必要時引導他人完成他們生命中的重大蛻變。您的潛能是強大的轉化力、不執著的智慧，以及引導靈魂度過“死亡”（象徵性的終結）並迎來新生的能力。您的任務是去除所有非本質的東西，讓生命的真我得以重生，向世界證明，每一次終結都孕育著一個更加真實、更有活力的新開端。',
            personalityTrait: '個性表現為深具洞察力，不懼怕深刻的改變，甚至可能主動尋求或促成劇烈的轉變。您天生就能看透事物的本質，對於那些虛偽、過時或無益的關係與結構，您有著快刀斬亂麻的勇氣。在他人眼中，您可能是帶來重大轉折點的“催化劑”或“清道夫”，您的存在本身就會加速必要的終結。在早期，您的人生可能經歷比常人更多的變動、分離或失落，但這些經歷將錘煉出您非凡的韌性。成熟後，您能成為出色的危機處理專家、改革者或安寧療護者，幫助他人釋放舊有模式，安然度過轉變的陣痛。',
            challenges: '死神的挑戰在於對“結束”的恐懼或濫用。一方面，可能因為害怕未知的將來和失去的痛苦，而死死抓住早已腐朽、不再適合自己的人事物不放，從而極大地抗拒必要的改變，讓轉化的過程變得異常痛苦和漫長。另一方面，也可能反向而行，因為渴望改變而變得草率、魯莽，輕易地切斷尚未ถึง終點的關係或事業，造成不必要的破壞。有時可能顯得冷酷無情，或因沉溺於過去的失落感中而變得悲觀，難以真正向前邁進。需要學習以建設性的方式擁抱轉變，區分必要的終結與逃避性的割捨，並在過程中給予自己和他人足夠的哀悼與過渡時間，讓新生自然發生。'
          },
          14: {
            name: '節制',
            shortMeaning: '平衡、調和、整合、耐心與中庸之道',
            soulMission: '14號節制的靈魂尋求在所有層面——身體、心智、情感與精神上——達到完美的平衡、和諧與煉金術般的整合。您的生命目標是學會在看似對立的兩極力量（如物質與精神、內在與外在、行動與靜默、給予與接受）之間找到那條神聖的中道，並將它們巧妙地融合成一個更高階的、和諧的整體。您的潛能是卓越的調解能力、創造性的融合能力、以及實現身心靈深度整合的療癒天賦。您的人生是一場持續的“煉金實驗”，旨在將平凡的生命元素轉化為靈性的黃金，成為一個內外合一、寧靜而充滿力量的存在。',
            personalityTrait: '外在表現為一位天生的外交家、調和者與煉金術士。您擁有將不同甚至衝突的元素巧妙融合在一起的非凡能力，無論是調配一杯完美的雞尾酒，還是在爭吵的雙方之間促成和解。您通常心態平和，富有耐心，總能在複雜混亂的情況中找到那個精妙的平衡點與解決方案。您追求的是長期的、可持續的穩定與和諧，而非短暫的、極端的激情。您是那種能夠將多種才華或興趣融會貫通，創造出獨特事業或生活方式的人。您散發著一種寧靜致遠的氣質，讓人感到穩定與療癒。',
            challenges: '節制的挑戰在於可能為了維持表面的和諧而過度妥協，以至於失去自己的立場和聲音，變成一個“和事佬”或好好先生。在做決定時，可能因為想要完美地平衡所有因素而顯得猶豫不決，錯失良機。有時，對中庸之道的過度追求可能讓生活變得平淡、乏味，缺乏必要的激情與衝勁。您需要學習在必要的時候，能夠堅定地站在某一方，明白真正的平衡並非一成不變的靜止狀態，而是一個動態的、持續調整的過程。它有時需要加入一些“不和諧”的音符來創造出更豐富的樂章。學會擁抱必要的張力，而非一味地規避它，是您成長的關鍵。'
          },
          15: {
            name: '惡魔',
            shortMeaning: '慾望、束縛、物質主義、陰影面與誘惑',
            soulMission: '15號惡魔的靈魂課題是勇敢地潛入人性最深的層面，去理解、面對並整合自身的陰影面、原始慾望與根本恐懼。您的生命目標不是要消滅“惡魔”，而是要將其從無意識的、造成束縛的枷鎖，轉化為有意識的、可被駕馭的強大生命力與創造力。您需要通過直面那些被自己壓抑或否認的部分，來實現真正的自由。您的潛能是強大的、未經稀釋的生命力、洞察人性深層動機的銳利眼光，以及打破成癮模式、轉化內外束縛的無比勇氣。您的任務是找回自己被囚禁的力量，成為自己慾望的主人，而非奴隸。',
            personalityTrait: '個性特徵上，您可能充滿了強烈的激情、幽默感與生命活力，對物質世界有著極強的感受力和享受欲。您通常直接坦率，不懼世俗眼光，散發著一種原始的、極具吸引力的個人魅力。但也因此，您更容易受到各種誘惑的吸引，或陷入某種形式的執著之中。在早期，您的人生可能在極端的放縱與嚴苛的壓抑之間劇烈擺盪。成熟後，您則能學會以一種健康、有意識的方式去擁抱和駕馭自身強大的慾望，將其轉化為事業上的驅動力、藝術上的創造力或關係中的激情。您懂得人性的複雜，因此也更具幽默感與包容力。',
            challenges: '惡魔的核心挑戰在於容易陷入各種形式的“成癮”與“束縛”。這可以表現為物質成癮（菸酒、毒品）、情感依賴（不健康的關係）、權力慾、金錢崇拜，或是被限制性的信念和深層的恐懼所牢牢控制。您需要警惕自我欺騙和合理化不健康行為的傾向。勇敢地承認並面對內心的陰影——那些您不喜歡的、評判為“壞”的部分——是解放的第一步。學習區分能帶來快樂的健康慾望與導致痛苦的有害沉溺至關重要。真正的力量來自於看清鎖鏈，並意識到鑰匙一直在自己手中，而非試圖忽視或美化這個牢籠。'
          },
          16: {
            name: '塔',
            shortMeaning: '突變、覺醒、解放、舊結構瓦解與真相顯露',
            soulMission: '16號高塔的靈魂使命是成為神聖意志的“破壞者”，勇敢地去面對和推動那些必要的、顛覆性的瓦解。您被召喚去摧毀那些建立在虛假、自大、限制性信念或過時結構之上的生活模式，無論那是您內在的“心靈監獄”，還是外在不健康的工作或關係。其目的是為了給一個更真實、更穩固、更符合靈魂藍圖的基礎騰出空間，從而迎來一次深刻的、閃電般的覺醒與徹底的解放。您的潛能是帶來突破性改變的巨大勇氣、洞察真相核心的能力，以及在廢墟之上迅速重建的強大力量。您的任務是迎接和引導變革，即使它以毀滅的形式到來。',
            personalityTrait: '個性表現為擁有強大意志力與不破不立的氣魄。您可能是天生的變革者、革命家或“真相揭露者”，您的存在往往會無意中或有意地引發周圍環境、制度或人際關係的劇烈變動與危機。您無法容忍虛偽與停滯，會本能地去挑戰那些不再服務於真理的權威和結構。在早期，您的人生可能充滿了突如其來的意外、危機和顛覆性的事件，讓您不斷地“清零重來”。成熟後，您能有意識地運用這股力量，成為他人生命中轉機的催化劑，幫助他們打破僵局，獲得新生。',
            challenges: '高塔的挑戰在於可能經歷頻繁的、戲劇性的、令人痛苦的生活動盪，或因極力抗拒改變而讓那不可避免的崩塌變得更加慘烈。有時可能因過於直接、衝動或缺乏策略，而造成不必要的破壞，傷害到無辜的人。在陰影面，您可能會無意識地被混亂所吸引，甚至“上癮”，在生活中不斷製造戲劇性事件。您需要學習信任生命中突如其來的變革，即使它們看起來是毀滅性的，並從每一次“倒塌”中謙卑地汲取教訓。學會區分神聖的摧毀與小我的破壞，並在“拆除”之後，積極地投入到“重建”一個更符合真我的、更具彈性的新生活中。'
          },
          17: {
            name: '星星',
            shortMeaning: '希望、靈感、治癒、平靜與精神指引',
            soulMission: '17號星星的靈魂使命是在經歷了高塔般的混亂或挑戰之後，重新找回內心的純淨、寧靜與對宇宙的信任，並成為他人生命中的希望之光與靈感之泉。您的生命目標是將這份來自宇宙的、清澈的療癒能量，像星星在夜空中灑下光芒一樣，無私地傾瀉到世界上，傳播治癒、平靜與對未來的堅定信心。您的潛能是強大的能量療癒力、與更高指引（如指導靈、天使）的深邃連結，以及用藝術、話語或存在本身去鼓舞人心的能力。您的任務是提醒自己和他人，在最深的黑暗之後，必有星光閃耀，而希望本身就是一種強大的創造力量。',
            personalityTrait: '個性特質上，您通常樂觀、充滿希望、富有同情心，並對未來抱持著美好的憧憬。您可能擁有天生的療癒天賦或非凡的藝術才華（音樂、寫作、繪畫等）。您就像一個清澈的管道，能為周圍焦慮、沮喪的人帶來平靜、安慰與啟示，引導他們看到困境中的光明面和可能性。您的靈性成長方向是持續淨化自己，發展直覺和療癒能力，成為光與愛的工作者。早期可能顯得過於理想化、不切實際，但成熟後，您將成為他人風雨飄搖時可以仰望的、穩定而明亮的“北極星”。',
            challenges: '星星的挑戰在於可能因為過於理想化而與現實脫節，難以應對日常生活的瑣碎與醜陋。或在不斷給予他人希望與療癒能量時，忽略了自身的需求，導致能量耗竭與“慈悲疲勞”。有時，您可能因對未來抱持不切實際的幻想，一旦現實不如預期，便會陷入極大的失望與幻滅之中，甚至在逆境中短暫失去信心。需要學習在保持希望的同時，雙腳堅實地踩在大地上。學會在療癒他人的過程中，也為自己“充電”，設定健康的界限。真正的希望，是即使看清了世界的複雜與不完美，依然選擇相信光明。'
          },
          18: {
            name: '月亮',
            shortMeaning: '幻象、直覺、潛意識、恐懼與夢境',
            soulMission: '18號月亮的靈魂使命是勇敢地踏上通往潛意識深海的夜航，穿越內心最古老的恐懼、未解的情感與集體無意識的幻象，從而打撈出深刻的直覺智慧與創造力的珍珠。您的生命目標是學會信任那非理性的、超越語言的內在指引，即使在充滿迷霧與不確定的道路上。您是來成為意識與無意識世界之間的橋樑，將夢境的語言、象徵的啟示帶入現實。您的潛能是卓越的通靈級直覺力、如海洋般浩瀚的想像力、以及對人性陰影與集體神話的深刻理解。您的任務是走過這條迷人的、有時甚至是駭人的內在之路，並證明真正的智慧往往隱藏在最深、最暗的地方。',
            personalityTrait: '個性敏感、富有同情心、想像力極其豐富，並具有強烈的直覺力與超感官知覺（ESP）。您可能對夢境、象徵、神話、藝術和所有神秘事物都深感著迷。您像一塊海綿，能輕易地吸收周圍環境與他人的情緒。您的內心世界豐富多彩，充滿了各種奇異的景象與感受。早期，您可能因為難以區分真實的直覺與由恐懼產生的幻象而感到困惑、焦慮，情緒波動較大。但隨著成熟，您能學會駕馭這份天賦，成為深刻的藝術家、詩人、心理治療師、解夢者或靈媒，引導他人探索他們自己的內心迷宮。',
            challenges: '月亮的核心挑戰在於容易在幻象與現實之間迷失。您可能過度受到環境或他人負面情緒的影響，陷入週期性的焦慮、憂鬱、困惑或自我欺騙。內心深處未被正視的恐聞，可能會被投射到外界，導致您在關係或決策中做出非理性的選擇，或看到不存在的威脅。您需要學習建立清晰、堅固的個人能量邊界，並培養分辨幻象與真相的“內在偵探”能力。 grounding（扎根）練習對您至關重要。有意識地將潛意識的洞見用寫作、藝術等方式表達出來，將其帶入意識的光明之中，而不是被其淹沒，是您此生最重要的功課。'
          },
          19: {
            name: '太陽',
            shortMeaning: '快樂、成功、活力、清晰與生命力',
            soulMission: '19號太陽的靈魂使命是全然地、不帶歉意地展現內在的光明、喜悅與勃勃生機，成為純粹的愛與真理的活生生的化身，從而照亮自己和周圍的世界。您的生命目標是活出那個最真實、最燦爛的自我，毫不掩飾地去體驗並分享生命的豐盛、成功與單純的快樂。您來此是為了證明，當一個人与其核心本質完全合一時，生命本身就是一場慶典。您的潛能是無限的活力、如陽光般穿透一切迷霧的清晰洞察力、天生的領導魅力以及為他人帶來快樂、溫暖與啟迪的強大能力。您的任務就是：成為光，散發光。',
            personalityTrait: '外在表現為樂觀開朗、精力充沛、充滿自信與熱情，散發著領袖氣質和溫暖的感染力。您是人群中的“發光體”，您的出現總能驅散陰霾，帶來歡聲笑語。您通常能清晰地看到事物的本質，思路簡潔明了，並能以極其積極的態度面對生活的挑戰。您的生命課題是學會在任何困境中，都能與內在永不熄滅的光明與樂觀連結。在早期，可能顯得有些天真或以自我為中心，不理解他人的複雜情緒。但隨著成熟，您將成為一位卓越的激勵者、領導者和啟發者，用您的成功和喜悅去點燃他人的希望。',
            challenges: '太陽的挑戰在於光芒的過度與陰影。可能因為過度自信而變得自負、傲慢，或在享受成功的同時忽略了他人的貢獻與需求。或因害怕失去光芒、不再是眾人焦點而過度追求外界的掌聲與認可，活在“偶像包袱”之下。有時，您過於強大的能量可能顯得咄咄逼人，無意中“灼傷”了那些比較敏感的人。過度的樂觀也可能讓您低估困難，缺乏周詳的計劃。需要學習將個人的光芒與謙遜相結合，明白真正的太陽是照亮萬物，而非僅僅照耀自己。學會在享受成功的同時，保持對生命深層意義的覺察與對他人的同理心，讓您的光明既溫暖又滋養。'
          },
          20: {
            name: '審判',
            shortMeaning: '覺醒、重生、召喚、評估與寬恕',
            soulMission: '20號審判的靈魂使命是回應來自靈魂深處或宇宙更高意識的召喚，經歷一次深刻的、決定性的靈性覺醒與重生。這需要您對過往的人生進行一次徹底、誠實的評估，放下所有舊有的包袱、自我評判與對他人的怨恨，從而以一個全新的、更真實的身份，活出更有意義、更有使命感的生命。您的目標是協助自己和他人從舊有的、限制性的“墳墓”中解放出來，成為集體覺醒的催化劑。您的潛能是深刻的轉化力、接收和傳遞更高層次指引的清晰管道，以及促進個人與集體療癒和寬恕的能力。您是來宣告一個舊時代的結束和新紀元的開始。',
            personalityTrait: '個性上，您通常具有強烈的使命感和深刻的反思能力。您能感知到超越日常瑣碎生活的更高層次的召喚，並尋求人生的終極意義。您可能在生命中的某個關鍵時刻，扮演著喚醒他人、推動重大革新或對某個組織、家庭進行重要評估的角色。您對過去的經歷有著深刻的洞察力，不把它們看作錯誤，而是視為通往覺醒的必經之路，並尋求從中學習，以邁向全新的開始。您極度重視誠實、真相與自我負責，並期望他人也能如此。您是那種能做出重大人生轉變，並激勵他人也這麼做的人。',
            challenges: '審判的挑戰在於“評判”的陰影面。您可能過於嚴厲地評判自己過去的“罪過”，或對他人吹毛求疵，沉溺於過去的遺憾與悔恨中無法自拔，讓自己背負沉重的內疚感。有時，您可能因為害怕面對真相或即將到來的巨大改變，而刻意忽略或抗拒內心的召喚，繼續“裝睡”。也可能將自己的覺醒標準強加於人，變得急躁和不耐煩。您需要學習的關鍵課題是真正的“寬恕”——這是一種釋放，不僅是原諒他人，更是徹底地原諒自己。放下不必要的內疚感，以慈悲的心態來面對自己和他人的人生轉型期，並相信每個人都有自己的覺醒時間表。'
          },
          21: {
            name: '世界',
            shortMeaning: '完成、成就、整合、圓滿與宇宙意識',
            soulMission: '21號世界的靈魂使命是追求並達成生命旅程的圓滿完成與深度整合，在所有層面（物質、情感、心智、靈性）都達到一種和諧、豐盛與對宇宙一體意識的深刻了悟。您的生命目標是體驗到生命的完整性，將從愚者到審判所學到的一切課題融會貫通，並活在與萬物合一、自由舞動的喜悅之中。您的潛能是實現宏大人生目標的卓越能力、如宇宙般深廣的包容心，以及與宇宙節奏同頻共振、優雅共舞的智慧。您是來向世界展示，一個整合了所有經驗、達成了內在和諧的靈魂，是如何自由、成功、快樂地活在當下，並慶祝生命這場偉大的旅程的。',
            personalityTrait: '個性表現為具有開闊的、全球性乃至宇宙性的視野，強大的整合能力和深度的包容心。您能夠輕易地理解並欣賞生命的多樣性與不同文化、觀點的價值，並傾向於以一個宏大的、整體性的觀點來看待一切事物。您追求的是實質性的、有長遠意義的成就與內在的圓滿，而非短暫的虛榮。在生命的某個階段，當您完成了一個重要的生命週期（如學業、事業或個人成長），您會體驗到一種深刻的完成感、自由感與成就感。您是天生的整合者、全球公民、大型項目的完成者，能夠將複雜的元素編織成一幅美麗的織錦。',
            challenges: '世界的挑戰在於“完成之後”。在達到一個重要的里程碑或人生巔峰之後，您可能感到一種空虛，難以開啟一個全新的、充滿未知的篇章。或因為過於追求“完美”的圓滿而害怕行動，遲遲不肯為一個項目畫上句號。有時，您可能因為視野過於宏大而忽略了當下的細節和人際關係。在整合生命各個面向的過程中，也可能感到巨大的壓力與責任。需要學習在每一個“完成”之後，充分地慶祝、感恩，然後適時地放手，優雅地轉身，再次扮演“愚者”的角色，以歸零的心態迎接下一個全新的生命循環。理解圓滿並非一個終點，而是一個持續的、螺旋式上升的動態過程。'
          },
        };
        
        // --- SHARED CALCULATION FUNCTIONS ---
        const sharedSumDigits = (n) => {
            if (typeof n !== 'number' && typeof n !== 'string') return 0;
            return n.toString().split('').map(Number).reduce((a, b) => a + b, 0);
        };

        const sharedReduceToSingleDigit = (n) => {
            let num = n;
            while (num > 9) {
                num = sharedSumDigits(num);
            }
            return num;
        };
        
        // --- SHARED FORTUNE CARD CALCULATION LOGIC ---
        const sharedCalculateFortuneCards = (birthDate, targetYear, targetMonth) => {
            if (!birthDate || !targetYear || !targetMonth) return { yearlyCard: null, monthlyCard: null };
            
            const [bYear, bMonth, bDay] = birthDate.split('-').map(Number);
            const personalBase = sharedSumDigits(bYear) + bMonth + sharedSumDigits(bDay);
            const yearlyValue = personalBase + sharedSumDigits(targetYear);
            
            // Raw value is 1-22 for internal calculations
            let yearlyCardRaw = (yearlyValue > 0) ? (yearlyValue - 1) % 22 + 1 : 22;
            if (yearlyCardRaw === 0) yearlyCardRaw = 22; 
            // Final card ID for display (0 for Fool)
            const yearlyCardId = yearlyCardRaw === 22 ? 0 : yearlyCardRaw;

            const bDaySimplified = sharedReduceToSingleDigit(bDay);
            const monthlyAdjustment = bMonth + bDaySimplified;
            const monthlyValue = yearlyCardRaw + parseInt(targetMonth, 10) + monthlyAdjustment;
            
            let monthlyCardRaw = (monthlyValue > 0) ? (monthlyValue - 1) % 22 + 1 : 22;
            if (monthlyCardRaw === 0) monthlyCardRaw = 22;
            const monthlyCardId = monthlyCardRaw === 22 ? 0 : monthlyCardRaw;
            
            return { yearlyCard: yearlyCardId, monthlyCard: monthlyCardId };
        };

        // --- SHARED IMAGE PATH HELPER ---
        const cardFileNames = {
          0: '00愚者.png',
          1: '01魔术师.png',
          2: '02女祭祀.png',
          3: '03皇后.png',
          4: '04皇帝.png',
          5: '05教皇.png',
          6: '06恋人.png',
          7: '07战车.png',
          8: '08力量.png',
          9: '09隐士.png',
          10: '10命运之轮.png',
          11: '11正义.png',
          12: '12倒吊人.png',
          13: '13死神.png',
          14: '14节制.png',
          15: '15恶魔.png',
          16: '16高塔.png',
          17: '17星星.png',
          18: '18月亮.png',
          19: '19太阳.png',
          20: '20审判.png',
          21: '21世界.png'
        };

        const sharedGetCardImagePath = (cardId) => {
          if (cardId === null || cardId === undefined) return '';
          const fileName = cardFileNames[cardId];
          if (!fileName) return '';
          
          return `./Tarot Cards/${fileName}`;
        };

        // --- TAROT BIRTH CARDS CALCULATOR (Mary K. Greer System) ---
        const TarotBirthCardsCalculator = () => {
          const [birthDate, setBirthDate] = useState('');
          const [result, setResult] = useState(null);
          const [detailedReport, setDetailedReport] = useState(null);
          const [showProcess, setShowProcess] = useState(false);
          const [showInfo, setShowInfo] = useState(false);
          const [viewMode, setViewMode] = useState('simple');

          const TarotTheoryInfo = () => (
            <div className="mt-8 p-6 bg-white rounded-lg shadow-md space-y-6 text-gray-700 transition-all duration-500 ease-in-out">
              <h2 className="text-2xl font-bold text-purple-800 text-center flex items-center justify-center gap-2">
                <BookOpen /> 塔羅生命靈數系統深度解碼
              </h2>
              
              <section>
                <h3 className="text-xl font-semibold text-purple-700 mb-2">靈魂藍圖與個性表現的深度解碼</h3>
                <p className="text-base leading-relaxed">
                  塔羅牌生命靈數系統揭示了每個人獨特的靈魂藍圖和人生使命，透過出生日期計算得出的大阿爾卡納牌，能深入理解個人的內在本質與外在表現。這套系統不僅是占卜工具，更是一份詳盡的自我成長地圖。每個人都擁有代表靈魂核心的「靈魂卡牌」和展現今生學習課題的「個性卡牌」，這兩張牌的互動關係描繪出個人從出生到死亡的生命主題。
                </p>
              </section>

              <section>
                 <h3 className="text-xl font-semibold text-purple-700 mb-2">理論架構與計算方法</h3>
                 <p className="text-base leading-relaxed mb-2">
                  此計算器採用 Mary K. Greer 的方法：將出生日期的所有數字相加，如果總和大於21，則繼續將結果的數字相加，直到小於或等於21為止。
                 </p>
                 <div className="bg-blue-50 rounded-lg p-4 text-sm text-blue-800">
                      <p className="font-semibold mb-1">計算範例：</p>
                      <ul className="list-disc list-inside space-y-1">
                        <li><b>靈魂卡牌</b>：將出生日期的每個數字相加（例：2000-08-05 → 2+0+0+0+0+8+0+5 = 15）。如果總和大於21（例：1992-02-21 → 26），持續將數字相加直到小於等於21（2+6 = 8）。</li>
                        <li><b>個性卡牌</b>：將靈魂卡牌的數字相加得到個性卡牌（如果靈魂卡牌已是個位數，則兩者相同）。</li>
                        <li><b>特殊組合</b>：當靈魂卡牌是19時，會產生三張牌：19 (太陽), 10 (命運之輪), 1 (魔術師)。其他兩位數靈魂卡牌(10-18, 20, 21)會產生靈魂牌、個性牌及陰影牌(靈魂牌 - 個性牌)。個位數靈魂牌(1-9)則靈魂牌與個性牌相同，無陰影牌。</li>
                      </ul>
                  </div>
              </section>

              <section>
                 <h3 className="text-xl font-semibold text-purple-700 mb-2">靈魂卡牌 vs. 個性卡牌 vs. 陰影/天賦卡牌</h3>
                 <div className="grid md:grid-cols-1 gap-4">
                      <div className="bg-purple-50 p-3 rounded-lg border-l-4 border-purple-500">
                          <h4 className="font-bold text-purple-800">靈魂卡牌 (Soul Card)</h4>
                          <p className="text-sm">代表個人的<b>靈魂目的</b>、<b>核心本質</b>與跨越多個生世的永恆特質。它反映靈魂的根本使命、與生俱來的天賦和最高潛能。</p>
                      </div>
                      <div className="bg-pink-50 p-3 rounded-lg border-l-4 border-pink-500">
                          <h4 className="font-bold text-pink-800">個性卡牌 (Personality Card)</h4>
                          <p className="text-sm">描述個人在<b>此生需要學習的課題</b>、外在世界的<b>人格表現方式</b>以及需要掌握和整合的人生功課。這是靈魂使命在現實生活中的體現。</p>
                      </div>
                      <div className="bg-slate-50 p-3 rounded-lg border-l-4 border-slate-500">
                          <h4 className="font-bold text-slate-800">陰影/天賦卡牌 (Shadow/Gift Card)</h4>
                          <p className="text-sm">此牌根據靈魂牌的特性而定：<br/>
                           - 若靈魂牌為兩位數(10-18, 20, 21)，此為<b>陰影牌</b> (靈魂牌-個性牌)，代表潛意識的挑戰、隱藏才能或需整合的課題。<br/>
                           - 若靈魂牌為19 (太陽)，此為<b>天賦牌</b> (個性牌的數字總和)，形成特殊的太陽三重創造循環 (19太陽 → 10命運之輪 → 1魔術師)。<br/>
                           - 若靈魂牌為個位數(1-9)，則無額外陰影/天賦牌，能量高度集中。
                          </p>
                      </div>
                 </div>
              </section>

              <section>
                  <h3 className="text-xl font-semibold text-purple-700 mb-2">生命牌卡組合的解讀重點</h3>
                  <div className="space-y-4">
                      <div className="p-4 bg-gray-50 rounded-lg">
                          <h4 className="font-bold text-gray-800">情況一：統一型 (1張主牌，靈魂牌=個性牌)</h4>
                          <p className="text-sm mt-1">當生日數字總和為 1-9 時，您的「靈魂牌」與「個性牌」是同一張牌。這代表您的內在本質與外在表現高度一致，人生課題非常專注和強烈。您的挑戰與天賦都集中在這張牌的能量中，需深度理解該牌的正負兩面，以達至其最高表達。</p>
                      </div>
                      <div className="p-4 bg-gray-50 rounded-lg">
                          <h4 className="font-bold text-gray-800">情況二：標準雙牌組 (2張主牌 + 1張陰影牌)</h4>
                          <p className="text-sm mt-1">當生日數字總和為 10-18、20 或 21 時，您會有兩張主要牌卡及一張陰影牌。陰影牌（靈魂牌 - 個性牌）揭示了靈魂與個性間的潛在張力、深層恐懼、未被發掘的才能或需要特別整合的人生課題。這三張牌共同構成您此生的學習藍圖，陰影牌的整合是成長的關鍵。</p>
                      </div>
                      <div className="p-4 bg-gray-50 rounded-lg">
                          <h4 className="font-bold text-gray-800">情況三：太陽特殊三重牌組 (3張主牌)</h4>
                          <p className="text-sm mt-1">當生日數字總和為 19 (太陽) 時，這是一個非常特殊的組合，形成一個創造循環：<b>19 (太陽)</b> → <b>10 (命運之輪)</b> → <b>1 (魔術師)</b>。這三張牌分別代表光輝的實現(太陽)、宇宙的機遇(命運之輪)和個人的意志與創造力(魔術師)，共同構成您強大的顯化潛能和生命活力。挑戰在於協調這三股強大能量，使其順暢流動。</p>
                      </div>
                  </div>
              </section>

              <section>
                <h3 className="text-xl font-semibold text-purple-700 mb-2">整合與實踐</h3>
                <p className="text-base leading-relaxed">
                  生命的前半段（約35歲前）主要發展個性卡牌的特質，學習在社會中建立身份。生命後半段則轉向靈魂卡牌的深度探索，尋求生命意義。理解您的生命牌卡不是限制，而是指引。透過認識自己的天賦與挑戰，每個人都能更好地實現潛能，在人生旅程中找到方向和意義。陰影牌或天賦牌的整合尤其重要，它們是通往更完整自我的鑰匙。
                </p>
              </section>
            </div>
          );
          
          const generateDetailedTarotReport = (cardSet) => {
              const { soulCard, personalityCard, shadowCard, giftCard } = cardSet;
              
              let introduction = '';
              let cardsAnalysis = [];
              let dynamicsAnalysis = '';
              let developmentalFocus = '';
              
              const getCardName = (id) => cardDetails[id]?.name || '未知卡牌';
              const getCardChallenges = (id) => cardDetails[id]?.challenges || '請參閱卡牌詳細說明。';

              if (giftCard !== null) { // 太陽特殊三重牌組 (19)
                  introduction = `您的生命牌卡組合是宇宙中極其罕見且極致強大的「太陽神聖三重奏」：主題牌 ${getCardName(soulCard)}(${soulCard}) → 過程牌 ${getCardName(personalityCard)}(${personalityCard}) → 動力牌 ${getCardName(giftCard)}(${giftCard})。這不僅是一個動態的創造循環，更像是一個被宇宙賦予了「快車道」的靈魂藍圖。您是天生的「顯化大師」，您的意識本身就是一個強大的能量漩渦，能夠直接將思想、意圖與靈感從非物質界錨定到物質現實中。這組牌意味著您與宇宙的創造法則有著先天的、直覺性的連結。您的人生，當處於最佳狀態時，將是一部充滿奇蹟、成功與純粹喜悅的壯麗史詩。您被召喚來此，不僅是為了實現個人的夢想，更是為了成為一個活生生的榜樣，向世界展示當個人意志與宇宙潮流完美共振時，所能創造出的輝煌成果。`;
                  cardsAnalysis = [
                      { cardId: soulCard, role: '主題牌：太陽 - 光輝實現與生命喜悅', roleKey: 'soul' },
                      { cardId: personalityCard, role: '過程牌：命運之輪 - 把握宇宙時機與資源流動', roleKey: 'personality' },
                      { cardId: giftCard, role: '動力牌：魔術師 - 個人意志與創造力的主動運用', roleKey: 'gift' }
                  ];
                  dynamicsAnalysis = `在您的太陽三重奏這部神聖劇本中，三位主角各司其職，共同上演一出創造的交響樂。首先，${getCardName(giftCard)} (${giftCard}) 扮演「神聖的火種」與「建築師」，它代表您清晰、專注的個人意志和原始創造衝動。這是您一切顯化的起點，是您在內心畫下的第一張藍圖，是您向宇宙發出的清晰指令：“我意欲創造……”。接著，${getCardName(personalityCard)} (${personalityCard}) 作為「宇宙的河流」與「機緣的催化劑」，它接收到您的意圖後，開始為您調動宇宙間所有的資源、人脈、同步性事件與幸運時機。它負責將您個人的小溪匯入宇宙能量的大河之中，為您的航行提供順風與助力。最後，${getCardName(soulCard)} (${soulCard}) 是「豐收的舞台」與「榮耀的燈塔」，它將您經由意志與機遇共同創造的成果，以最燦爛、最溫暖、最充滿喜悅的形式展現給世界，獲得成功與認可，並將這份光與熱分享出去，照亮他人。這個循環完美地詮釋了宇宙創造的奧秘：1 (一個清晰的意圖) → 10 (與宇宙的無限可能連結) → 19 (最終圓滿、喜悅的顯化，其數字根 1+9=10→1+0=1，又回歸到一個新的、更高層次的創造起點)。`;
                  developmentalFocus = `此黃金組合的最大挑戰，也是最高藝術，在於如何成為一位清醒的「交響樂指揮家」，有意識地協調這三股強大的宇宙能量，讓它們和諧共鳴，而非相互衝突或失控。若缺乏覺知，這個強大的引擎可能導致 burnout（耗竭）或 ego inflation（自我膨脹）。您的成長焦點在於：\n1. ${getCardName(giftCard)} (魔術師) 的精煉：您必須確保您的意圖是純淨且清晰的，而非出於操控、自負或匱乏感 (${getCardChallenges(giftCard)})。一個模糊或被小我污染的意圖，會讓宇宙之輪帶來混亂的而非有益的機遇。這是地基，必須穩固。\n2. ${getCardName(personalityCard)} (命運之輪) 的臣服：在清晰地設定意圖後，您必須學會信任並放手，讓宇宙以其充滿智慧的方式運作。試圖用魔術師的意志去強行控制命運之輪的轉動，是此組合最常見的錯誤，會導致巨大的挫敗感 (${getCardChallenges(personalityCard)})。您的功課是在變化中保持中心，順應潮流而非對抗。\n3. ${getCardName(soulCard)} (太陽) 的謙遜分享：當成功與光環到來時，您需要帶著感恩的心去接受，並慷慨地分享您的喜悅與成果，而非將其視為理所當然或歸於一己之功 (${getCardChallenges(soulCard)})。真正的太陽是照耀萬物，而非僅僅為了自我閃耀。若因能量過強而忽略過程中的細節、他人的貢獻與感受，這份成功將是空洞的。您的終極目標是成為一個充滿喜悅、有意識的共同創造者，與宇宙共舞。`;
              } else if (shadowCard === null) { // 統一型 (1-9)
                  introduction = `您是極其特殊、萬中選一的「統一型」原型人格 - 您的靈魂牌與個性牌均為 ${soulCard} 號「${getCardName(soulCard)}」。這象徵著您的靈魂在投生之前，選擇了一條高度專注、不加修飾的生命路徑。您的內在本質（靈魂渴求）與外在表現（個性面具）之間沒有緩衝地帶，它們是同一股純粹、強大的原型能量。這使得您的人生課題異常集中、深刻且強烈。您此生的所有學習、挑戰、天賦與成就，都將圍繞著「${getCardName(soulCard)}」這張牌的深層奧義進行極致的探索。您就像一把被磨礪到極致的單刃劍，沒有多餘的裝飾，只有純粹的目的與力量。您的存在本身，就是對這個原型最直接、最鮮活的詮釋。`;
                  cardsAnalysis = [{ cardId: soulCard, role: '核心原型：您的存在本質與表達方式', roleKey: 'soul' }];
                  dynamicsAnalysis = `作為統一型，您內外在的能量完全、無稀釋地集中在 ${getCardName(soulCard)} 的原型上。這帶來了雙刃劍般的效果：一方面，它賦予您在該原型所代表的領域中無與倫比的專注力、天賦與巨大潛能。您能比其他人更快、更深入地掌握其精髓，並可能在相關領域成為權威或大師。但另一方面，這種能量的高度集中也意味著您幾乎沒有“內在制衡”機制，這讓您更容易、更頻繁地陷入該牌的極端表現、陰影特質或認知盲點中。當您體驗到 ${getCardName(soulCard)} 的光明面時，光芒會格外耀眼；而當您陷入其陰影時，黑暗也會顯得特別深沉。您的人生，是一場與單一原型深度共舞、直至人牌合一的修煉之旅。`;
                  developmentalFocus = `您的成長關鍵，不在於平衡不同的能量，而在於對 ${getCardName(soulCard)} 這股單一能量的“深度自我覺察”與“精微駕馭”。您的核心功課是成為這個原型的“主人”，而非它的“奴隸”。請將 ${getCardName(soulCard)} 的挑戰視為您最寶貴的成長指南針：${getCardChallenges(soulCard)}。這些挑戰並非要被消除，而是要被理解、接納並轉化。您的修行路徑是：第一步，徹底地、誠實地觀察自己在無意識中是如何展現這些挑戰的。第二步，有意識地選擇去活出該原型的最高、最光明的表達。第三步，學會擁抱並整合其陰影面，將其破壞性能量轉化為建設性的力量。例如，若您是統一型皇帝，您的課題就是從一個僵化的“暴君”轉化為一位智慧的“明君”。這個從原型的低階表達到高階表達的持續精進過程，就是您此生靈魂進化的核心所在。`;
              } else { // 標準雙牌組 + 陰影牌 (10-18, 20, 21)
                  introduction = `您的生命牌卡構成一個精妙絕倫的三維靈魂學習藍圖，一個神聖的“能量三角”。這個結構揭示了您靈魂此生選擇的獨特進化路徑。您的靈魂牌「${getCardName(soulCard)}」(${soulCard})是您靈魂的「北極星」，定義了您永恆的本質、核心使命以及此生最終渴望達到的最高潛能與境界。個性牌「${getCardName(personalityCard)}」(${personalityCard})是您的「交通工具」與「主要道路」，代表您在今生用來探索世界、與人互動、學習課題的主要外在表達方式和人格特質。而至關重要的陰影牌「${getCardName(shadowCard)}」(${shadowCard})則是這趟旅程地圖上的「秘密通道」與「隱藏的龍穴」，它揭示了前兩張牌之間潛在的深層張力、您需要整合的內在恐懼、被壓抑的渴望以及尚未被發掘的巨大力量。`;
                  cardsAnalysis = [
                      { cardId: soulCard, role: '靈魂牌：您永恆的本質與最高使命', roleKey: 'soul' },
                      { cardId: personalityCard, role: '個性牌：您今生的學習課題與展現', roleKey: 'personality' },
                      { cardId: shadowCard, role: '陰影牌：需要整合的內在動力與挑戰', roleKey: 'shadow' }
                  ];
                  dynamicsAnalysis = `在這個生命藍圖的動態運作中，${getCardName(personalityCard)} (${personalityCard}) 是您在世間行走時，用來實踐和表達 ${getCardName(soulCard)} (${soulCard}) 崇高使命的主要工具和面具。然而，這趟旅程並非一帆風順。${getCardName(shadowCard)} (${shadowCard}) 代表了在這個過程中，您內心深處必然會浮現的內在衝突、古老的恐懼、或是因為童年經歷而未被看見的巨大潛能。它像一個潛意識的“重力場”，時常會將您拉離正軌。因此，它既是您最大的挑戰，也是您完成靈魂煉金術、真正整合靈魂與個性的關鍵橋樑。只有當您勇敢地走進這座龍穴，馴服其中的猛龍，您才能獲得它所守護的寶藏，從而讓您的個性（交通工具）真正有力地駛向靈魂（目的地）。`;
                  developmentalFocus = `您此生的核心課題與最大的成長機會，就在於有意識地去覺察、面對並整合 ${getCardName(shadowCard)} 所代表的陰影能量。它的挑戰特質是：${getCardChallenges(shadowCard)}。請留意，當您在生活中過度地、僵化地使用 ${getCardName(personalityCard)} 的特質（特別是其挑戰面：${getCardChallenges(personalityCard)})時，通常是一種無意識的防禦機制，用來補償或逃避面對 ${getCardName(shadowCard)} 所帶來的深層不安全感。例如，一個個性是“皇帝”的人可能會變得極度控制，正是為了逃避他陰影牌“月亮”所代表的混亂與未知恐懼。\n您的進化之路，是反其道而行之：勇敢地擁抱並轉化 ${getCardName(shadowCard)} 的陰影面，將它的恐懼轉化為智慧，將其束縛轉化為力量。當您這樣做時，這股被解放的強大能量，將會奇蹟般地療癒並提升您的 ${getCardName(personalityCard)}，使其不再僵化，而是變得充滿彈性與力量。最終，您將能以一種更自然、更整合、更強大的方式，透過您成熟的個性，去活出 ${getCardName(soulCard)} 的光輝使命。這個持續轉化陰影、整合自我的煉金過程，是您此生最深刻、也最值得投入的功課。`;
              }
              return { introduction, cardsAnalysis, dynamicsAnalysis, developmentalFocus, cardSet };
          };

          const calculateTarotCards = (date) => {
            const digits = date.replace(/-/g, '').split('').map(Number);
            let total = digits.reduce((sum, digit) => sum + digit, 0);
            const steps = [`出生年月日數字相加: ${digits.join(' + ')} = ${total}`];
            while (total > 21) {
              const newDigits = total.toString().split('').map(Number);
              const newTotal = newDigits.reduce((sum, digit) => sum + digit, 0);
              steps.push(`總和 > 21，繼續相加: ${newDigits.join(' + ')} = ${newTotal}`);
              total = newTotal;
            }
            const soulCard = total;
            let personalityCard = null;
            let shadowCard = null;
            let giftCard = null;
            const getCardName = (id) => cardDetails[id]?.name || '未知卡牌';
            if (soulCard >= 10) {
              const personalityDigits = soulCard.toString().split('').map(Number);
              personalityCard = personalityDigits.reduce((sum, digit) => sum + digit, 0);
              if (soulCard === 19) {
                giftCard = personalityCard.toString().split('').map(Number).reduce((s,d)=>s+d,0); 
                steps.push(`靈魂卡牌為 19 (${getCardName(19)})，形成特殊太陽三重牌組。`);
                steps.push(`個性/過程牌: 1 + 9 = ${personalityCard} (${getCardName(personalityCard)})`);
                steps.push(`天賦/動力牌: 1 + 0 = ${giftCard} (${getCardName(giftCard)})`);
              } else {
                personalityCard = soulCard.toString().split('').map(Number).reduce((sum, digit) => sum + digit, 0);
                shadowCard = soulCard - personalityCard;
                steps.push(`靈魂卡牌為 ${soulCard} (${getCardName(soulCard)})。`);
                steps.push(`個性卡牌: ${soulCard.toString().split('').join(' + ')} = ${personalityCard} (${getCardName(personalityCard)})`);
                steps.push(`陰影牌: ${soulCard} - ${personalityCard} = ${shadowCard} (${getCardName(shadowCard)})`);
              }
            } else {
              personalityCard = soulCard;
              steps.push(`靈魂卡牌為個位數 ${soulCard} (${getCardName(soulCard)})。`);
              steps.push(`個性卡牌與其相同: ${personalityCard} (${getCardName(personalityCard)})。`);
              steps.push(`此為統一型，無額外陰影牌或天賦牌。`);
            }
            return { soulCard, personalityCard, shadowCard, giftCard, steps };
          };

          const handleCalculate = () => {
            if (!birthDate) {
              alert('請輸入出生日期');
              return;
            }
            const cardSet = calculateTarotCards(birthDate);
            setResult(cardSet);
            const report = generateDetailedTarotReport(cardSet);
            setDetailedReport(report);
            setShowProcess(false);
            setViewMode('simple'); 
          };

          const formatDate = (date) => {
            if (!date) return '';
            const parts = date.split('-');
            return `${parts[0]}年${parts[1]}月${parts[2]}日`;
          };

          const CardDisplay = ({ icon, title, cardId, bgColor, textColor, borderColor, type, description, challenges }) => {
            if (cardId === null || cardId === undefined || !cardDetails[cardId]) return null;
            const details = cardDetails[cardId];
            let displayDescription = description;
            if (type === 'soul') displayDescription = details.soulMission;
            else if (type === 'personality') displayDescription = details.personalityTrait;
            return (
              <div className={`${bgColor} rounded-lg p-4 shadow-sm md:shadow-md border-l-4 ${borderColor} transition-all duration-300`}>
                {/* Card Image */}
                <div className="relative mb-3">
                  <img 
                    src={sharedGetCardImagePath(cardId)} 
                    alt={details.name}
                    className="w-full max-w-[150px] mx-auto rounded-lg shadow-md object-cover border-2 border-white"
                    onError={(e) => e.target.style.display = 'none'}
                  />
                </div>
                
                <div className="flex items-center gap-2 mb-2">{icon}<h3 className={`font-semibold ${textColor}`}>{title}</h3></div>
                <div className={`text-2xl font-bold ${textColor} mb-1`}>{cardId} - {details.name}</div>
                <p className={`text-sm font-semibold ${textColor} mb-2`}>{details.shortMeaning}</p>
                <p className={`text-xs ${textColor} opacity-80 mb-2`}>{displayDescription}</p>
                {challenges && (<p className={`text-xs ${textColor} opacity-70 mt-1`}><span className="font-semibold">挑戰：</span>{challenges}</p>)}
              </div>
            );
          };
          
          const DetailedTarotReport = ({ reportData }) => {
            const [openSections, setOpenSections] = useState({});
            const [expandedAnalysis, setExpandedAnalysis] = useState(true);
            const toggleSection = (id) => setOpenSections(prev => ({...prev, [id]: !prev[id]}));

            if (!reportData || !reportData.cardsAnalysis) return <p>報告生成中...</p>;

            return (
                <div className="bg-white rounded-lg p-6 shadow-lg mt-6 animate-fade-in">
                    <h2 className="text-3xl font-bold text-purple-900 mb-3 text-center">您的深度塔羅生命藍圖報告</h2>
                    <p className="text-center text-gray-700 mb-6 text-base leading-relaxed">{reportData.introduction}</p>
                    
                    <div className="space-y-6 mb-8">
                        <h3 className="text-2xl font-bold text-purple-800 text-center mb-4">核心原型卡牌解析</h3>
                        {reportData.cardsAnalysis.map((cardAnalysis, index) => {
                            const cardData = cardDetails[cardAnalysis.cardId];
                            if (!cardData) return null; 
                            const sectionId = `card-${cardAnalysis.cardId}-${index}`;
                            return (
                                <div key={index} className="border-2 border-purple-200 rounded-lg overflow-hidden shadow-md">
                                    <button onClick={() => toggleSection(sectionId)} className="w-full p-5 bg-gradient-to-r from-purple-100 to-pink-100 hover:from-purple-200 hover:to-pink-200 flex justify-between items-center transition-all duration-300">
                                        <div className="text-left">
                                            <span className="text-lg sm:text-xl font-bold text-purple-800">{cardAnalysis.role}: {cardData.name} ({cardAnalysis.cardId})</span>
                                            <div className="text-sm text-purple-600 mt-1">核心意義: {cardData.shortMeaning || ''}</div>
                                        </div>
                                        <span className="text-purple-600 text-2xl">{openSections[sectionId] ? <ChevronUp /> : <ChevronDown />}</span>
                                    </button>
                                    {openSections[sectionId] && (
                                        <div className="p-6 bg-white space-y-4 animate-fade-in">
                                            <div className="p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                                                <h4 className="font-bold text-green-800 mb-2 flex items-center gap-1"><Sparkles className="w-4 h-4" /> 天賦與靈魂使命 ({cardAnalysis.roleKey === 'gift' ? '此牌在此組合中的天賦展現' : '核心天賦'})</h4>
                                                <p className="text-sm text-gray-700 leading-relaxed">{cardData.soulMission}</p>
                                            </div>
                                            <div className="p-4 bg-orange-50 rounded-lg border-l-4 border-orange-500">
                                                <h4 className="font-bold text-orange-800 mb-2 flex items-center gap-1"><User className="w-4 h-4" /> 人格特質與今生表現 ({cardAnalysis.roleKey === 'gift' ? '此牌在此組合中的行為模式' : '主要特質'})</h4>
                                                <p className="text-sm text-gray-700 leading-relaxed">{cardData.personalityTrait}</p>
                                            </div>
                                            <div className="p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                                                <h4 className="font-bold text-red-800 mb-2 flex items-center gap-1"><AlertCircleIcon className="w-4 h-4" /> 主要挑戰與成長課題 ({cardAnalysis.roleKey === 'gift' ? '此牌在此組合中的挑戰' : '核心挑戰'})</h4>
                                                <p className="text-sm text-gray-700 leading-relaxed">{cardData.challenges}</p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>

                     <div className="mb-8">
                        <button onClick={() => setExpandedAnalysis(!expandedAnalysis)} className="w-full p-5 bg-gradient-to-r from-blue-100 to-indigo-100 hover:from-blue-200 hover:to-indigo-200 rounded-lg shadow-md transition-all duration-300 flex items-center justify-between">
                            <h3 className="text-xl sm:text-2xl font-bold text-blue-900 flex items-center gap-2"><BrainIcon /> 牌組互動動力學分析</h3>
                            <span className="text-blue-600 text-2xl">{expandedAnalysis ? <ChevronUp /> : <ChevronDown />}</span>
                        </button>
                        {expandedAnalysis && (
                            <div className="mt-4 p-6 bg-blue-50 rounded-lg border-2 border-blue-200 animate-fade-in">
                                <h4 className="font-bold text-blue-800 mb-2 text-lg">內在能量流動：</h4>
                                <p className="text-blue-900 leading-relaxed text-sm whitespace-pre-line mb-4">{reportData.dynamicsAnalysis}</p>
                                <h4 className="font-bold text-red-700 mb-2 text-lg">發展焦點與挑戰整合：</h4>
                                <p className="text-red-800 leading-relaxed text-sm whitespace-pre-line bg-red-50 p-3 rounded">{reportData.developmentalFocus}</p>
                            </div>
                        )}
                    </div>
                    
                    <div className="text-center p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-200">
                        <h4 className="text-xl font-bold text-purple-800 mb-3">🙏 整合與實踐</h4>
                        <p className="text-gray-700 leading-relaxed text-sm">這份報告提供了一個關於您生命藍圖的深度視角。請記住，這些牌卡不是對您的限制，而是一份珍貴的指引。它們揭示了您的天賦、挑戰與最高的潛能。通过理解和整合這些原型能量，特別是覺察並轉化報告中提及的挑戰與發展焦點，您將能更有意識地走在屬於自己的獨特生命道路上，活出最真實、最完整的自己。</p>
                    </div>
                </div>
            );
          };


          return (
            <div className="max-w-3xl mx-auto p-4 sm:p-6 bg-gradient-to-br from-purple-100 to-pink-100 rounded-xl shadow-lg md:shadow-xl font-sans">
              <div className="text-center mb-8">
                <h1 className="text-3xl font-bold text-purple-800 mb-2 flex items-center justify-center gap-2"><Sparkles className="w-8 h-8" />塔羅生命靈數計算器</h1>
                <p className="text-gray-600">依據 Mary K. Greer 系統，解碼您的主牌、個性牌與陰影/天賦牌</p>
              </div>
              <div className="bg-white rounded-lg p-6 shadow-md mb-6">
                <div className="mb-6"><label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2"><Calendar />請輸入您的出生日期</label><input type="date" value={birthDate} onChange={(e) => setBirthDate(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"/></div>
                <button onClick={handleCalculate} className="w-full bg-purple-600 text-white py-3 rounded-md hover:bg-purple-700 transition-colors font-semibold flex items-center justify-center gap-2"><Sparkles className="w-5 h-5" /> 計算我的生命牌卡</button>
              </div>
              {result && (
                <div className="space-y-6 animate-fade-in">
                  <div className="bg-white rounded-lg p-4 shadow-md">
                    <div className="flex justify-center space-x-2 sm:space-x-4">
                      <button onClick={() => setViewMode('simple')} className={`px-4 py-2 sm:px-6 sm:py-3 rounded-lg font-semibold transition-all text-sm sm:text-base ${viewMode === 'simple' ? 'bg-purple-600 text-white shadow-lg transform scale-105' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>📊 簡要概覽</button>
                      <button onClick={() => setViewMode('detailed')} className={`px-4 py-2 sm:px-6 sm:py-3 rounded-lg font-semibold transition-all text-sm sm:text-base ${viewMode === 'detailed' ? 'bg-purple-600 text-white shadow-lg transform scale-105' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>📚 詳細分析</button>
                    </div>
                  </div>
                  {viewMode === 'simple' ? (
                    <div className="bg-white rounded-lg p-6 shadow-md">
                      <h2 className="text-xl font-bold text-gray-800 mb-4">您的塔羅生命靈數結果 ({formatDate(birthDate)})</h2>
                      <div className="grid md:grid-cols-1 gap-6">
                        <CardDisplay icon={<Hash className="w-5 h-5 text-purple-600" />} title="靈魂卡牌 (Soul Card)" cardId={result.soulCard} bgColor="bg-purple-100" textColor="text-purple-900" borderColor="border-purple-500" type="soul" challenges={cardDetails[result.soulCard]?.challenges}/>
                        <CardDisplay icon={<User className="w-5 h-5 text-pink-600" />} title="個性卡牌 (Personality Card)" cardId={result.personalityCard} bgColor="bg-pink-100" textColor="text-pink-900" borderColor="border-pink-500" type="personality" challenges={cardDetails[result.personalityCard]?.challenges}/>
                        {result.shadowCard !== null && cardDetails[result.shadowCard] && (<CardDisplay icon={<Shield className="w-5 h-5 text-slate-600" />} title="陰影牌 (Shadow Card)" cardId={result.shadowCard} bgColor="bg-slate-100" textColor="text-slate-900" borderColor="border-slate-500" description="這是您需要面對與整合的內在挑戰，也是隱藏的潛能所在。" challenges={cardDetails[result.shadowCard]?.challenges}/>)}
                        {result.giftCard !== null && cardDetails[result.giftCard] && (<CardDisplay icon={<Gift className="w-5 h-5 text-yellow-600" />} title="隱藏/天賦卡牌 (Hidden/Gift Card)" cardId={result.giftCard} bgColor="bg-yellow-100" textColor="text-yellow-900" borderColor="border-yellow-500" description="作為太陽三重奏的一部分，這代表您的核心意志與天賦才能。" challenges={cardDetails[result.giftCard]?.challenges}/>)}
                      </div>
                      <button onClick={() => setShowProcess(!showProcess)} className="mt-6 text-purple-600 hover:text-purple-800 text-sm font-medium flex items-center gap-1">{showProcess ? '隱藏' : '顯示'}計算過程<span className="text-purple-600">{showProcess ? <ChevronUp /> : <ChevronDown />}</span></button>
                      {showProcess && (<div className="mt-4 p-4 bg-gray-50 rounded-lg animate-fade-in"><h4 className="font-semibold text-gray-700 mb-2">計算步驟：</h4><p className="text-sm text-gray-600 mb-2">出生日期：{formatDate(birthDate)}</p><div className="space-y-1">{result.steps.map((step, index) => (<p key={index} className="text-sm font-mono text-gray-700">{step}</p>))}</div></div>)}
                    </div>
                  ) : (detailedReport && <DetailedTarotReport reportData={detailedReport} />)}
                </div>
              )}
              <div className="text-center mt-8">
                <button onClick={() => setShowInfo(!showInfo)} className="inline-flex items-center gap-2 px-6 py-3 bg-white text-purple-700 rounded-full shadow-md hover:bg-purple-50 transition-transform transform hover:scale-105"><span className="font-semibold">了解更多關於塔羅生命靈數</span>{showInfo ? <ChevronUp className="w-5 h-5" /> : <ChevronDown className="w-5 h-5" />}</button>
              </div>
              {showInfo && <TarotTheoryInfo />}
            </div>
          );
        };
        
       // --- TAROT COMPATIBILITY SYSTEM ---
        const TarotCompatibilitySystem = () => {
          const [person1Date, setPerson1Date] = useState('');
          const [person2Date, setPerson2Date] = useState('');
          const [person1Name, setPerson1Name] = useState('夥伴 A');
          const [person2Name, setPerson2Name] = useState('夥伴 B');
          const [result, setResult] = useState(null);
          const [showDetails, setShowDetails] = useState({ soul: false, personality: false, shadow: false, yearly: false, monthly: false });
          
          const [targetYear, setTargetYear] = useState(new Date().getFullYear());
          const [targetMonth, setTargetMonth] = useState(new Date().getMonth() + 1);
          
          const baseCompatibilityMatrix = {
             0: { 1: { 
                 score: 90, 
                 type: '神聖火花與顯化通道 (Divine Spark & Manifestation Channel)', 
                 desc: '這是一對宇宙級的創意夥伴關係，是“無”中生“有”的極致展現。愚者是行走的“零點能量場”，攜帶著來自神性源頭、未經定義的無限潛能與純粹靈感。他們是神聖的火花，不斷為關係注入新奇、驚喜與顛覆性的可能性。而魔術師則是專注的“顯化通道”，擁有將這些抽象、飄渺的火花予以錨定、塑形並在物質世界中實現出來的非凡天賦。愚者的存在，能持續打破魔術師的思維定式，將其從純粹的技巧與目標導向中解放出來，接引更高等的、更具原創性的創造力。反之，魔術師則為愚者提供了穩固的平台與清晰的路徑，讓愚者的夢想不再只是空中樓閣，而是可以被觸摸、被看見的現實。這段關係的最高潛能是共同成為“奇蹟工作者”，他們能以極快的速度將一個瘋狂的想法變為一個成功的項目，生活本身就是一場充滿魔法的冒險。', 
                 challenges: '這段關係的核心挑戰在於“自由”與“聚焦”的永恆拉扯。愚者天性抗拒任何形式的結構與長遠規劃，他們的“活在當下”可能會讓目標感極強的魔術師感到極大的挫敗和失控，彷彿在試圖抓住一縷青煙。而魔術師的掌控欲、對效率的追求以及清晰的步驟規劃，在愚者看來則可能是扼殺靈感的牢籠，會讓他們感到窒息與厭煩。當壓力產生時，魔術師可能會試圖“管理”愚者，而愚者則可能選擇“消失”。【成長路徑】：他們需要共同創建一個“有彈性的藍圖”。魔術師需要學習欣賞過程中的意外之喜，將“變數”視為創造力的一部分，而非錯誤。愚者則需要學習為自己點燃的火花負起一定的責任，理解到真正的自由也包含著將美好事物帶到世間的承諾。他們的共同功課是：在享受旅程的同時，也能大致認同一個共同的目的地。' 
             } },
             1: { 1: { 
                 score: 85, 
                 type: '意志的鏡像共鳴 (The Mirror Resonance of Will)', 
                 desc: '兩個1號魔術師的相遇，如同兩面被完美打磨的鏡子相互輝映，創造出一個無限反射的意志力長廊。這是一段極具動能、高效率且充滿創造性火花的關係。雙方都以思想為畫筆，以意志為顏料，能夠迅速理解對方的意圖，並以倍增的能量共同將其顯化於現實。他們是天生的創業夥伴、項目攻堅團隊，能夠在短時間內將一個概念推向市場。溝通直接、清晰、以解決問題為導向，幾乎沒有情感上的拖泥帶水。他們彼此欣賞對方的才智、能力與驅動力，能在智識層面得到極大的滿足。當他們的目標一致時，這股匯合的能量幾乎是無堅不摧的，能夠共同建立起屬於他們的“王國”。', 
                 challenges: '最嚴峻的挑戰來自於“自我”的放大。標題中的“鏡像”不僅反射優點，更會加倍反射缺點。兩個強勢、獨立的個體極易引發權力鬥爭與主導權之爭，將外部世界的競爭模式帶入親密關係中。當意見不合時，可能會演變成智力上的“軍備競賽”或言語上的“魔法對決”，用語言和邏輯作為武器，導致情感上的疏離。另一個潛在的危險是，他們可能共同構建一個與外界隔絕的、由共同意志創造出的“現實扭曲力場”，而忽略了更高層次的智慧與情感需求。【成長路徑】：成功的關鍵在於建立一個“超越”兩人小我的共同願景。他們必須學習從“我”的創造轉向“我們”的創造，並為這個“我們”服務。練習輪流領導、分工合作，並有意識地引入情感交流與脆弱性的分享，是打破純粹意志力迴圈、讓關係獲得深度與溫度的必要功課。他們需要自問：我們的強大力量，究竟是為了服務什麼？' 
             }, 2: { 
                 score: 75, 
                 type: '顯化意志與秘傳智慧的聖婚 (Sacred Marriage of Manifesting Will & Esoteric Wisdom)', 
                 desc: '這是一對連接“天”（女祭司的秘傳智慧）與“地”（魔術師的物質顯化）的強力組合。魔術師是積極外放的陽性原則，是意識的利劍，擅長溝通、行動與在物質世界創造。女祭司則是寧靜內收的陰性原則，是潛意識的海洋，守護著深層的直覺、靈感與宇宙的奧秘。在這段關係中，女祭司如同魔術師的“秘密顧問”或“神諭”，能為其提供極具深度的洞見與方向指引，確保他的行動不僅高效，而且充滿靈魂的智慧與意義。魔術師則能成為女祭司智慧的“代言人”與“執行者”，將她那些難以言喻的內在感知轉化為具體的藝術、文字或行動，幫助她將寶藏從內心世界帶到現實世界。這段關係的最高成就是創造出既有世俗成功又有靈性深度的作品或生活方式。', 
                 challenges: '核心挑戰在於兩種截然不同的“語言系統”與“時間感”的衝突。魔術師使用邏輯、語言與快速的行動，而女祭司使用直覺、象徵與寧靜的等待。魔術師可能因女祭司的沉默、被動或“不合邏輯”的直覺而感到不耐煩，甚至認為她故弄玄虛。女祭司則可能覺得魔術師過於膚淺、喧囂、急於求成，侵擾了她內在的寧靜，不尊重她那需要孕育的智慧。壓力下，魔術師會不斷“追問”，女祭司則會“關閉”得更深。【成長路徑】：這是一場關於“信任”的修煉。魔術師必須學習信任那些無法立即用邏輯證明的內在指引，培養“積極的聆聽”與耐心，尊重沉默的價值。女祭司則必須學習信任魔術師，勇敢地嘗試將她那流動的、非線性的智慧“翻譯”成可被理解的語言，並相信她的智慧值得被實現。他們需要共同建立一個神聖的空間，允許兩種能量以各自的節奏共存與交流。' 
             }, 3: { 
                 score: 80, 
                 type: '意念之種與豐饒之土 (The Seed of Intention & The Fertile Earth)', 
                 desc: '這是一個極具生產力和美感的組合，是“構想”與“實現”的完美聯姻。魔術師扮演著播種者的角色，他帶來清晰的意圖、創新的點子和實現藍圖的方法論，如同那顆蘊含著所有潛能的“種子”。女帝則是那片溫暖、濕潤、充滿生命力的“豐饒之土”，她提供無條件的愛、滋養、資源與一個讓種子能夠安心發芽、茁壯成長的感性環境。魔術師的創造力在女帝的接納與鼓勵下，能得到最大限度的滋養與放大。女帝的豐盛能量則因為魔術師的清晰導向而能結出具體、美麗的果實，而不僅僅是停留在潛能階段。他們能共同創造出成功的事業、溫馨的家庭、美麗的藝術品，他們的成果不僅有價值，而且充滿了愛與喜悅。',
                 challenges: '這段關係的摩擦點在於“過程”與“結果”的價值觀差異。魔術師是目標導向的，重視效率與結果的達成，可能會覺得女帝過於耽於享樂、進度緩慢、缺乏紀律。女帝則是過程導向的，重視感官體驗、關係的和諧與當下的愉悅，可能會覺得魔術師過於功利、冷酷，為了目標而犧牲了生活的品質。當失衡時，魔術師可能無意識地“利用”女帝的資源來達成自己的目的，而女帝可能因為過度付出而感到耗竭，或用被動的懶散來抗議。'
             }, 
             4: {
                score: 70,
                type: '創意火花與秩序熔爐 (Creative Spark & The Crucible of Order)',
                desc: '這是一對將“夢想”鑄造成“帝國”的強效組合。魔術師是源源不絕的創意火花，擅長打破常規、提出新穎的解決方案，為現有體系注入活力與變革的可能。皇帝則是穩固的秩序熔爐，他提供結構、紀律、資源與長遠的戰略規劃，能夠將魔術師那些天馬行空的點子，鍛造成一個可持續、可擴展、有影響力的現實體系。魔術師防止了皇帝的王國變得僵化和過時；皇帝則確保了魔術師的才華不會因缺乏結構而曇花一現，而是能夠建立起長期的基業。這對組合非常適合共同創業或改革一個現有組織，他們能將創新與執行力完美結合，建立起既穩固又有活力的事業。',
                challenges: '核心的張力在於“自由”與“控制”的永恆對立。魔術師的靈活性和對規則的藐視，可能會讓重視紀律和層級的皇帝感到威脅與混亂，認為其“不切實際、難以管理”。而皇帝的嚴謹、規條和對流程的堅持，在魔術師看來則是扼殺創造力的“官僚主義”，會讓其感到束縛與不耐煩。在權力結構上，皇帝習慣於發號施令，而魔術師則習慣於獨立自主，這很容易引發關於“誰說了算”的衝突。【成長路徑】：他們需要建立一種“尊重專業”的合作模式。皇帝需要給予魔術師一個“創新的實驗室”，允許他在一定的框架內自由發揮，並信任他的專業判斷。魔術師則需要學習理解結構的重要性，將自己的想法以符合皇帝邏輯的方式進行呈現（例如，提供數據、預算和可行性分析），並尊重皇帝為保障穩定而設立的必要規則。'
             },
             5: {
                score: 65,
                type: '個體真理與集體智慧的對話 (Dialogue of Individual Truth & Collective Wisdom)',
                desc: '這是一段充滿哲學思辨與價值觀碰撞的關係，是“革新”與“傳承”之間的深刻對話。魔術師代表著以個人意志和直接經驗來探尋真理的路徑，他們相信“眼見為實”，並勇於挑戰所有既定的權威與教條。教皇則代表著通過歷史、傳統與集體智慧來理解真理的途徑，他相信前人的經驗可以指引當下，提供穩固的道德與信仰框架。當他們願意相互傾聽時，魔術師能為教皇帶來新鮮的視角，防止他的信仰體系變得僵化和脫離時代。教皇則能為魔術師提供深刻的歷史背景與倫理考量，讓他的個人創造能夠植根於更深厚的文化土壤之中，獲得意義與深度。',
                challenges: '主要的鴻溝在於對“權威來源”的根本分歧。魔術師的權威來自“我能”，而教皇的權威來自“經書所載”或“導師所言”。這極易導致互相的貶低：魔術師可能認為教皇是“食古不化”的教條主義者，而教皇可能認為魔術師是“離經叛道”的狂妄之徒。他們的爭論可能從具體事件上升到形而上的價值觀對立，難以達成共識。在最壞的情況下，教皇試圖“教化”魔術師，而魔術師則致力於“顛覆”教皇，關係變成一場意識形態的戰爭。【成長路徑】：他們需要尋找超越形式的“共同真理”。魔術師需要學習尊重傳統中蘊含的智慧，理解並非所有規則都是束縛。教皇則需要學習區分智慧的“精髓”與過時的“形式”，並承認真理有多種顯現方式，個人的直接體驗也是一條有效的靈性路徑。他們的共同功課是：在傳承與創新之間，找到一座可以對話的橋樑。'
             }},
             2: { 2: { 
                 score: 85, 
                 type: '潛意識海洋的雙生共鳴 (The Twin Resonance of the Subconscious Ocean)', 
                 desc: '兩位女祭司的相遇，是一場無需言語的靈魂相認。這不是一段充滿激情戲劇的關係，而更像兩片深邃、寧靜的湖泊彼此映照，共同構成一片廣闊的內在海洋。她們能夠在靜默中進行深層次的交流，通過一個眼神、一個夢境、一個同步性的事件，就能理解對方的所思所想。這段關係的核心是深度的內在探索與靈性共修。她們會共同深入神秘學、心理學、夢境分析等領域，成為彼此內在旅程最忠實的見證者與守護者。在彼此的陪伴下，雙方都能更勇敢地潛入自己潛意識的深處，因為知道有一個人能完全理解那片風景的神秘與壯麗。這是一段極其滋養靈魂、能夠共同達到高階智慧的稀有連結。', 
                 challenges: '最大的挑戰在於“能量的停滯”與“與現實世界的脫節”。由於雙方都傾向於內省、被動與靜默，這段關係可能缺乏將內在智慧轉化為實際行動的驅動力，導致兩人都沉浸在自己的世界裡，與社會、工作、甚至日常瑣事產生隔閡。情感的表達可能會被過度壓抑，雙方都害怕用言語打破那份神聖的寧靜，導致誤解和情感需求被忽視時也選擇沉默。在最壞的情況下，她們可能會共同構建一個“象牙塔”，相互印證彼此的逃避傾向，變得孤立和不食人間煙火。【成長路徑】：她們需要有意識地設定“接地氣”的共同目標。比如，將共同的靈性洞見寫成書、開設工作坊，或是在生活中設定具體的、需要合作完成的現實任務。同時，必須刻意練習“笨拙的言辭”，即勇敢地用語言去表達愛、需求和不滿，即便覺得語言會破壞美感。其中一方需要學會偶爾扮演“魔術師”的角色，將另一方從沉思中喚醒，共同走向陽光下的世界。' 
             }, 3: { 
                 score: 80, 
                 type: '靈感神諭與大地子宮 (The Oracle of Inspiration & The Womb of Earth)', 
                 desc: '這是宇宙中兩種最純粹陰性力量的神聖結合，是“智慧”與“生命”的共舞。女祭司是月亮般清冷的“靈感神諭”，她連接潛意識與宇宙智慧的源頭，能提供超凡的直覺、遠見和精神指引。她知道種子“應該”是什麼，以及“何時”播種。女帝則是太陽般溫暖的“大地子宮”，她代表著物質世界的豐盛、創造力與無條件的滋養。她能將女祭司提供的抽象靈感，用愛與喜悅去孕育，使其在現實世界中開花結果。女祭司確保了創造的方向是具有靈性深度和意義的，而非盲目的。女帝則確保了這份靈感能被賦予形式，被溫柔地帶到人間，充滿生命力與美感。她們能共同創造出極具療癒力量的藝術、社群或家庭，這是一個充滿靈性與愛的庇護所。', 
                 challenges: '這段關係的挑戰在於能量頻率與表現方式的差異。女祭司的能量是內斂、靜態、精神性的，而女帝的能量是外放、動態、感官性的。女祭司可能覺得女帝過於沉溺物質享受、情感外露、不夠“純粹”。女帝則可能覺得女祭司過於冷淡、抽離、不解風情，無法全然投入生活的熱情與歡愉。當衝突發生時，女祭司可能退回到她的內心聖殿，用沉默來應對；而女帝可能因為感到不被接納而情感氾濫，或用過度的物質給予來試圖“溫暖”對方。她們之間可能存在一種“聖”與“俗”的內在評判。【成長路徑】：她們需要認識到彼此是同一女神的兩個面向，缺一不可。女祭司需要學習走向物質世界，將她的智慧融入一杯茶、一次擁抱、一頓晚餐中，理解到神性也存在於感官體驗之中。女帝則需要學習在她的花園中開闢一塊“靜修之地”，尊重並參與到女祭司的內在探索中，理解到豐盛的根源來自於那份看不見的靈性連結。' 
             }, }
          };

          const fullCompatibilityMatrix = useMemo(() => {
                const matrix = JSON.parse(JSON.stringify(baseCompatibilityMatrix));
                for (let i = 0; i <= 21; i++) {
                    if (!matrix[i]) matrix[i] = {};
                    for (let j = i; j <= 21; j++) {
                        // Ensure inner object exists
                        if (!matrix[j]) matrix[j] = {};
                        // Check both [i][j] and [j][i]
                        if (!matrix[i][j] && !matrix[j][i]) {
                             const card1 = cardDetails[i];
                             const card2 = cardDetails[j];
                             if (!card1 || !card2) continue;

                             if (i === j) { // Self-pairing
                                matrix[i][j] = {
                                  score: 80, 
                                  type: `同頻共振 (${card1.name})`, 
                                  desc: `兩個 ${card1.name} 相遇，關於「${card1.shortMeaning}」的能量會被雙倍放大。這帶來深刻的理解與共鳴，能迅速建立連結，但也可能讓雙方共同的盲點被忽視。`, 
                                  challenges: `主要挑戰在於需要有意識地覺察並平衡 ${card1.name} 能量的極端表現。例如，雙方都可能陷入「${card1.challenges}」的困境中，缺乏另一種視角來打破僵局。`
                                };
                            } else { // Generic pairing
                                matrix[i][j] = {
                                  score: 70, 
                                  type: `互補學習 (${card1.name} & ${card2.name})`, 
                                  desc: `${card1.name} 所代表的「${card1.shortMeaning.split('、')[0]}」能量，與 ${card2.name} 的「${card2.shortMeaning.split('、')[0]}」主題相遇，創造了寶貴的學習與成長機會。一方的優點可以彌補另一方的不足。`, 
                                  challenges: `雙方需要理解並尊重彼此本質上的差異。${card1.name}的潛在挑戰 (${card1.challenges.split('。')[0]}) 可能與 ${card2.name} 的挑戰 (${card2.challenges.split('。')[0]}) 相互作用，需要耐心地溝通和磨合。`
                                };
                            }
                        }
                    }
                }
                return matrix;
          }, []);

          const getCardName = (id) => cardDetails[id]?.name || '未知卡牌';

          const calculatePersonTarotCards = (date) => {
            const digits = date.replace(/-/g, '').split('').map(Number);
            let total = digits.reduce((sum, digit) => sum + digit, 0);
            while (total > 21) {
              const newDigits = total.toString().split('').map(Number);
              total = newDigits.reduce((sum, digit) => sum + digit, 0);
            }
            const soulCard = total;
            let personalityCard;
            if (soulCard < 10) { 
                personalityCard = soulCard;
            } else {
              const personalityDigits = soulCard.toString().split('').map(Number);
              personalityCard = personalityDigits.reduce((sum, digit) => sum + digit, 0);
            }
            
            // This is a specific compatibility calculation, different from the individual one. 
            // 22-soul card reveals a complementary or challenging energy.
            const soulValueForShadow = soulCard === 0 ? 22 : soulCard;
            let compShadowCard = 22 - soulValueForShadow;
            
            return { soulCard, personalityCard, shadowCard: compShadowCard };
          };

          const getCompatibility = (card1, card2) => {
            if (card1 === null || card2 === null) return { score: 0, type: '資訊不足', desc: '無法計算，因為缺少一方或雙方的牌卡資訊。', challenges: '' };
            
            let c1 = card1, c2 = card2;
            if (c1 > c2) [c1, c2] = [c2, c1]; // Ensure c1 is always smaller for matrix lookup

            if (fullCompatibilityMatrix[c1] && fullCompatibilityMatrix[c1][c2]) {
              return fullCompatibilityMatrix[c1][c2];
            }
            if (fullCompatibilityMatrix[c2] && fullCompatibilityMatrix[c2][c1]) { // Fallback check
                return fullCompatibilityMatrix[c2][c1];
            }
            
            // Should be covered by the generic generator, but as a final fallback:
            return { score: 50, type: '中性關係', desc: '這是一段充滿未知與探索空間的關係。', challenges: '缺乏天然的強烈共鳴或明顯的互補性，需要更多有意識的溝通來建立深層連結。' };
          };

          const getOverallCompatibility = (soulComp, personalityComp, shadowComp) => {
            if (!soulComp || !personalityComp || !shadowComp) return { avgScore: 0, level: '無法評估', advice: '數據不足，無法生成綜合建議。'};
            // Weighting: soul 40%, personality 40%, shadow 20%
            const avgScore = (soulComp.score * 0.4) + (personalityComp.score * 0.4) + (shadowComp.score * 0.2);
            let level, advice;
            if (avgScore >= 85) { level = '🌟🌟🌟🌟🌟 靈魂高度共鳴'; advice = '你們在多個層面有著深刻的靈魂連結和高度契合，彼此能夠深度理解、支持與啟發。這是一段具有巨大共同進化潛力的關係，共同探索生命的奧秘。'; }
            else if (avgScore >= 75) { level = '🌟🌟🌟🌟 高度心靈契合'; advice = '你們在核心價值與生命目標上有良好的共鳴，個性上也能相互欣賞。透過坦誠溝通與共同學習，可以達到更深的親密與理解，是一段能帶來喜悅與成長的關係。'; }
            else if (avgScore >= 65) { level = '🌟🌟🌟 互補成長夥伴'; advice = '你們的差異可以成為彼此成長的催化劑和學習的鏡子。關係中可能存在一些挑戰，但只要保持開放、尊重與理解，就能將差異轉化為互補的優勢，共同進步。'; }
            else if (avgScore >= 55) { level = '🌟🌟 學習型挑戰關係'; advice = '這段關係中，挑戰與機遇並存。你們的相遇是為了學習重要的人生課題，可能需要更多的努力、耐心和有意識的溝通來化解摩擦。若能共同克服，將帶來深刻的個人成長。'; }
            else { level = '🌟 深層課題探索'; advice = '你們的連結觸及了較深的生命課題或過往模式。關係可能感覺複雜，需要極大的耐心、慈悲和自我反思。這是一段潛力巨大的靈魂功課，重點在於自我覺察與轉化，而非僅僅是關係的和諧。'; }
            return { avgScore: Math.round(avgScore), level, advice };
          };

          const handleAnalyze = () => {
            if (!person1Date || !person2Date) { alert('請填寫兩位夥伴的出生日期'); return; }
            if (!person1Name || !person2Name) { alert('請填寫兩位夥伴的姓名/暱稱'); return; }
            
            const person1Cards = calculatePersonTarotCards(person1Date);
            const person2Cards = calculatePersonTarotCards(person2Date);
            
            const person1FortuneCards = sharedCalculateFortuneCards(person1Date, targetYear, targetMonth);
            const person2FortuneCards = sharedCalculateFortuneCards(person2Date, targetYear, targetMonth);
            
            const soulCompatibility = getCompatibility(person1Cards.soulCard, person2Cards.soulCard);
            const personalityCompatibility = getCompatibility(person1Cards.personalityCard, person2Cards.personalityCard);
            const shadowCompatibility = getCompatibility(person1Cards.shadowCard, person2Cards.shadowCard); 
            const overall = getOverallCompatibility(soulCompatibility, personalityCompatibility, shadowCompatibility);

            const yearlyCompatibility = getCompatibility(person1FortuneCards.yearlyCard, person2FortuneCards.yearlyCard);
            const monthlyCompatibility = getCompatibility(person1FortuneCards.monthlyCard, person2FortuneCards.monthlyCard);

            setResult({ 
                person1: { name: person1Name, ...person1Cards, fortuneCards: person1FortuneCards }, 
                person2: { name: person2Name, ...person2Cards, fortuneCards: person2FortuneCards }, 
                compatibility: { soul: soulCompatibility, personality: personalityCompatibility, shadow: shadowCompatibility, yearly: yearlyCompatibility, monthly: monthlyCompatibility, overall },
                timeframe: { year: targetYear, month: targetMonth }
            });
            setShowDetails({ soul: false, personality: false, shadow: false, yearly: false, monthly: false });
          };

          const getScoreColor = (score) => { if (score >= 85) return 'text-green-600'; if (score >= 75) return 'text-blue-600'; if (score >= 65) return 'text-yellow-600'; if (score >=55) return 'text-orange-600'; return 'text-red-600'; };
          const getScoreBg = (score) => { if (score >= 85) return 'bg-green-100'; if (score >= 75) return 'bg-blue-100'; if (score >= 65) return 'bg-yellow-100'; if (score >=55) return 'bg-orange-100'; return 'bg-red-100'; };
          
          const CompatibilityItem = ({ itemKey, title, icon, cards, compatibilityInfo, infoText, isOpen, onToggle }) => (
            <div className="bg-white rounded-lg p-4 sm:p-6 shadow-md">
              <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between cursor-pointer" onClick={onToggle}>
                <h3 className="font-semibold text-gray-800 flex items-center gap-2 mb-2 sm:mb-0 text-base sm:text-lg">{icon} {title}</h3>
                <div className="flex items-center gap-2 sm:gap-4 w-full sm:w-auto justify-end">
                    <span className={`text-xl sm:text-2xl font-bold ${getScoreColor(compatibilityInfo.score)}`}>{compatibilityInfo.score}%</span>
                    <span className={`px-2 py-1 sm:px-3 rounded-full text-xs sm:text-sm font-medium whitespace-nowrap ${getScoreBg(compatibilityInfo.score)} ${getScoreColor(compatibilityInfo.score)}`}>{compatibilityInfo.type}</span>
                    <span className="text-purple-600 text-xl">{isOpen ? <ChevronUp /> : <ChevronDown />}</span>
                </div>
              </div>
              {isOpen && (<div className="mt-4 pt-4 border-t animate-fade-in text-sm">
                  <div className="mb-3 p-3 bg-gray-50 rounded-md">
                    <p className="font-semibold text-gray-700">互動牌組：</p>
                    
                    {/* Partner Card Images */}
                    <div className="flex justify-center gap-4 my-3">
                      <div className="text-center">
                        <img 
                          src={sharedGetCardImagePath(cards[0])} 
                          alt={getCardName(cards[0])}
                          className="w-16 h-24 object-cover rounded-md shadow-md border-2 border-white mx-auto"
                        />
                        <p className="text-xs mt-1">{getCardName(cards[0])}</p>
                      </div>
                      <HeartIcon className="text-red-500 text-2xl self-center" />
                      <div className="text-center">
                        <img 
                          src={sharedGetCardImagePath(cards[1])} 
                          alt={getCardName(cards[1])}
                          className="w-16 h-24 object-cover rounded-md shadow-md border-2 border-white mx-auto"
                        />
                        <p className="text-xs mt-1">{getCardName(cards[1])}</p>
                      </div>
                    </div>
                    
                    <p className="text-gray-600"> {getCardName(cards[0])} ({cards[0]}) <HeartIcon className="inline text-red-500 mx-1" /> {getCardName(cards[1])} ({cards[1]})</p>
                  </div>
                  <h5 className="font-semibold text-gray-700 mb-1">能量互動描述：</h5><p className="text-gray-600 mb-3 leading-relaxed">{compatibilityInfo.desc}</p>
                  <h5 className="font-semibold text-red-700 mb-1 flex items-center gap-1"><AlertCircleIcon className="w-4 h-4" /> 潛在挑戰與成長點：</h5><p className="text-red-600 bg-red-50 p-3 rounded-md mb-3 leading-relaxed">{compatibilityInfo.challenges || "共同探索與理解是關鍵。"}</p>
                  {infoText && (<div className="mt-3 p-3 bg-indigo-50 rounded-lg border-l-4 border-indigo-400"><p className="text-sm text-indigo-700 flex items-start"><InfoIcon className="w-4 h-4 inline mr-2 mt-0.5 flex-shrink-0" /><span>{infoText}</span></p></div>)}
              </div>)}
            </div>
          );


          return (
            <div className="max-w-4xl mx-auto p-4 sm:p-6 bg-gradient-to-br from-purple-100 via-pink-100 to-indigo-100 rounded-xl shadow-xl font-sans">
              <div className="text-center mb-8"><h1 className="text-3xl font-bold text-purple-800 mb-2 flex items-center justify-center gap-2"><HeartIcon className="w-8 h-8" />塔羅牌雙人兼容性深度分析</h1><p className="text-gray-600">依據塔羅原型互動，深入分析兩人的靈魂契合度、個性相容性與共同成長潛力</p></div>
              
              <div className="bg-white rounded-lg p-6 shadow-md mb-6">
                <div className="grid md:grid-cols-2 gap-x-6 gap-y-8">
                    <div className="space-y-4">
                        <h3 className="font-semibold text-gray-800 flex items-center gap-2"><UsersIcon className="w-5 h-5" /> 第一位夥伴</h3>
                        <input type="text" placeholder="姓名/暱稱" value={person1Name} onChange={(e) => setPerson1Name(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500"/>
                        <input type="date" value={person1Date} onChange={(e) => setPerson1Date(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500"/>
                    </div>
                    <div className="space-y-4">
                        <h3 className="font-semibold text-gray-800 flex items-center gap-2"><UsersIcon className="w-5 h-5" /> 第二位夥伴</h3>
                        <input type="text" placeholder="姓名/暱稱" value={person2Name} onChange={(e) => setPerson2Name(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500"/>
                        <input type="date" value={person2Date} onChange={(e) => setPerson2Date(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500"/>
                    </div>
                    <div className="md:col-span-2 border-t pt-6">
                        <h3 className="font-semibold text-gray-800 mb-4 flex items-center gap-2"><ClockIcon/> 選擇分析時點（用於流年流月互動）</h3>
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">年份</label>
                                <input type="number" value={targetYear} onChange={(e) => setTargetYear(parseInt(e.target.value, 10) || new Date().getFullYear())} className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500"/>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">月份</label>
                                <select value={targetMonth} onChange={(e) => setTargetMonth(parseInt(e.target.value, 10))} className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 bg-white">
                                    {[...Array(12).keys()].map(i => <option key={i+1} value={i+1}>{i+1}月</option>)}
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <button onClick={handleAnalyze} className="w-full mt-6 bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-md hover:from-purple-700 hover:to-pink-700 transition-colors font-semibold"><Sparkles className="inline-block w-4 h-4 mr-1" /> 分析兼容性 <Sparkles className="inline-block w-4 h-4 ml-1" /></button>
              </div>
              
              {result && (
                <div className="mt-8 space-y-6 animate-fade-in">
                  <div className="grid md:grid-cols-2 gap-6">
                    <div className="bg-white rounded-lg p-6 shadow-md">
                      <h3 className="font-semibold text-gray-800 mb-4">{result.person1.name}的生命與運勢牌組</h3>
                      <div className="space-y-2 text-sm">
                        <p><span className="font-medium text-purple-700">靈魂牌：</span>{result.person1.soulCard} - {getCardName(result.person1.soulCard)}</p>
                        <p><span className="font-medium text-pink-700">個性牌：</span>{result.person1.personalityCard} - {getCardName(result.person1.personalityCard)}</p>
                        <p><span className="font-medium text-indigo-700">互補/陰影牌 (22-Soul)：</span>{result.person1.shadowCard} - {getCardName(result.person1.shadowCard)}</p>
                        <hr className="my-2"/>
                        <p><span className="font-medium text-yellow-700">年運牌 ({result.timeframe.year})：</span>{result.person1.fortuneCards.yearlyCard !== null ? `${result.person1.fortuneCards.yearlyCard} - ${getCardName(result.person1.fortuneCards.yearlyCard)}` : 'N/A'}</p>
                        <p><span className="font-medium text-blue-700">月運牌 ({result.timeframe.month}月)：</span>{result.person1.fortuneCards.monthlyCard !== null ? `${result.person1.fortuneCards.monthlyCard} - ${getCardName(result.person1.fortuneCards.monthlyCard)}` : 'N/A'}</p>
                      </div>
                    </div>
                    <div className="bg-white rounded-lg p-6 shadow-md">
                      <h3 className="font-semibold text-gray-800 mb-4">{result.person2.name}的生命與運勢牌組</h3>
                      <div className="space-y-2 text-sm">
                        <p><span className="font-medium text-purple-700">靈魂牌：</span>{result.person2.soulCard} - {getCardName(result.person2.soulCard)}</p>
                        <p><span className="font-medium text-pink-700">個性牌：</span>{result.person2.personalityCard} - {getCardName(result.person2.personalityCard)}</p>
                        <p><span className="font-medium text-indigo-700">互補/陰影牌 (22-Soul)：</span>{result.person2.shadowCard} - {getCardName(result.person2.shadowCard)}</p>
                        <hr className="my-2"/>
                        <p><span className="font-medium text-yellow-700">年運牌 ({result.timeframe.year})：</span>{result.person2.fortuneCards.yearlyCard !== null ? `${result.person2.fortuneCards.yearlyCard} - ${getCardName(result.person2.fortuneCards.yearlyCard)}` : 'N/A'}</p>
                        <p><span className="font-medium text-blue-700">月運牌 ({result.timeframe.month}月)：</span>{result.person2.fortuneCards.monthlyCard !== null ? `${result.person2.fortuneCards.monthlyCard} - ${getCardName(result.person2.fortuneCards.monthlyCard)}` : 'N/A'}</p>
                      </div>
                    </div>
                  </div>
                  
                  <div className="bg-gradient-to-r from-purple-100 to-pink-100 rounded-lg p-6 text-center shadow-lg">
                    <h3 className="text-xl sm:text-2xl font-bold text-purple-800 mb-2">總體兼容性評級 (基於天生牌組)</h3>
                    <div className="text-xl sm:text-2xl font-semibold text-purple-700 mb-3">{result.compatibility.overall.level}</div>
                    <div className={`text-3xl sm:text-4xl font-bold ${getScoreColor(result.compatibility.overall.avgScore)} mb-4`}>{result.compatibility.overall.avgScore}%</div>
                    <p className="text-sm sm:text-base text-gray-700 max-w-2xl mx-auto leading-relaxed">{result.compatibility.overall.advice}</p>
                  </div>
                  
                   <div className="bg-gradient-to-r from-blue-100 to-indigo-100 rounded-lg p-6 shadow-lg mt-6">
                        <h3 className="text-xl sm:text-2xl font-bold text-blue-800 mb-2 text-center">
                            天生牌組互動分析
                        </h3>
                         <p className="text-center text-sm text-gray-600 max-w-2xl mx-auto">這部分分析您們天生的核心能量如何互動，揭示關係的長期潛力與課題。</p>
                   </div>
                   <div className="space-y-4">
                        {[
                          { key: 'soul', title: '靈魂層面兼容性 (核心本質)', icon: <Sparkles className="text-purple-600" />, cards: [result.person1.soulCard, result.person2.soulCard], info:"靈魂牌代表最深層的自我，此處的兼容性揭示了你們在生命目的與核心價值上的潛在連結或差異。"},
                          { key: 'personality', title: '個性層面兼容性 (日常互動)', icon: <UsersIcon className="text-pink-600" />, cards: [result.person1.personalityCard, result.person2.personalityCard], info:"個性牌反映了外在行為模式與學習課題。此兼容性關乎你們在日常相處、溝通風格及生活方式上的和諧度。"},
                          { key: 'shadow', title: '互補/陰影整合潛力 (成長課題)', icon: <Shield className="text-indigo-600" />, cards: [result.person1.shadowCard, result.person2.shadowCard], info: "此處的牌卡是通過『22-靈魂牌』計算得出，代表了靈魂需要整合的、較不熟悉或潛在的能量面向。它揭示了彼此可能觸發的深層課題，以及共同整合陰影、達成更完整自我的潛力，是關係中深刻學習的領域。" }
                        ].map(item => (
                            <CompatibilityItem key={item.key} {...item} itemKey={item.key} compatibilityInfo={result.compatibility[item.key]} infoText={item.info} isOpen={showDetails[item.key]} onToggle={() => setShowDetails(prev => ({...prev, [item.key]: !prev[item.key]}))} />
                        ))}
                   </div>


                  <div className="bg-gradient-to-r from-indigo-100 to-blue-100 rounded-lg p-6 shadow-lg mt-8">
                    <h3 className="text-xl sm:text-2xl font-bold text-indigo-800 mb-2 text-center flex items-center justify-center gap-2">
                        <ClockIcon /> 當前時運互動分析 ({result.timeframe.year}年{result.timeframe.month}月)
                    </h3>
                    <p className="text-center text-sm text-gray-600 max-w-2xl mx-auto">此部分分析您們在所選時間週期下的能量互動，提供順勢而為的指引。這屬於短期、動態的能量流，會影響天生牌組的展現方式。</p>
                  </div>
                   <div className="space-y-4">
                        {[
                          { key: 'yearly', title: `年度能量共振 (${result.timeframe.year}年)`, icon: <SunIcon className="text-yellow-600" />, cards: [result.person1.fortuneCards.yearlyCard, result.person2.fortuneCards.yearlyCard], info: `年運牌揭示了兩人在 ${result.timeframe.year} 年共同面對的宏觀主題、學習課題與發展機遇。這反映了你們在這一整年中的能量基調是和諧共振還是需要磨合。`},
                          { key: 'monthly', title: `月度主題互動 (${result.timeframe.month}月)`, icon: <MoonIcon className="text-blue-600" />, cards: [result.person1.fortuneCards.monthlyCard, result.person2.fortuneCards.monthlyCard], info: `月運牌則聚焦於 ${result.timeframe.month} 月的具體能量流動。它顯示了在年度大主題下，本月您們的互動模式、情緒焦點以及可能遇到的短期事件或挑戰。` }
                        ].map(item => (
                            <CompatibilityItem key={item.key} {...item} itemKey={item.key} compatibilityInfo={result.compatibility[item.key]} infoText={item.info} isOpen={showDetails[item.key]} onToggle={() => setShowDetails(prev => ({...prev, [item.key]: !prev[item.key]}))} />
                        ))}
                   </div>


                  <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-6 shadow-lg"><h3 className="font-semibold text-gray-800 mb-4 flex items-center gap-2 text-xl"><BookOpen /> 關係發展深度建議</h3><div className="space-y-4 text-sm text-gray-700 leading-relaxed"><p>• <strong>深化靈魂連結 ({result.compatibility.soul.score}%):</strong> 定期進行深度對話，分享內心的夢想、恐懼與靈性體悟。探索你們靈魂牌 ({getCardName(result.person1.soulCard)} & {getCardName(result.person2.soulCard)}) 之間的共鳴與課題 ({result.compatibility.soul.challenges})。共同參與能滋養靈魂的活動。</p><p>• <strong>促進個性互動 ({result.compatibility.personality.score}%):</strong> 欣賞並學習彼此個性牌 ({getCardName(result.person1.personalityCard)} & {getCardName(result.person2.personalityCard)}) 的優點，尊重差異。將個性上的挑戰 ({result.compatibility.personality.challenges}) 視為學習和共同成長的機會，練習有效的溝通技巧。</p><p>• <strong>整合陰影課題 ({result.compatibility.shadow.score}%):</strong> 當衝突或不適出現時，觀察是否觸發了彼此互補/陰影牌 ({getCardName(result.person1.shadowCard)} & {getCardName(result.person2.shadowCard)}) 所代表的面向。這些互動 ({result.compatibility.shadow.challenges}) 提供了共同療癒和整合內在陰影的寶貴機會。勇敢面對，誠實分享。</p><p>• <strong>把握當前時運:</strong> 關注您們在 {result.timeframe.year} 年的年運牌 ({getCardName(result.person1.fortuneCards.yearlyCard)} & {getCardName(result.person2.fortuneCards.yearlyCard)}) 互動，以及 {result.timeframe.month} 月月運牌 ({getCardName(result.person1.fortuneCards.monthlyCard)} & {getCardName(result.person2.fortuneCards.monthlyCard)}) 的互動。這能幫助您們順應當前的能量流，共同應對機遇與挑戰。</p><p>• <strong>共同創造與成長:</strong> 設定共同的靈性或個人成長目標。利用你們牌組的綜合力量與智慧，相互支持，共同進化。記住，任何挑戰都是關係深化與個人成熟的墊腳石。持續的愛、尊重、理解與溝通是關係長久美滿的關鍵。</p><p className="mt-4 pt-4 border-t border-purple-200 text-xs text-gray-500"><InfoIcon className="inline w-3 h-3 mr-1" />免責聲明：此分析僅供個人探索與娛樂參考，不能替代專業的心理諮詢或關係輔導。請以開放和覺察的態度來對待結果。</p></div></div>
                </div>
              )}
            </div>
          );
        };
        
        // --- FORTUNE CARD CALCULATOR ---
        const FortuneCardCalculator = () => {
          const [birthDate, setBirthDate] = useState('');
          const [targetYear, setTargetYear] = useState(new Date().getFullYear());
          const [targetMonth, setTargetMonth] = useState(new Date().getMonth() + 1);
          const [result, setResult] = useState(null);
          const [showProcess, setShowProcess] = useState(false);
          const [showInfo, setShowInfo] = useState(false);

          const handleCalculate = () => {
            if (!birthDate) {
              alert('請輸入您的出生日期');
              return;
            }

            const { yearlyCard, monthlyCard } = sharedCalculateFortuneCards(birthDate, targetYear, targetMonth);
            
            // Generate steps for display
            const [bYear, bMonth, bDay] = birthDate.split('-').map(Number);
            const yearlySteps = [];
            const bYearSum = sharedSumDigits(bYear);
            const bDaySum = sharedSumDigits(bDay);
            yearlySteps.push(`出生年各位數字之和: ${bYear.toString().split('').join(' + ')} = ${bYearSum}`);
            yearlySteps.push(`出生日各位數字之和: ${bDay.toString().split('').join(' + ')} = ${bDaySum}`);
            const personalBase = bYearSum + bMonth + bDaySum;
            yearlySteps.push(`個人基數 = (年和) + (月) + (日和) = ${bYearSum} + ${bMonth} + ${bDaySum} = ${personalBase}`);
            const targetYearSum = sharedSumDigits(targetYear);
            yearlySteps.push(`目標年份數字之和: ${targetYear.toString().split('').join(' + ')} = ${targetYearSum}`);
            const yearlyValue = personalBase + targetYearSum;
            yearlySteps.push(`年運數值 = 個人基數 + 目標年份和 = ${personalBase} + ${targetYearSum} = ${yearlyValue}`);
            let yearlyCardRawForSteps = (yearlyValue > 0) ? (yearlyValue - 1) % 22 + 1 : 22;
            if (yearlyCardRawForSteps === 0) yearlyCardRawForSteps = 22;
            yearlySteps.push(`年運卡數值 (1-22) = (年運數值 - 1) % 22 + 1 = ${yearlyCardRawForSteps}`);
            if (yearlyCardRawForSteps === 22) yearlySteps.push(`結果為 22，對應塔羅牌 0 (愚者)`);

            const monthlySteps = [];
            const yearlyCardRawForCalc = yearlyCard === 0 ? 22 : yearlyCard;
            monthlySteps.push(`從年運卡數值開始: ${yearlyCardRawForCalc}`);
            const bDaySimplified = sharedReduceToSingleDigit(bDay);
            monthlySteps.push(`出生日化簡值: ${bDay} -> ${bDay.toString().split('').join('+')} -> ... -> ${bDaySimplified}`);
            const monthlyAdjustment = bMonth + bDaySimplified;
            monthlySteps.push(`個人月份調整值 = 出生月 + 出生日化簡值 = ${bMonth} + ${bDaySimplified} = ${monthlyAdjustment}`);
            const monthlyValue = yearlyCardRawForCalc + parseInt(targetMonth, 10) + monthlyAdjustment;
            monthlySteps.push(`月運數值 = 年運卡數值 + 目標月份 + 調整值 = ${yearlyCardRawForCalc} + ${targetMonth} + ${monthlyAdjustment} = ${monthlyValue}`);
            let monthlyCardRawForSteps = (monthlyValue > 0) ? (monthlyValue - 1) % 22 + 1 : 22;
            if (monthlyCardRawForSteps === 0) monthlyCardRawForSteps = 22;
            monthlySteps.push(`月運卡數值 (1-22) = (月運數值 - 1) % 22 + 1 = ${monthlyCardRawForSteps}`);
            if (monthlyCardRawForSteps === 22) monthlySteps.push(`結果為 22，對應塔羅牌 0 (愚者)`);

            setResult({
              yearlyCard,
              monthlyCard,
              steps: { yearly: yearlySteps, monthly: monthlySteps }
            });
            setShowProcess(false);
          };

          const FortuneCardInfo = () => (
             <div className="mt-8 p-6 bg-white rounded-lg shadow-md space-y-6 text-gray-700 transition-all duration-500 ease-in-out">
                <h2 className="text-2xl font-bold text-purple-800 text-center flex items-center justify-center gap-2"><BookOpen /> 年運卡和月運卡的基礎原理與具體計算方法</h2>
                
                <section>
                    <h3 className="text-xl font-semibold text-purple-700 mb-2">基礎原理</h3>
                    <div className="pl-4 border-l-4 border-purple-300">
                        <p><strong>核心概念:</strong> 年運卡和月運卡系統基於生命數字學和塔羅數秘學，通過數學計算將個人的出生信息與時間周期相結合，得出對應的塔羅牌來預測運勢趨勢。</p>
                        <p><strong>數學基礎:</strong> 主要運用數字化簡原理（將複雜數字相加化簡）與循環映射（利用模運算建立時間與卡牌的對應關係），並以個人出生日期作為獨特的個人基數。</p>
                    </div>
                </section>

                <section>
                    <h3 className="text-xl font-semibold text-purple-700 mb-2">年運卡計算方法</h3>
                    <p className="mb-2">此計算器採用基於「個人基數」の詳細步驟法：</p>
                    <div className="bg-blue-50 rounded-lg p-4 text-sm text-blue-800 space-y-2">
                        <p><strong>第一步：計算個人基數</strong><br/><code>個人基數 = (出生年各位數字之和) + (出生月) + (出生日各位數字之和)</code></p>
                        <p><strong>第二步：結合目標年份</strong><br/><code>年運數值 = 個人基數 + (目標年份各位數字之和)</code></p>
                        <p><strong>第三步：化簡至塔羅範圍 (1-22)</strong><br/><code>年運卡數值 = (年運數值 - 1) % 22 + 1</code><br/><span className="text-xs">(若結果為22，則對應塔羅牌 0 (愚者))</span></p>
                    </div>
                </section>

                <section>
                    <h3 className="text-xl font-semibold text-purple-700 mb-2">月運卡計算方法</h3>
                    <div className="bg-green-50 rounded-lg p-4 text-sm text-green-800 space-y-2">
                        <p><strong>第一步：獲得年運卡數值</strong><br/><span>使用上述方法計算出的年運卡號碼（1-22）。</span></p>
                        <p><strong>第二步：計算月份調整值</strong><br/><code>個人月份調整值 = (出生月) + (出生日化簡值)</code><br/><span className="text-xs">(出生日化簡值 = 將生日的數字相加，直到變為個位數)</span></p>
                        <p><strong>第三步：結合目標月份</strong><br/><code>月運數值 = 年運卡數值 + 目標月份 + 個人月份調整值</code><br/><code>月運卡數值 = (月運數值 - 1) % 22 + 1</code><br/><span className="text-xs">(同樣，若結果為22，則對應塔羅牌 0 (愚者))</span></p>
                    </div>
                </section>
                
                <section>
                    <h3 className="text-xl font-semibold text-purple-700 mb-2">實際應用說明</h3>
                    <div className="grid md:grid-cols-2 gap-4 text-sm">
                        <div className="bg-purple-50 p-3 rounded-lg border-l-4 border-purple-500">
                            <h4 className="font-bold text-purple-800">年運卡含義</h4>
                            <p>代表您在目標年份中，整年的主要能量趨勢、核心課題和人生主題。</p>
                        </div>
                        <div className="bg-pink-50 p-3 rounded-lg border-l-4 border-pink-500">
                            <h4 className="font-bold text-pink-800">月運卡含義</h4>
                            <p>代表在年運的大背景下，您在目標月份會遇到的具體運勢走向和需要關注的焦點。</p>
                        </div>
                    </div>
                    <p className="mt-4 text-sm"><strong>組合解讀：</strong> 年運卡是大背景，月運卡為具體表現。將兩者結合解讀，可以獲得更全面和精確的指導。例如，若年運卡是「塔」（劇變），月運卡是「星星」（希望），可能意味著在充滿變動的一年中，該月份會出現帶來希望與療癒的契機。</p>
                </section>

             </div>
          );

          const FortuneCardDisplay = ({ icon, title, cardId, bgColor, textColor, borderColor }) => {
            if (cardId === null || cardId === undefined || !cardDetails[cardId]) return null;
            const details = cardDetails[cardId];
            return (
              <div className={`${bgColor} rounded-lg p-4 shadow-md border-l-4 ${borderColor}`}>
                {/* Card Image */}
                <div className="mb-3 flex justify-center">
                  <img 
                    src={sharedGetCardImagePath(cardId)} 
                    alt={details.name}
                    className="w-full max-w-[120px] rounded-lg shadow-md object-cover border-2 border-white"
                  />
                </div>
                
                <div className="flex items-center gap-2 mb-2">
                  {icon}
                  <h3 className={`font-semibold ${textColor}`}>{title}</h3>
                </div>
                <div className={`text-3xl font-bold ${textColor} mb-1`}>
                  {cardId} - {details.name}
                </div>
                <p className={`text-md font-semibold ${textColor} mb-2`}>{details.shortMeaning}</p>
              </div>
            );
          };

          return (
            <div className="max-w-3xl mx-auto p-4 sm:p-6 bg-gradient-to-br from-indigo-100 to-blue-100 rounded-xl shadow-lg md:shadow-xl font-sans">
              <div className="text-center mb-8">
                <h1 className="text-3xl font-bold text-indigo-800 mb-2 flex items-center justify-center gap-2">
                  <ClockIcon /> 流年/流月運勢計算器
                </h1>
                <p className="text-gray-600">結合您的出生日期與特定時間，揭示年度與月度能量主題</p>
              </div>

              <div className="bg-white rounded-lg p-6 shadow-md mb-6 space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2"><Calendar />您的出生日期</label>
                        <input type="date" value={birthDate} onChange={(e) => setBirthDate(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500"/>
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2"><TargetIcon />目標年份</label>
                        <input type="number" value={targetYear} onChange={(e) => setTargetYear(parseInt(e.target.value, 10) || new Date().getFullYear())} className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500"/>
                    </div>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2"><MoonIcon />目標月份</label>
                  <select value={targetMonth} onChange={(e) => setTargetMonth(parseInt(e.target.value, 10))} className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 bg-white">
                    {[...Array(12).keys()].map(i => <option key={i+1} value={i+1}>{i+1}月</option>)}
                  </select>
                </div>
                <button onClick={handleCalculate} className="w-full bg-indigo-600 text-white py-3 rounded-md hover:bg-indigo-700 transition-colors font-semibold flex items-center justify-center gap-2">
                  <Sparkles className="w-5 h-5" /> 計算我的運勢牌卡
                </button>
              </div>

              {result && (
                <div className="space-y-6 animate-fade-in">
                  <div className="bg-white rounded-lg p-6 shadow-md">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">
                      您在 {targetYear} 年 {targetMonth} 月的運勢牌卡
                    </h2>
                    <div className="grid grid-cols-1 gap-6">
                       <FortuneCardDisplay 
                          icon={<SunIcon className="text-yellow-600" />} 
                          title={`${targetYear} 年運卡`}
                          cardId={result.yearlyCard}
                          bgColor="bg-yellow-100"
                          textColor="text-yellow-900"
                          borderColor="border-yellow-500"
                        />
                       <FortuneCardDisplay 
                          icon={<MoonIcon className="text-blue-600" />} 
                          title={`${targetMonth} 月運卡`}
                          cardId={result.monthlyCard}
                          bgColor="bg-blue-100"
                          textColor="text-blue-900"
                          borderColor="border-blue-500"
                        />
                    </div>
                     <div className="mt-6 p-4 bg-gray-50 rounded-lg text-sm">
                        <h4 className="font-semibold text-gray-700 mb-2">運勢解讀提示：</h4>
                        <p className="text-gray-600">您的年運卡 <strong className="text-yellow-800">{cardDetails[result.yearlyCard].name}</strong> 設定了 {targetYear} 年的整體基調與學習主題。在此大背景下，您的月運卡 <strong className="text-blue-800">{cardDetails[result.monthlyCard].name}</strong> 則揭示了 {targetMonth} 月份需要特別關注的具體能量、機遇或挑戰。
                        <br/><br/>請思考：<strong>{cardDetails[result.yearlyCard].shortMeaning.split('、')[0]}</strong> 的年度主題，在本月是如何透過 <strong>{cardDetails[result.monthlyCard].shortMeaning.split('、')[0]}</strong> 的形式顯現或被體驗的？</p>
                     </div>
                  </div>
                  
                  <button onClick={() => setShowProcess(!showProcess)} className="text-indigo-600 hover:text-indigo-800 text-sm font-medium flex items-center gap-1">
                    {showProcess ? '隱藏' : '顯示'}計算過程 <span className="text-indigo-600">{showProcess ? <ChevronUp /> : <ChevronDown />}</span>
                  </button>

                  {showProcess && (
                    <div className="mt-2 p-4 bg-white rounded-lg shadow-md animate-fade-in space-y-4">
                      <div>
                        <h4 className="font-semibold text-gray-700 mb-2 border-b pb-1">年運卡計算步驟：</h4>
                        <div className="space-y-1 font-mono text-xs sm:text-sm text-gray-600">
                          {result.steps.yearly.map((step, index) => <p key={index}>{step}</p>)}
                        </div>
                      </div>
                       <div>
                        <h4 className="font-semibold text-gray-700 mb-2 border-b pb-1">月運卡計算步驟：</h4>
                        <div className="space-y-1 font-mono text-xs sm:text-sm text-gray-600">
                          {result.steps.monthly.map((step, index) => <p key={index}>{step}</p>)}
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              )}
              
              <div className="text-center mt-8">
                <button onClick={() => setShowInfo(!showInfo)} className="inline-flex items-center gap-2 px-6 py-3 bg-white text-indigo-700 rounded-full shadow-md hover:bg-indigo-50 transition-transform transform hover:scale-105">
                  <span className="font-semibold">了解運勢卡計算原理</span>
                  {showInfo ? <ChevronUp className="w-5 h-5" /> : <ChevronDown className="w-5 h-5" />}
                </button>
              </div>
              {showInfo && <FortuneCardInfo />}
            </div>
          );
        };


        // --- MAIN APP COMPONENT ---
        const App = () => {
          const [activeCalculator, setActiveCalculator] = useState('birth'); // 'birth', 'compatibility', 'fortune'

          const navButtonBaseClass = "px-3 py-2 sm:px-6 sm:py-3 rounded-lg font-semibold transition-all text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-offset-2";
          const activeNavButtonClass = "bg-purple-600 text-white shadow-lg transform scale-105 focus:ring-purple-500";
          const inactiveNavButtonClass = "bg-white text-purple-700 hover:bg-purple-100 focus:ring-purple-400";
          
          return (
            <div className="container mx-auto p-2 sm:p-4 min-h-screen">
              <nav className="text-center mb-6 sm:mb-10 p-2 sm:p-4 bg-purple-200 rounded-lg shadow-md">
                <div className="flex flex-col sm:flex-row justify-center items-center space-y-2 sm:space-y-0 sm:space-x-2 md:space-x-4">
                    <button 
                        onClick={() => setActiveCalculator('birth')}
                        className={`${navButtonBaseClass} ${activeCalculator === 'birth' ? activeNavButtonClass : inactiveNavButtonClass}`}
                    >
                        <User className="inline-block w-4 h-4 sm:w-5 sm:h-5 mr-2" /> 個體生命藍圖
                    </button>
                    <button 
                        onClick={() => setActiveCalculator('compatibility')}
                        className={`${navButtonBaseClass} ${activeCalculator === 'compatibility' ? activeNavButtonClass : inactiveNavButtonClass}`}
                    >
                        <HeartIcon className="inline-block w-4 h-4 sm:w-5 sm:h-5 mr-2" /> 雙人合盤解析
                    </button>
                    <button 
                        onClick={() => setActiveCalculator('fortune')}
                        className={`${navButtonBaseClass} ${activeCalculator === 'fortune' ? activeNavButtonClass : inactiveNavButtonClass}`}
                    >
                        <ClockIcon className="inline-block w-4 h-4 sm:w-5 sm:h-5 mr-2" /> 流年運勢分析
                    </button>
                </div>
              </nav>

              <div className="animate-fade-in">
                  {activeCalculator === 'birth' && <TarotBirthCardsCalculator />}
                  {activeCalculator === 'compatibility' && <TarotCompatibilitySystem />}
                  {activeCalculator === 'fortune' && <FortuneCardCalculator />}
              </div>
              
              <footer className="text-center text-gray-500 mt-12 pb-6 text-xs sm:text-sm">
                塔羅靈數啟迪工具 © {new Date().getFullYear()} 探索自我，深化連結，洞悉運勢。
              </footer>
            </div>
          );
        };
        
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
```
