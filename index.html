<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>塔羅生命靈數與運勢計算器</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        
        /* Tarot card image styles */
        .tarot-card-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .tarot-card-image:hover {
            transform: scale(1.05);
        }

        /* Loading state */
        .image-loading {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        body {
            background-color: #f3e8ff; /* Light purple background for the whole page */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, Fragment, useMemo, useRef } = React;

        // --- SHARED ICON COMPONENTS ---
        const Calendar = () => <span>📅</span>;
        const Sparkles = ({ className }) => <span className={className}>✨</span>;
        const Hash = ({ className }) => <span className={className}>#</span>;
        const User = ({ className }) => <span className={className}>👤</span>;
        const BookOpen = () => <span>📖</span>;
        const ChevronDown = ({ className }) => <span className={className}>▼</span>;
        const ChevronUp = ({ className }) => <span className={className}>▲</span>;
        const Gift = ({ className }) => <span className={className}>🎁</span>;
        const Shield = ({ className }) => <span className={className}>🛡️</span>;
        const HeartIcon = ({ className }) => <span className={className}>💖</span>;
        const UsersIcon = ({ className }) => <span className={className}>👥</span>;
        const MoonIcon = ({ className }) => <span className={className}>🌙</span>;
        const StarIcon = ({ className }) => <span className={className}>⭐</span>;
        const AlertCircleIcon = ({ className }) => <span className={className}>⚠️</span>;
        const InfoIcon = ({ className }) => <span className={className}>ℹ️</span>;
        const BrainIcon = () => <span>🧠</span>;
        const ClockIcon = () => <span>🕰️</span>;
        const SunIcon = () => <span>☀️</span>;
        const TargetIcon = () => <span>🎯</span>;

        // --- SHARED CARD DETAILS ---
        const cardDetails = {
          0: {
            name: '愚者',
            shortMeaning: '純真、勇氣、無限可能、新的開始',
            soulMission: '0號愚者作為靈魂卡牌，您的核心使命是踏上一場偉大的英雄之旅，學習無條件信任宇宙的引導，帶著純真的心和無畏的勇氣去擁抱生命中無限的可能性，並活在當下。這份信任並非盲目或天真，而是一種高度的靈性修為，是放下小我對結果的控制欲，全然相信每一步都蘊含著神聖的指引。您的內在潛能包括不受限的創造力、敏銳的直覺以及與神性直接連結的能力。您的靈魂渴望自由探索，並在每一次看似偶然的冒險中，發現深刻的智慧與生命的喜悅。您的任務是向世界證明，當一個人帶著全然的信任和開放的心投入生命之流時，宇宙會在其腳下鋪設道路。您需要學會聆聽那超越邏輯的內在衝動，將每一次失足都視為學習跳舞的契機。',
            personalityTrait: '個性上，愚者展現為充滿好奇心、樂觀積極且富有感染力的冒險家，是人群中永遠的“新鮮空氣”。您傾向於憑直覺行事，勇於嘗試新事物，不喜歡墨守成規或受到任何形式的束縛。在心理層面，這代表您與內在的“神聖孩童”保持著緊密連結，保有著那份未受世俗污染的原始智慧與驚奇感。您的思維不受傳統框架限制，能夠產生“跳躍式”的連結，這使您成為天生的創意工作者、發明家或任何需要突破性思維領域的先驅。您的天賦在於創新思維、開闢新道路和為周圍帶來輕鬆活潑的氛圍。您提醒著世界，生命本質上是一場充滿樂趣的遊戲，而非沉重的負擔。在社交場域中，您是那個能瞬間打破僵局、帶來歡笑與新奇觀點的人。',
            challenges: '愚者的主要挑戰在於將這份飄逸的能量“落地”。可能缺乏長遠規劃、容易因一時衝動而忽略現實後果、難以承擔長期的責任或完成既定任務。這種對自由的極致追求，在陰影面可能演變成一種對責任的恐懼與逃避，導致在關係、事業或學業上留下許多未竟之事。有時可能過於天真爛漫，不願面對現實的嚴肅面，或在自由與紀律之間難以取得平衡。需要學習在擁抱自由的同時，也腳踏實地，並為自己的選擇與行動全然負責，避免不必要的風險。成長的關鍵在於學習“有意識的愚者”之道：在躍下懸崖前，懂得檢查降落傘是否完好；在享受旅途的同時，也清楚自己的大致方向。學會將熱情投入到一個能貫穿始終的項目中，將是您靈魂成熟的重要標誌。'
          },
          1: {
            name: '魔術師',
            shortMeaning: '創造力、意志力、顯化、溝通',
            soulMission: '1號魔術師的靈魂使命是成為連接天地能量的橋樑，深刻理解“心想事成”背後的運作法則，學習運用高度集中的意志力和清晰的意圖，將靈界的靈感與個人潛能顯化為物質世界的現實。您的靈魂渴望掌握創造的法則，自信地運用天賦與資源去實現目標，成為自身實相的積極創造者，而非被動的接受者。您的內在潛能包括強大的創造力、如雷射般集中的意志、以及整合宇宙四元素（思想、情感、行動、物質）的智慧。您在此生的功課是學習如何成為一個純淨的管道，讓創造的能量通過您，服務於一個清晰且有益的目標，體驗到作為“共同創造者”的無上喜悅。',
            personalityTrait: '個性上，魔術師展現出自信、魅力、足智多謀和目標導向的特質，天生具備將想法付諸實踐的驅動力。您善於溝通說服，擁有卓越的規劃與執行能力，能夠有效地運用手邊的任何資源達成目的。在心理層面，象徵著有意識的自我（Ego）的成熟與力量，代表清晰的思維和實現個人意志的強大能力。您的天賦在於化腐朽為神奇，將不可能變為可能，是天生的創業者、演說家、銷售員或任何需要將抽象概念具象化的角色。您相信“方法總比問題多”，並能以積極的心態感染和引導他人，清晰地闡述願景，並將其分解為可執行的步驟。',
            challenges: '魔術師的挑戰在於個人意志的“陰影面”。可能過度依賴個人意志，導致操控傾向、自負、甚至為了達成目的而不擇手段，成為巧言令色的欺騙者。有時可能因為想掌控一切而感到過度焦慮，或因害怕失敗而不敢真正施展才華，僅僅停留在“紙上談兵”的階段。需要警惕語言的誤用（如欺騙、誇大或操縱），並學習將個人意志與更高的智慧（或集體福祉）相結合。真正的力量不在於控制，而在於引導。當您的行動不僅僅為了滿足自我，而是為了服務於更廣泛的益處時，您的顯化能力將會達到巔峰。' +
            '課題是區分自信與自大，並學會在專注目標的同時，對過程保持開放與信任。'
          },
          2: {
            name: '女祭司',
            shortMeaning: '直覺、潛意識、神秘智慧、靜默',
            soulMission: '2號女祭司的靈魂使命是深入探索內在世界的神秘領域，成為潛意識海洋的守護者與潛航員。您要學習超越二元對立的思維，連結潛意識的龐大智慧與宇宙的奧秘，成為內在與外在知識之間那道神聖的門扉。您的靈魂渴望發展深邃、精準的直覺力，學會聆聽內心最細微的聲音，並在靜默中接收超越語言的啟示。您的靈性潛能包括超凡的直覺、洞察力、預知夢境、以及直接下載宇宙集體意識信息的能力。您的任務是守護這份神聖的知識，並在適當的時機，以神秘而隱晦的方式，將智慧傳遞給準備好接收的人，成為一位無言的靈性導師。',
            personalityTrait: '個性上，女祭司表現為神秘、內斂、沉靜且具有深不可測的深度。您傾向於觀察與反思，而非直接行動，喜歡獨處以連結內在的能量。您對深層次的心靈交流和神秘學、心理學等領域極感興趣。在心理層面，代表潛意識的智慧、陰性接收原則以及對未知領域的敬畏與探索。您的天賦在於洞察事物的本質，能夠輕易看穿表面的虛飾，直達問題的核心。您像是擁有一面“真實之鏡”，能反映出他人內心深處的動機與真相。您散發著一種寧靜而強大的氣場，讓人不自覺地對您吐露心聲，尋求指引。',
            challenges: '女祭司的挑戰在於可能過度內向，沉浸在自己的內心世界裡，與現實生活產生脫節，或因情感的過度壓抑而顯得冷漠、難以親近。有時可能因害怕被誤解或智慧被濫用，而選擇徹底的沉默，隱藏真實的感受與洞見，錯失了將智慧付諸實踐的機會。在直覺與邏輯之間，您可能會經歷劇烈的掙扎，懷疑自己接收到的信息。需要學習將內在的智慧適當地表達和應用於現實世界，找到一種“翻譯”內在語言的方式。在獨處與社交之間找到健康的平衡，避免自我孤立，並信任自己有能力去分辨何時該分享、何時該靜默。'
          },
          3: {
            name: '女帝',
            shortMeaning: '豐饒、母性、創造、滋養與感官享受',
            soulMission: '3號女帝的靈魂使命是成為生命力、豐盛與無條件之愛的管道，全然地體現並散播宇宙的創造能量。您的靈魂渴望體驗並分享生活中的一切喜悅與美好，不僅在物質層面創造豐盛，更在情感與精神層面滋養自己與他人。您需要學習與大地母親（Gaia）的頻率校準，與自然的生長週期和諧共處。您的內在潛能是源源不絕的創造力、強大的療癒能量、以及與萬物生長節律的深度連結。您的任務是在地球上建立一個充滿愛、美與和諧的“伊甸園”，無論這個伊甸園是一個家、一個社群、一個藝術項目，還是一種生活態度。您是來慶祝生命本身的。',
            personalityTrait: '個性上，女帝展現出溫暖、關愛、慷慨且富有創造力的照顧者特質。您熱愛一切美好事物，享受美食、藝術、音樂等感官體驗，並具有將任何平凡事物變得更美好的天賦。在心理層面，象徵著創造力、無條件的愛、以及接納與包容的母性原型。您擅長營造和諧、舒適、滋養的環境，無論身在何處，都能讓人感到放鬆與被接納。您能自然地吸引豐盛來到生命中，因為您從內心深處相信宇宙是富足的。您是天生的藝術家、園丁、廚師、治療師，或任何能為世界帶來美與滋養的角色。',
            challenges: '女帝的挑戰在於豐盛能量的失衡。可能過度沉溺於物質享受與感官逸樂，變得懶散、奢侈或過度放縱。在人際關係中，可能因過度保護或控制所愛的人而演變成“窒息的愛”，或因情感氾濫而缺乏健康的個人邊界感。有時可能在付出與接受之間嚴重失衡，不斷地給予而忽略了自我照顧，導致耗竭；或者因為害怕匱乏而緊抓不放，阻礙了豐盛的流動。需要學習設定健康的界線，明白真正的愛是允許他人獨立成長。同時，要將強大的創造力導向有意識的、建設性的方向，而非僅僅是無節制的享樂，找到付出與自我滋養的完美平衡。'
          },
          4: {
            name: '皇帝',
            shortMeaning: '權威、結構、穩定、領導與秩序',
            soulMission: '4號皇帝的靈魂使命是在物質世界中學習建立穩固、持久且有益的結構與秩序，成為一位充滿智慧、負責任且公正的領導者。您的靈魂渴望將混亂轉化為條理，將願景構建成可行的藍圖，並運用權威來保護、建設與維護一個安全穩定的環境。您需要發展卓越的自律精神、堅定的責任感、高瞻遠矚的策略思維以及在混亂中建立秩序的智慧。您的任務不僅是為自己建立王國，更是要創造一個能讓他人安心成長與發展的系統，成為社會的中流砥柱，體現神聖的陽性原則——那份創造穩定與安全的父性力量。',
            personalityTrait: '個性上，皇帝展現出權威、務實、有組織且具決斷力的領導者特質。您重視規則、效率和目標達成，擁有強大的執行力與與生俱來的責任感。您相信“沒有規矩，不成方圓”，並以此為準則行事。在心理層面，代表陽性原則、邏輯思維、社會規範以及掌控外在局面的能力。您的天賦在於建立系統、制定長遠計劃並有效地管理資源與人員。您是天生的管理者、創業者、政治家或任何需要結構性思維與領導力的角色。在他人眼中，您是可靠的、值得信賴的靠山，能夠在危機時刻保持冷靜，指明方向。',
            challenges: '皇帝的挑戰在於權威的僵化。可能過於固執己見、缺乏彈性或控制慾過強，導致專斷獨行，聽不進不同的意見。有時可能因害怕失控而過度壓抑自己和他人的情感，將生活變得像一部精密的機器，缺乏溫情與人性。因為追求完美與效率，可能對自己和他人過於嚴苛，成為一位暴君而非明君。需要學習在權威與仁慈之間取得平衡，在堅持原則的同時，保持靈活的適應性。真正的力量不僅在於掌控，也在於賦權。學會聆聽他人的意見，適應變化，並理解秩序的最終目的是為了服務生命，而非扼殺創造力與情感的流動。'
          },
          5: {
            name: '教皇',
            shortMeaning: '精神指引、傳統、教育、信仰與規範',
            soulMission: '5號教皇的靈魂使命是成為智慧的傳承者與道德的指引者，在精神信仰與物質社會之間建立一座堅實的橋樑。您的靈魂渴望探索並分享那些經得起時間考驗的真理與信仰體系，遵循並傳播有益於集體意識成長的傳統與規範。您的任務是將高深的智慧“翻譯”成普通人能夠理解和遵循的語言與儀式，為迷茫者提供結構性的精神指引。您的靈性潛能包括卓越的教導能力、諮詢天賦、以及對集體智慧和文化傳承的深刻理解。您是來幫助人們找到歸屬感與生命意義，將個體與更大的社群、傳統和信仰連結起來。',
            personalityTrait: '個性上，教皇展現出傳統、有原則、重視道德且具有教導傾向的特質。您喜歡探索事物的深層意義，對歷史、哲學、宗教等領域有濃厚興趣，尋求知識，並樂於將所學系統化地分享出去。在心理層面，代表著超我（Superego）、良知以及對更高意義和社群歸屬感的追尋。您通常是值得信賴的顧問、老師或導師，能夠提供有結構、有步驟的指引。您尊重權威和既定體系，相信通過學習和遵循前人智慧，可以少走彎路。您是團體中的“定心丸”，為組織提供價值觀和行為準則。',
            challenges: '教皇的挑戰在於可能過於固守傳統、墨守成規，或變得教條主義、思想僵化，批判性過強。有時可能因為害怕偏離既定的規範而扼殺創新精神，或將個人的信念體系當作唯一的真理，強加於人，缺乏包容性。在陰影面，可能變成一個“偽善者”，說一套做一套，或是盲目地崇拜權威而喪失獨立思考的能力。需要學習區分盲從與智慧傳承的區別，保持思想的開放性，並理解所有教條的最終目的都是為了引導人通向內在的智慧，而非成為新的枷鎖。學會尊重個體的自由意志與不同的人生道路，明白真理有多種樣貌，是您成熟的關鍵。'
          },
          6: {
            name: '戀人',
            shortMeaning: '愛情、選擇、關係、價值觀與和諧',
            soulMission: '6號戀人的靈魂使命是深刻地學習愛的真諦，這不僅僅指浪漫愛情，更包含對自我不同面向的愛與整合。您需要在各種關係（親情、友情、愛情）中實現個人的完整與平衡，並根據內心最真實的價值觀做出重大的生命抉擇。您的靈魂渴望體驗深刻的連結、共鳴與和諧，並在愛與被愛的雙向流動中療癒與成長。您需要發展出愛的能力、在十字路口做出明智選擇的智慧，以及整合內在陽性與陰性、理性與感性等對立面的能力。您的終極任務是達成內在的“神聖婚姻”，從而能在外在世界中建立真正健康、平等的夥伴關係。',
            personalityTrait: '個性上，戀人展現出迷人、友善、善於交際且極度重視人際關係的特質。您渴望和諧，注重美感，天生就懂得如何建立連結與促進合作。在做決定時，您會本能地考慮他人的感受與關係的整體和諧。在心理層面，這張牌代表著整合內心不同面向（如阿尼瑪與阿尼姆斯）的過程、對深刻連結的渴望以及個人價值觀的形成與確立。您通常是團隊中受歡迎的“黏著劑”，能夠促進團隊合作與溝通。您對美與和諧有著敏銳的感知力，無論是在人際互動還是藝術創作中都能體現出來。',
            challenges: '戀人的挑戰在於選擇的困境與關係的依賴。在面對重要的生命選擇時，您可能因為害怕做出錯誤決定而陷入長時間的猶豫不決，或是過度依賴他人的意見而失去主見。在關係中，可能因過度追求表面的和諧而壓抑、犧牲自己真實的感受與需求，或者在情感中迷失自我，界線不清。對承諾可能感到恐懼，害怕選擇了一方就意味著永遠失去另一方的可能性。需要學習為自己的選擇勇敢地負起責任，並忠於內心最深處的價值觀，即使這意味著可能會產生暫時的衝突。發展獨立性和清晰的自我認知是您此生的重要課題，學會先與自己戀愛，才能擁有健康的對外關係。'
          },
          7: {
            name: '戰車',
            shortMeaning: '決心、勝利、掌控方向、意志力與行動',
            soulMission: '7號戰車的靈魂使命是學習駕馭內在的矛盾力量——如同駕馭兩匹方向相反的黑白 Sphinx（人面獅身獸），以鋼鐵般的意志力和高度專注的行動力，克服內外在的重重障礙，朝向一個明確、有價值的目標勇敢前進，並最終贏得世俗與心靈的雙重勝利。您的靈魂渴望體驗到通過自律與整合，完全掌控自我與環境的強大力量。您的靈魂潛能是無堅不摧的意志力、卓越的自律精神以及整合對立力量（如情感與理智、野心與耐心）以達成宏大目標的能力。您的任務是證明，堅定的意志是穿越人生戰場、達成使命的最強大武器。',
            personalityTrait: '個性上，戰車展現出決心堅定、目標導向、充滿自信且富有競爭力的特質。您是天生的行動派，一旦設定目標，便會全力以赴，不達目的誓不罷休。您勇於面對挑戰，享受克服困難帶來的成就感，並渴望獲得勝利與公眾的認可。在心理層面，代表著強大的自我（Ego）力量的展現、意志力的有效運用以及成功克服內心衝突的過程。您的天賦在於領導眾人衝鋒陷陣，完成艱難的任務。您是項目經理、運動員、軍事領袖的絕佳原型，總能在高壓環境下保持專注，驅動自己和團隊向前。',
            challenges: '戰車的挑戰在於意志力的過度使用與方向的偏失。可能變得過度好鬥、缺乏耐心，或為了追求目標而不顧一切，忽略他人的感受與需求，給人以冷酷、橫衝直撞的印象。有時可能因意志力過強而顯得固執己見，無法聽取忠告；或反過來，因害怕失敗而將自己“包裹”在堅硬的盔甲之下，逃避真正的挑戰。需要學習平衡野心與同情心，控制內心的衝動，並時常反思：自己前進的方向是否真的符合內心最高的價值與益處，而非僅僅是出於自我的征服慾。學會慢下來，聆聽內在的聲音，確保您的“戰車”行駛在正確的道路上，是成熟的關鍵。'
          },
          8: {
            name: '力量',
            shortMeaning: '內在力量、勇氣、耐心、慈悲與整合本能',
            soulMission: '8號力量的靈魂使命是發現並運用內在真正的力量——那並非來自肌肉或強權，而是源於愛、勇氣、耐心與慈悲的力量。您需要學習去溫柔地“馴服”內在的野獸，即我們的原始本能、激情、恐懼與憤怒，將其從具有破壞性的衝動轉化為源源不絕的生命力與創造力。您的靈魂渴望以柔克剛，以溫柔而堅定的方式克服內外挑戰，展現出靈魂的堅韌與優雅。您的靈性潛能包括深厚的內在勇氣、強大的情緒療癒能力和不動聲色化解衝突的智慧。您的任務是向世界展示，真正的強大在於整合而非壓抑，在於慈悲而非控制。',
            personalityTrait: '個性上，力量展現出溫和而堅定、富有耐心、同情心且具有強大安撫人心的特質。您不喜歡用外在的強勢或音量來取胜，而是以內在的毅力、沉著與慈悲來影響和引導他人。在心理層面，這代表著本能（Id）與超我（Superego）的和諧整合，是情緒成熟、內心和諧的象徵。您的天賦在於在困境中保持冷靜與韌性，能夠安撫激動的人群，療癒受傷的心靈。您是天生的治療師、諮詢師、教師或任何需要耐心與同理心的角色。您身上散發出一種寧靜的自信，讓人感到安全與被理解。',
            challenges: '力量的挑戰在於“溫柔”的陰影面。可能因過度壓抑自身的需求與正常的憤怒情緒，以維持表面的和平與形象，導致內在能量的瘀堵。或因害怕衝突而逃避必要的對抗，難以設定健康的個人邊界，最終導致自我消耗或被他人利用。有時，您可能會懷疑自己內在的力量，錯誤地認為只有外在的強硬才算強大。需要學習平衡溫柔與堅定，肯定自我價值，並在適當的時候展現果斷，“溫柔地說不”。明白真正的力量並非軟弱，它包含著在需要時展示獠牙以保護自己和所愛之人的勇氣。學會擁抱並健康地表達自己的全部情緒，是您力量完全綻放的關鍵。'
          },
          9: {
            name: '隱士',
            shortMeaning: '內省、尋求真理、智慧、指引與獨處',
            soulMission: '9號隱士的靈魂使命是通過深入的內在探索、反思與獨處，點亮內在智慧的提燈，尋求並獲得關於生命、宇宙與自我的深刻真理。您的旅程是向內的，而非向外的。在遠離塵世喧囂的靜默中，與您內在的導師（Higher Self）建立穩固的連結。當您自身的智慧之光足夠明亮時，您的下一個任務便是成為他人生命旅程中的指路明燈，以溫和、不干預的方式，為後來者照亮前方的道路。您需要發展在孤獨中汲取智慧而非陷入孤僻的能力，以及用溫和低調的方式分享深刻洞見的靈性指導能力。您是真理的尋求者，最終成為智慧的給予者。',
            personalityTrait: '個性上，隱士展現出內省、沉靜、智慧且享受獨處的深度思考者特質。您不追求外在的社交喧囂，更傾向於探索事物的本質與背後的深刻意義。您是人群中的“老靈魂”，對膚淺的談話不感興趣。在心理層面，代表著對內在智慧的追尋、審慎的態度以及高度獨立思考的能力。您的天賦在於提供深刻的、經過深思熟慮的洞見與指導。您是天生的學者、研究員、哲學家或靈性顧問。別人遇到複雜難解的問題時，會來尋求您的意見，因為您總能從一個更高、更宏觀的角度提供獨到的見解。',
            challenges: '隱士的挑戰在於可能過度孤立自我，與社會和現實生活脫節，或因過度沉思而變得悲觀、憤世嫉俗或猶豫不前，錯失行動的良機。有時可能因害怕被外界打擾或智慧被誤解，而將自己封閉起來，拒絕與人分享寶貴的智慧，變成一個孤僻的怪人。由於追求智慧的標準極高，可能對自己和他人顯得過於挑剔。需要學習在獨處充電與融入社群之間找到健康的平衡，將內在的智慧應用於實際生活，而不只是停留在腦海裡。學會信任他人的成長過程，用更輕鬆、更具互動性的方式分享您的光，而非僅僅是站在山頂上遙遙指引。'
          },
          10: {
            name: '命運之輪',
            shortMeaning: '命運轉變、機會、週期、轉捩點與順應潮流',
            soulMission: '10號命運之輪的靈魂使命是深刻理解並全然接受生命的週期性、無常變化與因果法則。您要學習在每一次起落浮沉中保持內在的中心與平靜，在命運的順境中保持謙遜，在逆境中保持希望。您的靈魂渴望順應宇宙的宏大節奏，而非與之抗衡，並在每一次轉變中找到靈性成長的機會與更深層的生命意義。您的靈魂潛能是卓越的適應能力、洞察生命週期背後運作模式的智慧，以及在關鍵時刻把握時機的能力。您的任務是成為一個活生生的例子，證明真正的自由並非控制命運，而是在命運的輪轉中，保持覺知，優雅共舞。',
            personalityTrait: '個性上，命運之輪展現出樂觀、適應力強、具有哲學思維且樂於接受改變的特質。您通常能從容應對生活中的突如其來，並本能地從中看到新的可能性與契機。您對“運氣”、“同步性”和“命運”等概念有著天生的理解。在心理層面，代表著對生命循環往復的認知、對未知的好奇心，以及相信“一切都是最好的安排”的根本信念。您擅長抓住機會，隨遇而安，是那種“總在對的時間出現在對的地點”的人。您的人生往往充滿了戲劇性的轉折和有趣的巧合，您也樂在其中，視其為一場宏大的冒險。',
            challenges: '命運之輪的挑戰在於可能在主動與被動之間失衡。可能過度依賴“運氣”或“命運”而缺乏主動創造的意願，變得消極宿命。或在面對逆境時，感到徹底的無力，完全聽天由命，放棄了自己可以努力的部分。另一方面，可能因害怕錯過任何一個機會而變得焦躁不安，追逐每一個可能性，結果在不斷的變化中缺乏穩定性與扎根感，無法積累任何實質性的成果。需要學習在順應宇宙大潮流的同時，也穩穩地掌好自己的小船之舵，在可控的範圍內積極行動。從每一次的順逆循環中學習寶貴的經驗，建立內在永恆不變的定力，這才是您真正的財富。'
          },
          11: {
            name: '正義',
            shortMeaning: '公正、平衡、真理、因果法則與責任',
            soulMission: '11號正義的靈魂驅動力是追求並體現宇宙的絕對真理、公平與內外在世界的完美平衡。您的生命目標是深刻理解並活出因果法則（Karma）的智慧，即：我們所有思想、言語和行為都會產生相應的結果。您被召喚為自己的所有選擇負起全部責任，並致力於在個人生活乃至更廣泛的社群中，創造一個更公正、透明與和諧的環境。您的潛能是如水晶般清晰的判斷力、不受個人情感偏見影響的無私客觀性，以及維護宇宙平衡的堅定意志。您的任務是成為真理的代言人與平衡的守護者。',
            personalityTrait: '作為個性卡牌時，您展現出強烈的公平正義感、清晰的邏輯思維和高度的誠實與正直。您極度重視事實、證據與邏輯，力求在任何情況下都保持客觀中立，並期望他人也能如此。在做決定時，您會仔細權衡所有利弊，追求最合理、最公平的解決方案。在早期，您可能因為對真理的執著而顯得過於理想化或不善變通，但在成熟期，您則能成為他人極為信賴的道德指南針、可靠的仲裁者與顧問，總能以理服人，清晰地剖析複雜問題的根源。您是法律、科學、會計或任何需要精確與公正領域的理想人選。',
            challenges: '正義的挑戰在於可能變得過度嚴厲、批判、缺乏彈性或不近人情，成為一台冰冷的“審判機器”。您對自己或他人可能有不切實際的完美標準，這會導致過度的自我批評或對他人吹毛求疵，難以原諒錯誤。在追求絕對公平的過程中，有時會忽略人類情感的複雜性與個體差異，顯得冷酷無情。需要學習在理智與情感、公正與慈悲之間取得精妙的平衡。理解“法理不外乎人情”，學會寬恕（對自己和他人），是您重要的功課。真正的智慧不僅在於看到黑與白，更在於理解并接納其間廣闊的灰色地帶，避免陷入僵化的律法主義。'
          },
          12: {
            name: '倒吊人',
            shortMeaning: '犧牲、新視角、等待、臣服與頓悟',
            soulMission: '12號倒吊人的靈魂渴望通過自願的暫停、放下舊有觀念或在看似停滯的狀態中，來獲得更高層次的理解與靈性覺醒。您的生命目標是學習“臣服”的藝術，這不是消極的放棄，而是積極地將個人意志與宇宙的更高意志校準，從而在全然的接納中體驗到內在的平靜與神聖的智慧。您的潛能是超凡的耐心、超越常規二元對立的洞察力，以及從逆境和等待中轉化出深刻智慧與頓悟的能力。您的任務是向世界展示，有時候，真正的進展發生在靜止之中，而放手，是為了獲得更多。',
            personalityTrait: '個性特徵上，您深具耐心與與眾不同的視角，善於反思，不畏懼從一個完全相反的角度去看待人和事。您能夠在逆境和漫長的等待中保持內心的平靜與成長。您的人生哲學往往與主流格格不入，但卻蘊含著深刻的智慧。在早期，您可能因為觀點獨特而感到與周圍世界格格不入，甚至被誤解。但隨著成熟，您可能成為一位具有非凡洞察力的精神導師、藝術家或思想家，幫助那些陷入僵局的人看到全新的可能性，打破他們的思維定式。您擁有一種“靜水流深”的魅力。',
            challenges: '倒吊人的挑戰在於可能將“臣服”誤解為“ निष्क्रिय”，陷入長期的拖延、被動等待、自我犧牲到失去自我的境地，或發展出無助的受害者心態。有時可能因為過於沉浸在自己的內在世界或獨特的觀點中，而與現實生活完全脫節，變得不切實際。需要學習區分必要的、有意識的臣服與無謂的、逃避責任的犧牲。在等待的過程中，要保持積極的內在探索與覺知，而非消極地停滯不前。設定清晰的界限，確保您的“犧牲”是為了更高目的的投資，而非自我價值的貶低。學會分辨何時該掛起，何時該把自己“放下來”採取行動，是智慧的體現。'
          },
          13: {
            name: '死神',
            shortMeaning: '結束與新生、轉變、放下、徹底改變',
            soulMission: '13號死神的靈魂使命是深刻理解並擁抱生命中無可避免的、持續發生的結束與開始的宏大循環。您被召喚去成為“轉化”的代理人，不僅要勇敢地協助自己放下所有不再服務於靈魂最高利益的人事物、信念和模式，也要在必要時引導他人完成他們生命中的重大蛻變。您的潛能是強大的轉化力、不執著的智慧，以及引導靈魂度過“死亡”（象徵性的終結）並迎來新生的能力。您的任務是去除所有非本質的東西，讓生命的真我得以重生，向世界證明，每一次終結都孕育著一個更加真實、更有活力的新開端。',
            personalityTrait: '個性表現為深具洞察力，不懼怕深刻的改變，甚至可能主動尋求或促成劇烈的轉變。您天生就能看透事物的本質，對於那些虛偽、過時或無益的關係與結構，您有著快刀斬亂麻的勇氣。在他人眼中，您可能是帶來重大轉折點的“催化劑”或“清道夫”，您的存在本身就會加速必要的終結。在早期，您的人生可能經歷比常人更多的變動、分離或失落，但這些經歷將錘煉出您非凡的韌性。成熟後，您能成為出色的危機處理專家、改革者或安寧療護者，幫助他人釋放舊有模式，安然度過轉變的陣痛。',
            challenges: '死神的挑戰在於對“結束”的恐懼或濫用。一方面，可能因為害怕未知的將來和失去的痛苦，而死死抓住早已腐朽、不再適合自己的人事物不放，從而極大地抗拒必要的改變，讓轉化的過程變得異常痛苦和漫長。另一方面，也可能反向而行，因為渴望改變而變得草率、魯莽，輕易地切斷尚未ถึง終點的關係或事業，造成不必要的破壞。有時可能顯得冷酷無情，或因沉溺於過去的失落感中而變得悲觀，難以真正向前邁進。需要學習以建設性的方式擁抱轉變，區分必要的終結與逃避性的割捨，並在過程中給予自己和他人足夠的哀悼與過渡時間，讓新生自然發生。'
          },
          14: {
            name: '節制',
            shortMeaning: '平衡、調和、整合、耐心與中庸之道',
            soulMission: '14號節制的靈魂尋求在所有層面——身體、心智、情感與精神上——達到完美的平衡、和諧與煉金術般的整合。您的生命目標是學會在看似對立的兩極力量（如物質與精神、內在與外在、行動與靜默、給予與接受）之間找到那條神聖的中道，並將它們巧妙地融合成一個更高階的、和諧的整體。您的潛能是卓越的調解能力、創造性的融合能力、以及實現身心靈深度整合的療癒天賦。您的人生是一場持續的“煉金實驗”，旨在將平凡的生命元素轉化為靈性的黃金，成為一個內外合一、寧靜而充滿力量的存在。',
            personalityTrait: '外在表現為一位天生的外交家、調和者與煉金術士。您擁有將不同甚至衝突的元素巧妙融合在一起的非凡能力，無論是調配一杯完美的雞尾酒，還是在爭吵的雙方之間促成和解。您通常心態平和，富有耐心，總能在複雜混亂的情況中找到那個精妙的平衡點與解決方案。您追求的是長期的、可持續的穩定與和諧，而非短暫的、極端的激情。您是那種能夠將多種才華或興趣融會貫通，創造出獨特事業或生活方式的人。您散發著一種寧靜致遠的氣質，讓人感到穩定與療癒。',
            challenges: '節制的挑戰在於可能為了維持表面的和諧而過度妥協，以至於失去自己的立場和聲音，變成一個“和事佬”或好好先生。在做決定時，可能因為想要完美地平衡所有因素而顯得猶豫不決，錯失良機。有時，對中庸之道的過度追求可能讓生活變得平淡、乏味，缺乏必要的激情與衝勁。您需要學習在必要的時候，能夠堅定地站在某一方，明白真正的平衡並非一成不變的靜止狀態，而是一個動態的、持續調整的過程。它有時需要加入一些“不和諧”的音符來創造出更豐富的樂章。學會擁抱必要的張力，而非一味地規避它，是您成長的關鍵。'
          },
          15: {
            name: '惡魔',
            shortMeaning: '慾望、束縛、物質主義、陰影面與誘惑',
            soulMission: '15號惡魔的靈魂課題是勇敢地潛入人性最深的層面，去理解、面對並整合自身的陰影面、原始慾望與根本恐懼。您的生命目標不是要消滅“惡魔”，而是要將其從無意識的、造成束縛的枷鎖，轉化為有意識的、可被駕馭的強大生命力與創造力。您需要通過直面那些被自己壓抑或否認的部分，來實現真正的自由。您的潛能是強大的、未經稀釋的生命力、洞察人性深層動機的銳利眼光，以及打破成癮模式、轉化內外束縛的無比勇氣。您的任務是找回自己被囚禁的力量，成為自己慾望的主人，而非奴隸。',
            personalityTrait: '個性特徵上，您可能充滿了強烈的激情、幽默感與生命活力，對物質世界有著極強的感受力和享受欲。您通常直接坦率，不懼世俗眼光，散發著一種原始的、極具吸引力的個人魅力。但也因此，您更容易受到各種誘惑的吸引，或陷入某種形式的執著之中。在早期，您的人生可能在極端的放縱與嚴苛的壓抑之間劇烈擺盪。成熟後，您則能學會以一種健康、有意識的方式去擁抱和駕馭自身強大的慾望，將其轉化為事業上的驅動力、藝術上的創造力或關係中的激情。您懂得人性的複雜，因此也更具幽默感與包容力。',
            challenges: '惡魔的核心挑戰在於容易陷入各種形式的“成癮”與“束縛”。這可以表現為物質成癮（菸酒、毒品）、情感依賴（不健康的關係）、權力慾、金錢崇拜，或是被限制性的信念和深層的恐懼所牢牢控制。您需要警惕自我欺騙和合理化不健康行為的傾向。勇敢地承認並面對內心的陰影——那些您不喜歡的、評判為“壞”的部分——是解放的第一步。學習區分能帶來快樂的健康慾望與導致痛苦的有害沉溺至關重要。真正的力量來自於看清鎖鏈，並意識到鑰匙一直在自己手中，而非試圖忽視或美化這個牢籠。'
          },
          16: {
            name: '塔',
            shortMeaning: '突變、覺醒、解放、舊結構瓦解與真相顯露',
            soulMission: '16號高塔的靈魂使命是成為神聖意志的“破壞者”，勇敢地去面對和推動那些必要的、顛覆性的瓦解。您被召喚去摧毀那些建立在虛假、自大、限制性信念或過時結構之上的生活模式，無論那是您內在的“心靈監獄”，還是外在不健康的工作或關係。其目的是為了給一個更真實、更穩固、更符合靈魂藍圖的基礎騰出空間，從而迎來一次深刻的、閃電般的覺醒與徹底的解放。您的潛能是帶來突破性改變的巨大勇氣、洞察真相核心的能力，以及在廢墟之上迅速重建的強大力量。您的任務是迎接和引導變革，即使它以毀滅的形式到來。',
            personalityTrait: '個性表現為擁有強大意志力與不破不立的氣魄。您可能是天生的變革者、革命家或“真相揭露者”，您的存在往往會無意中或有意地引發周圍環境、制度或人際關係的劇烈變動與危機。您無法容忍虛偽與停滯，會本能地去挑戰那些不再服務於真理的權威和結構。在早期，您的人生可能充滿了突如其來的意外、危機和顛覆性的事件，讓您不斷地“清零重來”。成熟後，您能有意識地運用這股力量，成為他人生命中轉機的催化劑，幫助他們打破僵局，獲得新生。',
            challenges: '高塔的挑戰在於可能經歷頻繁的、戲劇性的、令人痛苦的生活動盪，或因極力抗拒改變而讓那不可避免的崩塌變得更加慘烈。有時可能因過於直接、衝動或缺乏策略，而造成不必要的破壞，傷害到無辜的人。在陰影面，您可能會無意識地被混亂所吸引，甚至“上癮”，在生活中不斷製造戲劇性事件。您需要學習信任生命中突如其來的變革，即使它們看起來是毀滅性的，並從每一次“倒塌”中謙卑地汲取教訓。學會區分神聖的摧毀與小我的破壞，並在“拆除”之後，積極地投入到“重建”一個更符合真我的、更具彈性的新生活中。'
          },
          17: {
            name: '星星',
            shortMeaning: '希望、靈感、治癒、平靜與精神指引',
            soulMission: '17號星星的靈魂使命是在經歷了高塔般的混亂或挑戰之後，重新找回內心的純淨、寧靜與對宇宙的信任，並成為他人生命中的希望之光與靈感之泉。您的生命目標是將這份來自宇宙的、清澈的療癒能量，像星星在夜空中灑下光芒一樣，無私地傾瀉到世界上，傳播治癒、平靜與對未來的堅定信心。您的潛能是強大的能量療癒力、與更高指引（如指導靈、天使）的深邃連結，以及用藝術、話語或存在本身去鼓舞人心的能力。您的任務是提醒自己和他人，在最深的黑暗之後，必有星光閃耀，而希望本身就是一種強大的創造力量。',
            personalityTrait: '個性特質上，您通常樂觀、充滿希望、富有同情心，並對未來抱持著美好的憧憬。您可能擁有天生的療癒天賦或非凡的藝術才華（音樂、寫作、繪畫等）。您就像一個清澈的管道，能為周圍焦慮、沮estopped的人帶來平靜、安慰與啟示，引導他們看到困境中的光明面和可能性。您的靈性成長方向是持續淨化自己，發展直覺和療癒能力，成為光與愛的工作者。早期可能顯得過於理想化、不切實際，但成熟後，您將成為他人風雨飄搖時可以仰望的、穩定而明亮的“北極星”。',
            challenges: '星星的挑戰在於可能因為過於理想化而與現實脫節，難以應對日常生活的瑣碎與醜陋。或在不斷給予他人希望與療癒能量時，忽略了自身的需求，導致能量耗竭與“慈悲疲勞”。有時，您可能因對未來抱持不切實際的幻想，一旦現實不如預期，便會陷入極大的失望與幻滅之中，甚至在逆境中短暫失去信心。需要學習在保持希望的同時，雙腳堅實地踩在大地上。學會在療癒他人的過程中，也為自己“充電”，設定健康的界限。真正的希望，是即使看清了世界的複雜與不完美，依然選擇相信光明。'
          },
          18: {
            name: '月亮',
            shortMeaning: '幻象、直覺、潛意識、恐懼與夢境',
            soulMission: '18號月亮的靈魂使命是勇敢地踏上通往潛意識深海的夜航，穿越內心最古老的恐懼、未解的情感與集體無意識的幻象，從而打撈出深刻的直覺智慧與創造力的珍珠。您的生命目標是學會信任那非理性的、超越語言的內在指引，即使在充滿迷霧與不確定的道路上。您是來成為意識與無意識世界之間的橋樑，將夢境的語言、象徵的啟示帶入現實。您的潛能是卓越的通靈級直覺力、如海洋般浩瀚的想像力、以及對人性陰影與集體神話的深刻理解。您的任務是走過這條迷人的、有時甚至是駭人的內在之路，並證明真正的智慧往往隱藏在最深、最暗的地方。',
            personalityTrait: '個性敏感、富有同情心、想像力極其豐富，並具有強烈的直覺力與超感官知覺（ESP）。您可能對夢境、象徵、神話、藝術和所有神秘事物都深感著迷。您像一塊海綿，能輕易地吸收周圍環境與他人的情緒。您的內心世界豐富多彩，充滿了各種奇異的景象與感受。早期，您可能因為難以區分真實的直覺與由恐懼產生的幻象而感到困惑、焦慮，情緒波動較大。但隨著成熟，您能學會駕馭這份天賦，成為深刻的藝術家、詩人、心理治療師、解夢者或靈媒，引導他人探索他們自己的內心迷宮。',
            challenges: '月亮的核心挑戰在於容易在幻象與現實之間迷失。您可能過度受到環境或他人負面情緒的影響，陷入週期性的焦慮、憂鬱、困惑或自我欺騙。內心深處未被正視的恐聞，可能會被投射到外界，導致您在關係或決策中做出非理性的選擇，或看到不存在的威脅。您需要學習建立清晰、堅固的個人能量邊界，並培養分辨幻象與真相的“內在偵探”能力。 grounding（扎根）練習對您至關重要。有意識地將潛意識的洞見用寫作、藝術等方式表達出來，將其帶入意識的光明之中，而不是被其淹沒，是您此生最重要的功課。'
          },
          19: {
            name: '太陽',
            shortMeaning: '快樂、成功、活力、清晰與生命力',
            soulMission: '19號太陽的靈魂使命是全然地、不帶歉意地展現內在的光明、喜悅與勃勃生機，成為純粹的愛與真理的活生生的化身，從而照亮自己和周圍的世界。您的生命目標是活出那個最真實、最燦爛的自我，毫不掩飾地去體驗並分享生命的豐盛、成功與單純的快樂。您來此是為了證明，當一個人與其核心本質完全合一時，生命本身就是一場慶典。您的潛能是無限的活力、如陽光般穿透一切迷霧的清晰洞察力、天生的領導魅力以及為他人帶來快樂、溫暖與啟迪的強大能力。您的任務就是：成為光，散發光。',
            personalityTrait: '外在表現為樂觀開朗、精力充沛、充滿自信與熱情，散發著領袖氣質和溫暖的感染力。您是人群中的“發光體”，您的出現總能驅散陰霾，帶來歡聲笑語。您通常能清晰地看到事物的本質，思路簡潔明了，並能以極其積極的態度面對生活的挑戰。您的生命課題是學會在任何困境中，都能與內在永不熄滅的光明與樂觀連結。在早期，可能顯得有些天真或以自我為中心，不理解他人的複雜情緒。但隨著成熟，您將成為一位卓越的激勵者、領導者和啟發者，用您的成功和喜悅去點燃他人的希望。',
            challenges: '太陽的挑戰在於光芒的過度與陰影。可能因為過度自信而變得自負、傲慢，或在享受成功的同時忽略了他人的貢獻與需求。或因害怕失去光芒、不再是眾人焦點而過度追求外界的掌聲與認可，活在“偶像包袱”之下。有時，您過於強大的能量可能顯得咄咄逼人，無意中“灼傷”了那些比較敏感的人。過度的樂觀也可能讓您低估困難，缺乏周詳的計劃。需要學習將個人的光芒與謙遜相結合，明白真正的太陽是照亮萬物，而非僅僅照耀自己。學會在享受成功的同時，保持對生命深層意義的覺察與對他人的同理心，讓您的光明既溫暖又滋養。'
          },
          20: {
            name: '審判',
            shortMeaning: '覺醒、重生、召喚、評估與寬恕',
            soulMission: '20號審判的靈魂使命是回應來自靈魂深處或宇宙更高意識的召喚，經歷一次深刻的、決定性的靈性覺醒與重生。這需要您對過往的人生進行一次徹底、誠實的評估，放下所有舊有的包袱、自我評判與對他人的怨恨，從而以一個全新的、更真實的身份，活出更有意義、更有使命感的生命。您的目標是協助自己和他人從舊有的、限制性的“墳墓”中解放出來，成為集體覺醒的催化劑。您的潛能是深刻的轉化力、接收和傳遞更高層次指引的清晰管道，以及促進個人與集體療癒和寬恕的能力。您是來宣告一個舊時代的結束和新紀元的開始。',
            personalityTrait: '個性上，您通常具有強烈的使命感和深刻的反思能力。您能感知到超越日常瑣碎生活的更高層次的召喚，並尋求人生的終極意義。您可能在生命中的某個關鍵時刻，扮演著喚醒他人、推動重大革新或對某個組織、家庭進行重要評估的角色。您對過去的經歷有著深刻的洞察力，不把它們看作錯誤，而是視為通往覺醒的必經之路，並尋求從中學習，以邁向全新的開始。您極度重視誠實、真相與自我負責，並期望他人也能如此。您是那種能做出重大人生轉變，並激勵他人也這麼做的人。',
            challenges: '審判的挑戰在於“評判”的陰影面。您可能過於嚴厲地評判自己過去的“罪過”，或對他人吹毛求疵，沉溺於過去的遺憾與悔恨中無法自拔，讓自己背負沉重的內疚感。有時，您可能因為害怕面對真相或即將到來的巨大改變，而刻意忽略或抗拒內心的召喚，繼續“裝睡”。也可能將自己的覺醒標準強加於人，變得急躁和不耐煩。您需要學習的關鍵課題是真正的“寬恕”——這是一種釋放，不僅是原諒他人，更是徹底地原諒自己。放下不必要的內疚感，以慈悲的心態來面對自己和他人的人生轉型期，並相信每個人都有自己的覺醒時間表。'
          },
          21: {
            name: '世界',
            shortMeaning: '完成、成就、整合、圓滿與宇宙意識',
            soulMission: '21號世界的靈魂使命是追求並達成生命旅程的圓滿完成與深度整合，在所有層面（物質、情感、心智、靈性）都達到一種和諧、豐盛與對宇宙一體意識的深刻了悟。您的生命目標是體驗到生命的完整性，將從愚者到審判所學到的一切課題融會貫通，並活在與萬物合一、自由舞動的喜悅之中。您的潛能是實現宏大人生目標的卓越能力、如宇宙般深廣的包容心，以及與宇宙節奏同頻共振、優雅共舞的智慧。您是來向世界展示，一個整合了所有經驗、達成了內在和諧的靈魂，是如何自由、成功、快樂地活在當下，並慶祝生命這場偉大的旅程的。',
            personalityTrait: '個性表現為具有開闊的、全球性乃至宇宙性的視野，強大的整合能力和深度的包容心。您能夠輕易地理解並欣賞生命的多樣性與不同文化、觀點的價值，並傾向於以一個宏大的、整體性的觀點來看待一切事物。您追求的是實質性的、有長遠意義的成就與內在的圓滿，而非短暫的虛榮。在生命的某個階段，當您完成了一個重要的生命週期（如學業、事業或個人成長），您會體驗到一種深刻的完成感、自由感與成就感。您是天生的整合者、全球公民、大型項目的完成者，能夠將複雜的元素編織成一幅美麗的織錦。',
            challenges: '世界的挑戰在於“完成之後”。在達到一個重要的里程碑或人生巔峰之後，您可能感到一種空虛，難以開啟一個全新的、充滿未知的篇章。或因為過於追求“完美”的圓滿而害怕行動，遲遲不肯為一個項目畫上句號。有時，您可能因為視野過於宏大而忽略了當下的細節和人際關係。在整合生命各個面向的過程中，也可能感到巨大的壓力與責任。需要學習在每一個“完成”之後，充分地慶祝、感恩，然後適時地放手，優雅地轉身，再次扮演“愚者”的角色，以歸零的心態迎接下一個全新的生命循環。理解圓滿並非一個終點，而是一個持續的、螺旋式上升的動態過程。'
          },
        };
        
        // --- SHARED CALCULATION FUNCTIONS ---
        const sharedSumDigits = (n) => {
            if (typeof n !== 'number' && typeof n !== 'string') return 0;
            return n.toString().split('').map(Number).reduce((a, b) => a + b, 0);
        };

        const getCardChallenges = (id) => {
            return cardDetails[id]?.challenges || '挑戰描述暫不可用';
        };

        const sharedReduceToSingleDigit = (n) => {
            let num = n;
            while (num > 9) {
                num = sharedSumDigits(num);
            }
            return num;
        };
        
        // --- SHARED FORTUNE CARD CALCULATION LOGIC ---
        /**
         * Returns exact date ranges for birthday-based yearly/monthly cycles
         * @param {string} birthDate - Birth date in YYYY-MM-DD format
         * @param {Date} targetDate - Target date for calculation
         * @returns {Object} Contains yearly and monthly date ranges with exact start/end dates
         */
        const getCycleDateRanges = (birthDate, targetDate) => {
            if (!birthDate || !targetDate) {
              return { yearly: { start: null, end: null }, monthly: { start: null, end: null } };
            }
            const [bYear, bMonth, bDay] = birthDate.split('-').map(Number);
            
            // Determine the start year of the current birthday cycle
            let cycleStartYear = targetDate.getFullYear();
            const birthDateInTargetYear = new Date(cycleStartYear, bMonth - 1, bDay);
            if (targetDate < birthDateInTargetYear) {
                cycleStartYear--;
            }

            const cycleStartDate = new Date(cycleStartYear, bMonth - 1, bDay);
            const cycleEndDate = new Date(cycleStartYear + 1, bMonth - 1, bDay - 1);
            
            // Calculate months since the cycle started
            let monthsSinceCycleStart = (targetDate.getFullYear() - cycleStartDate.getFullYear()) * 12 + (targetDate.getMonth() - cycleStartDate.getMonth());
            
            const monthlyStartDate = new Date(cycleStartDate.getFullYear(), cycleStartDate.getMonth() + monthsSinceCycleStart, bDay);
            const monthlyEndDate = new Date(monthlyStartDate.getFullYear(), monthlyStartDate.getMonth() + 1, bDay -1);

            return {
                yearly: { start: cycleStartDate, end: cycleEndDate },
                monthly: { start: monthlyStartDate, end: monthlyEndDate }
            };
        };

        /**
         * Calculates fortune cards based on birth date and target date using birthday-based periods
         * @param {string} birthDate - Birth date in YYYY-MM-DD format
         * @param {Date} targetDate - Target date for calculation
         * @returns {Object} Contains yearlyCard, monthlyCard IDs, and cycleInfo
         */
        const sharedCalculateFortuneCards = (birthDate, targetDate) => {
            if (!birthDate || !targetDate) return { yearlyCard: null, monthlyCard: null, cycleInfo: null };
            
            const [bYear, bMonth, bDay] = birthDate.split('-').map(Number);
            const cycleInfo = getCycleDateRanges(birthDate, targetDate);
            if (!cycleInfo.yearly.start) return { yearlyCard: null, monthlyCard: null, cycleInfo: null };

            // Yearly card calculation
            const personalBase = sharedSumDigits(bYear) + bMonth + sharedSumDigits(bDay);
            const yearlyValue = personalBase + sharedSumDigits(cycleInfo.yearly.start.getFullYear());
            let yearlyCardRaw = (yearlyValue - 1) % 22;
            yearlyCardRaw = (yearlyCardRaw < 0) ? yearlyCardRaw + 22 : yearlyCardRaw;
            const yearlyCardId = yearlyCardRaw;
            
            // Monthly card calculation
            const yearlyCardForCalc = yearlyCardId === 0 ? 22 : yearlyCardId;
            const bDaySimplified = sharedReduceToSingleDigit(bDay);
            const monthlyAdjustment = bMonth + bDaySimplified;
            const targetMonthNumber = targetDate.getMonth() + 1;
            const monthlyValue = yearlyCardForCalc + targetMonthNumber + monthlyAdjustment;
            
            let monthlyCardRaw = (monthlyValue - 1) % 22;
            monthlyCardRaw = (monthlyCardRaw < 0) ? monthlyCardRaw + 22 : monthlyCardRaw;
            const monthlyCardId = monthlyCardRaw;
            
            return {
                yearlyCard: yearlyCardId,
                monthlyCard: monthlyCardId,
                cycleInfo: cycleInfo
            };
        };

        // --- SHARED IMAGE PATH HELPER ---
        const cardFileNames = {
          0: '00愚者.png', 1: '01魔术师.png', 2: '02女祭祀.png', 3: '03皇后.png', 4: '04皇帝.png',
          5: '05教皇.png', 6: '06恋人.png', 7: '07战车.png', 8: '08力量.png', 9: '09隐士.png',
          10: '10命运之轮.png', 11: '11正义.png', 12: '12倒吊人.png', 13: '13死神.png',
          14: '14节制.png', 15: '15恶魔.png', 16: '16高塔.png', 17: '17星星.png', 18: '18月亮.png',
          19: '19太阳.png', 20: '20审判.png', 21: '21世界.png'
        };

        const sharedGetCardImagePath = (cardId) => {
          if (cardId === null || cardId === undefined) return '';
          const fileName = cardFileNames[cardId];
          if (!fileName) return '';
          return `./Tarot Cards/${fileName}`;
        };

        // --- TAROT BIRTH CARDS CALCULATOR (Mary K. Greer System with Challenge Card) ---
        const TarotBirthCardsCalculator = () => {
          const [birthDate, setBirthDate] = useState('');
          const [result, setResult] = useState(null);
          const [detailedReport, setDetailedReport] = useState(null);
          const [showProcess, setShowProcess] = useState(false);
          const [showInfo, setShowInfo] = useState(false);
          const [viewMode, setViewMode] = useState('simple');

          const TarotTheoryInfo = () => (
            <div className="mt-8 p-6 bg-white rounded-lg shadow-md space-y-6 text-gray-700 transition-all duration-500 ease-in-out">
              <h2 className="text-2xl font-bold text-purple-800 text-center flex items-center justify-center gap-2">
                <BookOpen /> 塔羅生命靈數系統深度解碼
              </h2>
              
              <section>
                <h3 className="text-xl font-semibold text-purple-700 mb-2">靈魂藍圖與個性表現的深度解碼</h3>
                <p className="text-base leading-relaxed">
                  塔羅牌生命靈數系統揭示了每個人獨特的靈魂藍圖和人生使命，透過出生日期計算得出的大阿爾卡納牌，能深入理解個人的內在本質與外在表現。這套系統不僅是占卜工具，更是一份詳盡的自我成長地圖。每個人都擁有代表靈魂核心的「靈魂卡牌」、展現今生學習課題的「個性卡牌」，以及指向平衡與完整性的「挑戰卡牌」。
                </p>
              </section>

              <section>
                 <h3 className="text-xl font-semibold text-purple-700 mb-2">理論架構與計算方法</h3>
                 <p className="text-base leading-relaxed mb-2">
                  此計算器採用標準方法計算靈魂與個性牌，並引入了“互補/挑戰牌”以提供更完整的視角。
                 </p>
                 <div className="bg-blue-50 rounded-lg p-4 text-sm text-blue-800">
                      <p className="font-semibold mb-1">計算範例：</p>
                      <ul className="list-disc list-inside space-y-1">
                        <li><b>靈魂卡牌</b>：將出生日期的每個數字相加（例：1988-12-05 → 1+9+8+8+1+2+0+5 = 34）。如果總和大於21，持續將數字相加直到小於等於21（3+4 = 7）。</li>
                        <li><b>個性卡牌</b>：將靈魂卡牌的數字相加得到個性卡牌（例：靈魂牌為15，個性牌為 1+5=6）。如果靈魂卡牌已是個位數，則兩者相同。</li>
                        <li><b>挑戰卡牌</b>：公式為【22 - 靈魂卡牌】。這代表了為了達到完整性，您需要整合的互補能量。（例：靈魂牌為7，挑戰牌為 22-7=15）。</li>
                        <li><b>特殊組合 (太陽)</b>：當靈魂卡牌是19時，會產生三張牌的特殊創造循環：19 (太陽), 10 (命運之輪), 1 (魔術師)，此時不計算挑戰牌。</li>
                      </ul>
                  </div>
              </section>

              <section>
                 <h3 className="text-xl font-semibold text-purple-700 mb-2">靈魂卡牌 vs. 個性卡牌 vs. 挑戰/天賦卡牌</h3>
                 <div className="grid md:grid-cols-1 gap-4">
                      <div className="bg-purple-50 p-3 rounded-lg border-l-4 border-purple-500">
                          <h4 className="font-bold text-purple-800">靈魂卡牌 (Soul Card)</h4>
                          <p className="text-sm">代表個人的<b>靈魂目的</b>、<b>核心本質</b>與跨越多個生世的永恆特質。它反映靈魂的根本使命、與生俱來的天賦和最高潛能。</p>
                      </div>
                      <div className="bg-pink-50 p-3 rounded-lg border-l-4 border-pink-500">
                          <h4 className="font-bold text-pink-800">個性卡牌 (Personality Card)</h4>
                          <p className="text-sm">描述個人在<b>此生需要學習的課題</b>、外在世界的<b>人格表現方式</b>以及需要掌握和整合的人生功課。這是靈魂使命在現實生活中的體現。</p>
                      </div>
                      <div className="bg-indigo-50 p-3 rounded-lg border-l-4 border-indigo-500">
                          <h4 className="font-bold text-indigo-800">互補/挑戰卡牌 (Challenge Card)</h4>
                          <p className="text-sm">此牌由【22 - 靈魂牌】得出，代表為了平衡天性、達成完整人格，需要有意識去學習和整合的能量。它既是盲點，也是通往更高智慧的橋樑。<br/>
                           - <b>例外：</b>若靈魂牌為19 (太陽)，則形成特殊的“天賦三重奏”，不適用此規則。
                          </p>
                      </div>
                 </div>
              </section>

              <section>
                  <h3 className="text-xl font-semibold text-purple-700 mb-2">生命牌卡組合的解讀重點</h3>
                  <div className="space-y-4">
                      <div className="p-4 bg-gray-50 rounded-lg">
                          <h4 className="font-bold text-gray-800">情況一：統一型 (1張主牌 + 1張挑戰牌)</h4>
                          <p className="text-sm mt-1">當生日數字總和為 1-9 時，您的「靈魂牌」與「個性牌」是同一張牌。這代表您的內外能量高度集中。挑戰牌(22 - 靈魂牌)在此時尤為重要，它指出了平衡這股強大、單一能量的關鍵方向。</p>
                      </div>
                      <div className="p-4 bg-gray-50 rounded-lg">
                          <h4 className="font-bold text-gray-800">情況二：標準三牌組 (靈魂+個性+挑戰)</h4>
                          <p className="text-sm mt-1">當生日數字總和為 10-18、20 或 21 時，您會有三張核心牌。挑戰牌(22 - 靈魂牌)揭示了您的靈魂天性為了避免走向極端，需要學習的互補品質。整合這三張牌的智慧，是您此生成長的完整藍圖。</p>
                      </div>
                      <div className="p-4 bg-gray-50 rounded-lg">
                          <h4 className="font-bold text-gray-800">情況三：太陽特殊三重牌組 (3張主牌)</h4>
                          <p className="text-sm mt-1">當生日數字總和為 19 (太陽) 時，這是一個非常特殊的組合，形成一個創造循環：<b>19 (太陽)</b> → <b>10 (命運之輪)</b> → <b>1 (魔術師)</b>。這三張牌共同構成您強大的顯化潛能，其本身的循環已足夠完整，因此不另外計算挑戰牌。</p>
                      </div>
                  </div>
              </section>
            </div>
          );
          
          const generateDetailedTarotReport = (cardSet) => {
              const { soulCard, personalityCard, challengeCard, giftCard } = cardSet;
              
              let introduction = '';
              let cardsAnalysis = [];
              let dynamicsAnalysis = '';
              let developmentalFocus = '';
              
              const getCardName = (id) => cardDetails[id]?.name || '未知卡牌';
              const getCardChallenges = (id) => cardDetails[id]?.challenges || '請參閱卡牌詳細說明。';

              if (giftCard !== null) { // 太陽特殊三重牌組 (19)
                  introduction = `您的生命牌卡組合是極其罕見且強大的「太陽三重奏」：${getCardName(soulCard)}(${soulCard}) → ${getCardName(personalityCard)}(${personalityCard}) → ${getCardName(giftCard)}(${giftCard})。這是一個動態的創造循環，象徵您天生擁有將夢想轉化為現實的非凡能力，是宇宙能量的顯化通道。`;
                  cardsAnalysis = [
                      { cardId: soulCard, role: '主題牌：太陽 - 光輝實現與生命喜悅', roleKey: 'soul' },
                      { cardId: personalityCard, role: '過程牌：命運之輪 - 把握宇宙時機與資源流動', roleKey: 'personality' },
                      { cardId: giftCard, role: '動力牌：魔術師 - 個人意志與創造力的主動運用', roleKey: 'gift' }
                  ];
                  dynamicsAnalysis = `在您的太陽三重奏中，${getCardName(giftCard)} (${giftCard})是「點火器」，代表您個人意志和創造衝動的源頭；${getCardName(personalityCard)} (${personalityCard})是「放大器」與「催化劑」，為您接引宇宙的機遇和資源；${getCardName(soulCard)} (${soulCard})是「展現台」，將您的創造成果以最光輝的形式展現給世界。這個循環是 1 → 10 → 19 (1+0=1 魔術師的意志 → 10 命運之輪的機遇 → 19 太陽的成果)。`;
                  developmentalFocus = `此組合的挑戰在於有意識地協調這三股強大能量，讓它們形成一個和諧的創造循環，而非各自為政或過度消耗。關鍵在於：\n1. ${getCardName(giftCard)}: 清晰您的意圖與目標 (${getCardChallenges(giftCard)})\n2. ${getCardName(personalityCard)}: 信任宇宙的安排並順應變化 (${getCardChallenges(personalityCard)})\n3. ${getCardName(soulCard)}: 樂觀自信地展現成果並分享喜悅 (${getCardChallenges(soulCard)})。避免因能量過強而忽略過程中的細節與他人的感受。`;
              } else if (challengeCard === null && soulCard === personalityCard) { // 統一型 (1-9)
                  introduction = `您是極其特殊的「統一型」人格 - 靈魂牌與個性牌均為 ${soulCard} 號「${getCardName(soulCard)}」。這意味著您的內在本質與外在表現高度統一，人生課題異常集中和強烈。您此生的所有學習、挑戰與天賦都聚焦在這一張牌的深層奧義中。`;
                  cardsAnalysis = [{ cardId: soulCard, role: '核心原型：您的存在本質與表達方式', roleKey: 'soul' }];
                  dynamicsAnalysis = `作為統一型，您的內外能量完全集中在 ${getCardName(soulCard)} 的原型上。這賦予您巨大的專注力和潛能，但也可能讓您更容易陷入該牌的極端表現或盲點中。`;
                  developmentalFocus = `您的成長關鍵在於對 ${getCardName(soulCard)} 的能量進行深度覺察，有意識地平衡其天賦與挑戰面。請特別關注 ${getCardName(soulCard)} 的挑戰：${getCardChallenges(soulCard)}。學會駕馭此原型能量，既體現其所有光明面，又能整合其陰影，以達到該原型的最高表達，避免其負面特質過度顯現。`;
              } else { // 標準三牌組 (靈魂+個性+挑戰)
                  introduction = `您的生命牌卡構成一個完整的三維學習藍圖：靈魂牌「${getCardName(soulCard)}」(${soulCard})定義了您的核心使命；個性牌「${getCardName(personalityCard)}」(${personalityCard})是您今生的主要課題；而挑戰牌「${getCardName(challengeCard)}」(${challengeCard})則揭示了為了平衡您的天性，最需要學習的互補能量。`;
                  cardsAnalysis = [
                      { cardId: soulCard, role: '靈魂牌：您永恆的本質與最高使命', roleKey: 'soul' },
                      { cardId: personalityCard, role: '個性牌：您今生的學習課題與展現', roleKey: 'personality' },
                      { cardId: challengeCard, role: '挑戰牌：需要整合的互補能量與成長點', roleKey: 'challenge' }
                  ];
                  dynamicsAnalysis = `您的生命藍圖中，${getCardName(personalityCard)} (${personalityCard}) 是您在世上實踐 ${getCardName(soulCard)} (${soulCard}) 使命的主要途徑。而 ${getCardName(challengeCard)} (${challengeCard}) 則像您靈魂的“對跖點”，它代表著與您天性（靈魂牌）相反、但能使其完整的能量。它是您平衡自我的關鍵，也是防止天賦走向極端的智慧。`;
                  developmentalFocus = `核心課題在於有意識地覺察並整合 ${getCardName(challengeCard)} 所代表的能量。其挑戰為：${getCardChallenges(challengeCard)}。\n當您的靈魂牌(${getCardName(soulCard)})特質過度展現時（挑戰: ${getCardChallenges(soulCard)}），請試著引入挑戰牌的智慧來平衡。\n您的個性牌(${getCardName(personalityCard)})是您整合這兩種能量的舞台（挑戰: ${getCardChallenges(personalityCard)}）。學會在生活中靈活運用這三股力量，是您此生圓滿的關鍵。`;
              }
              return { introduction, cardsAnalysis, dynamicsAnalysis, developmentalFocus, cardSet };
          };

          const calculateTarotCards = (date) => {
            const digits = date.replace(/-/g, '').split('').map(Number);
            let total = digits.reduce((sum, digit) => sum + digit, 0);
            const steps = [`出生年月日數字相加: ${digits.join(' + ')} = ${total}`];
            while (total > 21) {
              const newDigits = total.toString().split('').map(Number);
              const newTotal = newDigits.reduce((sum, digit) => sum + digit, 0);
              steps.push(`總和 > 21，繼續相加: ${newDigits.join(' + ')} = ${newTotal}`);
              total = newTotal;
            }
            const soulCard = total;
            let personalityCard = null;
            let challengeCard = null;
            let giftCard = null;
            const getCardName = (id) => cardDetails[id]?.name || '未知卡牌';
            
            if (soulCard === 19) { // Special case for The Sun
                const personalityDigits = soulCard.toString().split('').map(Number);
                personalityCard = personalityDigits.reduce((sum, digit) => sum + digit, 0);
                giftCard = personalityCard.toString().split('').map(Number).reduce((s,d)=>s+d,0);
                steps.push(`靈魂卡牌為 19 (${getCardName(19)})，形成特殊太陽三重牌組。`);
                steps.push(`個性/過程牌: 1 + 9 = ${personalityCard} (${getCardName(personalityCard)})`);
                steps.push(`天賦/動力牌: 1 + 0 = ${giftCard} (${getCardName(giftCard)})`);
            } else if (soulCard >= 10) { // Standard two-digit cards
                const personalityDigits = soulCard.toString().split('').map(Number);
                personalityCard = personalityDigits.reduce((sum, digit) => sum + digit, 0);
                const soulValueForCalc = soulCard === 0 ? 22 : soulCard;
                challengeCard = 22 - soulValueForCalc;
                steps.push(`靈魂卡牌為 ${soulCard} (${getCardName(soulCard)})。`);
                steps.push(`個性卡牌: ${soulCard.toString().split('').join(' + ')} = ${personalityCard} (${getCardName(personalityCard)})`);
                steps.push(`挑戰牌: 22 - ${soulCard} = ${challengeCard} (${getCardName(challengeCard)})`);
            } else { // Single-digit cards
                personalityCard = soulCard;
                const soulValueForCalc = soulCard === 0 ? 22 : soulCard;
                challengeCard = 22 - soulValueForCalc;
                steps.push(`靈魂卡牌為個位數 ${soulCard} (${getCardName(soulCard)})。`);
                steps.push(`個性卡牌與其相同: ${personalityCard} (${getCardName(personalityCard)})。`);
                steps.push(`挑戰牌: 22 - ${soulCard} = ${challengeCard} (${getCardName(challengeCard)})`);
            }

            if (soulCard === 0) {
                 challengeCard = 0; // Fool's challenge is itself
            }

            return { soulCard, personalityCard, challengeCard, giftCard, steps };
          };

          const handleCalculate = () => {
            if (!birthDate) {
              alert('請輸入出生日期');
              return;
            }
            const cardSet = calculateTarotCards(birthDate);
            setResult(cardSet);
            const report = generateDetailedTarotReport(cardSet);
            
            setDetailedReport(report);
            setShowProcess(false);
            setViewMode('simple'); 
          };

          const formatDate = (date) => {
            if (!date) return '';
            const parts = date.split('-');
            return `${parts[0]}年${parts[1]}月${parts[2]}日`;
          };

          const CardDisplay = ({ icon, title, cardId, bgColor, textColor, borderColor, type, description, challenges }) => {
            if (cardId === null || cardId === undefined || !cardDetails[cardId]) return null;
            const details = cardDetails[cardId];
            let displayDescription = description;
            if (type === 'soul') displayDescription = details.soulMission;
            else if (type === 'personality') displayDescription = details.personalityTrait;
            
            return (
              <div className={`${bgColor} rounded-lg p-4 shadow-sm md:shadow-md border-l-4 ${borderColor} transition-all duration-300`}>
                <div className="relative mb-3">
                  <img
                    src={sharedGetCardImagePath(cardId)}
                    alt={details.name}
                    className="w-full max-w-[150px] mx-auto rounded-lg shadow-md object-cover border-2 border-white"
                    onError={(e) => e.target.style.display = 'none'}
                    loading="lazy"
                    width="150"
                    height="250"
                  />
                </div>
                
                <div className="flex items-center gap-2 mb-2">{icon}<h3 className={`font-semibold ${textColor}`}>{title}</h3></div>
                <div className={`text-2xl font-bold ${textColor} mb-1`}>{cardId} - {details.name}</div>
                <p className={`text-sm font-semibold ${textColor} mb-2`}>{details.shortMeaning}</p>
                {type !== 'challenge' && (<p className={`text-xs ${textColor} opacity-80 mb-2`}>{displayDescription}</p>)}
                {type === 'challenge' && description && (<p className={`text-xs ${textColor} opacity-80 mb-2`}>{description}</p>)}
                {challenges && (<p className={`text-xs ${textColor} opacity-70 mt-1`}><span className="font-semibold">挑戰：</span>{challenges}</p>)}
              </div>
            );
          };
          
          const DetailedTarotReport = ({ reportData }) => {
            const [openSections, setOpenSections] = useState({});
            const [expandedAnalysis, setExpandedAnalysis] = useState(true);
            const toggleSection = (id) => setOpenSections(prev => ({...prev, [id]: !prev[id]}));

            if (!reportData || !reportData.cardsAnalysis) return <p>報告生成中...</p>;
            
            const { cardSet } = reportData;

            // Simplify the unified type logic for report
            const isUnifiedType = cardSet.soulCard === cardSet.personalityCard && cardSet.giftCard === null;
            
             if (isUnifiedType) {
                 reportData.introduction = `您是極其特殊的「統一型」人格 - 靈魂牌與個性牌均為 ${cardSet.soulCard} 號「${cardDetails[cardSet.soulCard]?.name}」。這意味著您的內在本質與外在表現高度統一。而您的挑戰牌「${cardDetails[cardSet.challengeCard]?.name}」(${cardSet.challengeCard})則指出了平衡這股強大力量、走向完整的關鍵方向。`;
                 reportData.cardsAnalysis = [
                     { cardId: cardSet.soulCard, role: '核心原型：您的存在本質與表達方式', roleKey: 'soul' },
                     { cardId: cardSet.challengeCard, role: '挑戰牌：需要整合的互補能量與成長點', roleKey: 'challenge' }
                 ];
                 reportData.dynamicsAnalysis = `作為統一型，您的天賦與挑戰都集中在 ${cardDetails[cardSet.soulCard]?.name} 的原型上。您的挑戰牌 ${cardDetails[cardSet.challengeCard]?.name} 是您達成內在平衡的鑰匙，它代表與您天性相反但能使其完整的能量。`;
                 reportData.developmentalFocus = `成長關鍵在於深度理解 ${cardDetails[cardSet.soulCard]?.name}（挑戰：${getCardChallenges(cardSet.soulCard)}）的同時，有意識地學習和引入 ${cardDetails[cardSet.challengeCard]?.name} 的智慧（挑戰：${getCardChallenges(cardSet.challengeCard)}）。這個整合過程能幫助您避免天賦走向極端，活出更圓滿的自我。`;
             }

            return (
                <div className="bg-white rounded-lg p-6 shadow-lg mt-6 animate-fade-in">
                    <h2 className="text-3xl font-bold text-purple-900 mb-3 text-center">您的深度塔羅生命藍圖報告</h2>
                    <p className="text-center text-gray-700 mb-6 text-base leading-relaxed">{reportData.introduction}</p>
                    
                    <div className="space-y-6 mb-8">
                        <h3 className="text-2xl font-bold text-purple-800 text-center mb-4">核心原型卡牌解析</h3>
                        {reportData.cardsAnalysis.map((cardAnalysis, index) => {
                            const cardData = cardDetails[cardAnalysis.cardId];
                            if (!cardData) return null; 
                            const sectionId = `card-${cardAnalysis.cardId}-${index}`;
                            const isChallengeOrGift = cardAnalysis.roleKey === 'challenge' || cardAnalysis.roleKey === 'gift';
                            
                            return (
                                <div key={index} className="border-2 border-purple-200 rounded-lg overflow-hidden shadow-md">
                                    <button onClick={() => toggleSection(sectionId)} className="w-full p-5 bg-gradient-to-r from-purple-100 to-pink-100 hover:from-purple-200 hover:to-pink-200 flex justify-between items-center transition-all duration-300">
                                        <div className="text-left">
                                            <span className="text-lg sm:text-xl font-bold text-purple-800">{cardAnalysis.role}: {cardData.name} ({cardAnalysis.cardId})</span>
                                            <div className="text-sm text-purple-600 mt-1">核心意義: {cardData.shortMeaning || ''}</div>
                                        </div>
                                        <span className="text-purple-600 text-2xl">{openSections[sectionId] ? <ChevronUp /> : <ChevronDown />}</span>
                                    </button>
                                    {openSections[sectionId] && (
                                        <div className="p-6 bg-white space-y-4 animate-fade-in">
                                            <div className="p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                                                <h4 className="font-bold text-green-800 mb-2 flex items-center gap-1"><Sparkles className="w-4 h-4" /> 天賦與靈魂使命 ({isChallengeOrGift ? '此牌的整合意義' : '核心天賦'})</h4>
                                                <p className="text-sm text-gray-700 leading-relaxed">{cardData.soulMission}</p>
                                            </div>
                                            <div className="p-4 bg-orange-50 rounded-lg border-l-4 border-orange-500">
                                                <h4 className="font-bold text-orange-800 mb-2 flex items-center gap-1"><User className="w-4 h-4" /> 人格特質與今生表現 ({isChallengeOrGift ? '此牌的行為啟示' : '主要特質'})</h4>
                                                <p className="text-sm text-gray-700 leading-relaxed">{cardData.personalityTrait}</p>
                                            </div>
                                            <div className="p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                                                <h4 className="font-bold text-red-800 mb-2 flex items-center gap-1"><AlertCircleIcon className="w-4 h-4" /> 主要挑戰與成長課題 ({isChallengeOrGift ? '此牌的平衡課題' : '核心挑戰'})</h4>
                                                <p className="text-sm text-gray-700 leading-relaxed">{cardData.challenges}</p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>

                     <div className="mb-8">
                        <button onClick={() => setExpandedAnalysis(!expandedAnalysis)} className="w-full p-5 bg-gradient-to-r from-blue-100 to-indigo-100 hover:from-blue-200 hover:to-indigo-200 rounded-lg shadow-md transition-all duration-300 flex items-center justify-between">
                            <h3 className="text-xl sm:text-2xl font-bold text-blue-900 flex items-center gap-2"><BrainIcon /> 牌組互動動力學分析</h3>
                            <span className="text-blue-600 text-2xl">{expandedAnalysis ? <ChevronUp /> : <ChevronDown />}</span>
                        </button>
                        {expandedAnalysis && (
                            <div className="mt-4 p-6 bg-blue-50 rounded-lg border-2 border-blue-200 animate-fade-in">
                                <h4 className="font-bold text-blue-800 mb-2 text-lg">內在能量流動：</h4>
                                <p className="text-blue-900 leading-relaxed text-sm whitespace-pre-line mb-4">{reportData.dynamicsAnalysis}</p>
                                <h4 className="font-bold text-red-700 mb-2 text-lg">發展焦點與挑戰整合：</h4>
                                <p className="text-red-800 leading-relaxed text-sm whitespace-pre-line bg-red-50 p-3 rounded">{reportData.developmentalFocus}</p>
                            </div>
                        )}
                    </div>
                    
                    <div className="text-center p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-200">
                        <h4 className="text-xl font-bold text-purple-800 mb-3">🙏 整合與實踐</h4>
                        <p className="text-gray-700 leading-relaxed text-sm">這份報告提供了一個關於您生命藍圖的深度視角。請記住，這些牌卡不是對您的限制，而是一份珍貴的指引。它們揭示了您的天賦、挑戰與最高的潛能。通过理解和整合這些原型能量，特別是覺察並轉化報告中提及的挑戰與發展焦點，您將能更有意識地走在屬於自己的獨特生命道路上，活出最真實、最完整的自己。</p>
                    </div>
                </div>
            );
          };

          return (
            <div className="max-w-3xl mx-auto p-4 sm:p-6 bg-gradient-to-br from-purple-100 to-pink-100 rounded-xl shadow-lg md:shadow-xl font-sans">
              <div className="text-center mb-8">
                <h1 className="text-3xl font-bold text-purple-800 mb-2 flex items-center justify-center gap-2"><Sparkles className="w-8 h-8" />塔羅生命靈數計算器</h1>
                <p className="text-gray-600">解碼您的靈魂牌、個性牌與挑戰/天賦牌</p>
              </div>
              <div className="bg-white rounded-lg p-6 shadow-md mb-6">
                <div className="mb-6"><label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2"><Calendar />請輸入您的出生日期</label><input type="date" value={birthDate} onChange={(e) => setBirthDate(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"/></div>
                <button onClick={handleCalculate} className="w-full bg-purple-600 text-white py-3 rounded-md hover:bg-purple-700 transition-colors font-semibold flex items-center justify-center gap-2"><Sparkles className="w-5 h-5" /> 計算我的生命牌卡</button>
              </div>
              {result && (
                <div className="space-y-6 animate-fade-in">
                  <div className="bg-white rounded-lg p-4 shadow-md">
                    <div className="flex justify-center space-x-2 sm:space-x-4">
                      <button onClick={() => setViewMode('simple')} className={`px-4 py-2 sm:px-6 sm:py-3 rounded-lg font-semibold transition-all text-sm sm:text-base ${viewMode === 'simple' ? 'bg-purple-600 text-white shadow-lg transform scale-105' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>📊 簡要概覽</button>
                      <button onClick={() => setViewMode('detailed')} className={`px-4 py-2 sm:px-6 sm:py-3 rounded-lg font-semibold transition-all text-sm sm:text-base ${viewMode === 'detailed' ? 'bg-purple-600 text-white shadow-lg transform scale-105' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>📚 詳細分析</button>
                    </div>
                  </div>
                  {viewMode === 'simple' ? (
                    <div className="bg-white rounded-lg p-6 shadow-md">
                      <h2 className="text-xl font-bold text-gray-800 mb-4">您的塔羅生命靈數結果 ({formatDate(birthDate)})</h2>
                      <div className="grid md:grid-cols-1 gap-6">
                        <CardDisplay icon={<Hash className="w-5 h-5 text-purple-600" />} title="靈魂卡牌 (Soul Card)" cardId={result.soulCard} bgColor="bg-purple-100" textColor="text-purple-900" borderColor="border-purple-500" type="soul" challenges={cardDetails[result.soulCard]?.challenges}/>
                        <CardDisplay icon={<User className="w-5 h-5 text-pink-600" />} title="個性卡牌 (Personality Card)" cardId={result.personalityCard} bgColor="bg-pink-100" textColor="text-pink-900" borderColor="border-pink-500" type="personality" challenges={cardDetails[result.personalityCard]?.challenges}/>
                        {result.challengeCard !== null && cardDetails[result.challengeCard] && (<CardDisplay icon={<TargetIcon className="w-5 h-5 text-indigo-600" />} title="互補/挑戰牌 (Challenge Card)" cardId={result.challengeCard} bgColor="bg-indigo-100" textColor="text-indigo-900" borderColor="border-indigo-500" type="challenge" description="此牌代表為了平衡天性、達成完整人格，最需要學習與整合的互補能量。" challenges={cardDetails[result.challengeCard]?.challenges}/>)}
                        {result.giftCard !== null && cardDetails[result.giftCard] && (<CardDisplay icon={<Gift className="w-5 h-5 text-yellow-600" />} title="天賦牌 (Gift Card)" cardId={result.giftCard} bgColor="bg-yellow-100" textColor="text-yellow-900" borderColor="border-yellow-500" description="作為太陽三重奏的一部分，這代表您的核心意志與天賦才能。" challenges={cardDetails[result.giftCard]?.challenges}/>)}
                      </div>
                      <button onClick={() => setShowProcess(!showProcess)} className="mt-6 text-purple-600 hover:text-purple-800 text-sm font-medium flex items-center gap-1">{showProcess ? '隱藏' : '顯示'}計算過程<span className="text-purple-600">{showProcess ? <ChevronUp /> : <ChevronDown />}</span></button>
                      {showProcess && (<div className="mt-4 p-4 bg-gray-50 rounded-lg animate-fade-in"><h4 className="font-semibold text-gray-700 mb-2">計算步驟：</h4><p className="text-sm text-gray-600 mb-2">出生日期：{formatDate(birthDate)}</p><div className="space-y-1">{result.steps.map((step, index) => (<p key={index} className="text-sm font-mono text-gray-700">{step}</p>))}</div></div>)}
                    </div>
                  ) : (detailedReport && <DetailedTarotReport reportData={detailedReport} />)}
                </div>
              )}
              <div className="text-center mt-8">
                <button onClick={() => setShowInfo(!showInfo)} className="inline-flex items-center gap-2 px-6 py-3 bg-white text-purple-700 rounded-full shadow-md hover:bg-purple-50 transition-transform transform hover:scale-105"><span className="font-semibold">了解更多關於塔羅生命靈數</span>{showInfo ? <ChevronUp className="w-5 h-5" /> : <ChevronDown className="w-5 h-5" />}</button>
              </div>
              {showInfo && <TarotTheoryInfo />}
            </div>
          );
        };
        
        // --- TAROT COMPATIBILITY SYSTEM ---
        const TarotCompatibilitySystem = () => {
          const [person1Date, setPerson1Date] = useState('');
          const [person2Date, setPerson2Date] = useState('');
          const [person1Name, setPerson1Name] = useState('夥伴 A');
          const [person2Name, setPerson2Name] = useState('夥伴 B');
          const [result, setResult] = useState(null);
          const [showDetails, setShowDetails] = useState({ soul: false, personality: false, challenge: false, yearly: false, monthly: false });
          
          const [targetYear, setTargetYear] = useState(new Date().getFullYear());
          const [targetMonth, setTargetMonth] = useState(new Date().getMonth() + 1);
          
          const baseCompatibilityMatrix = {
             0: { 1: { score: 90, type: '無限潛能的啟動者', desc: '愚者的無限潛能與魔術師的實現能力相結合，創造出一段充滿驚喜與顯化奇蹟的關係。魔術師能夠捕捉愚者天馬行空的想法，並將其具體化，而愚者則能為魔術師帶來全新的視角和冒險的勇氣。', challenges: '愚者的隨性可能讓目標導向的魔術師感到挫敗，而魔術師的掌控欲可能限制了愚者的自由。需要學習在自發性與計劃性之間找到平衡，共同享受旅程而非僅僅專注於結果。' } },
             1: { 1: { score: 85, type: '雙重意志力', desc: '兩個1號魔術師相遇，代表著意志力、創造力和行動力的強強結合。這是一段充滿活力和創新潛能的關係，雙方都擁有將想法化為現實的強大能力，能夠共同發起並推動項目，快速取得進展。', challenges: '主要的挑戰在於「誰來主導？」。兩個強勢的個體可能產生權力鬥爭或競爭。需要有意識地協調目標，避免自我中心，並學會輪流領導或共同合作。如果溝通不良或缺乏共同願景，強大的能量可能會轉向內部衝突，而非外部創造。' }, 2: { score: 75, type: '行動與直覺', desc: '魔術師的行動力與女祭司的直覺洞察形成互補。魔術師能將女祭司的深層智慧化為實際行動，而女祭司則能為魔術師提供方向與深度。', challenges: '魔術師可能覺得女祭司過於被動或神秘，女祭司可能覺得魔術師太急躁或表面。需要耐心溝通，魔術師學習聆聽，女祭司學習表達。' }, 3: { score: 80, type: '創造與豐盛', desc: '魔術師的創造意志與女帝的豐饒能量結合，能共同創造出實質且美好的成果。魔術師提供方法，女帝提供滋養與資源。', challenges: '魔術師的目標導向可能與女帝的享受過程產生衝突。需平衡效率與享受，並確保創造的目標是雙方都認同的。' }, 4: { score: 70, type: '意志與結構', desc: '魔術師的創新能力與皇帝的組織結構相輔相成。魔術師帶來新點子，皇帝則能將其實現並制度化，建立穩固的基礎。', challenges: '魔術師可能覺得皇帝過於僵化，皇帝可能覺得魔術師不切實際。需要互相尊重對方的方法，魔術師學習務實，皇帝學習彈性。' }, 5: { score: 65, type: '創新與傳統', desc: '魔術師的個體創造力與教皇的傳統智慧形成有趣的對話。魔術師挑戰現狀，教皇提供經驗與道德框架。', challenges: '可能在方法論和價值觀上產生分歧。魔術師需要尊重智慧傳承，教皇需要對新方法保持開放，尋找融合點而非對立。' }, 6: {score:90,type:'創造性的愛',desc:'魔術師的創造力在戀人牌代表的愛與關係中能得到極大的滋養與發揮。他們共同做出選擇，創造充滿活力與和諧的關係，彼此激勵。', challenges:'魔術師的個人意志可能在關係選擇中過於強勢，或戀人牌的猶豫不決讓魔術師失去耐心。需要坦誠溝通各自的需求與價值觀，確保選擇是共同的。'}, 7: {score:85,type:'意志的推進力',desc:'魔術師的意志與戰車的決心結合，形成一股強大的前進動力。他們能共同設定目標並勇往直前，克服障礙，取得成功。', challenges:'兩者都非常強勢，若方向不一致，很容易產生衝突或競爭。需要明確的共同目標，並學會協調步伐，避免一方拖垮另一方。'}, 8: {score:80,type:'意志與內力',desc:'魔術師的外在顯化能力與力量牌的內在堅韌相結合，能以一種平衡的方式達成目標。魔術師帶來方法，力量牌帶來耐心與慈悲。', challenges:'魔術師的急切可能與力量牌的徐緩產生摩擦。魔術師需學習內在力量的柔韌，力量牌需學習更主動地運用能力。'}, 9: {score:60,type:'行動與內省',desc:'魔術師的外向行動與隱士的內向反思形成鮮明對比，但也可能互補。隱士的智慧能指引魔術師的行動，魔術師能將隱士的洞見付諸實踐。', challenges:'生活節奏和溝通方式差異大。魔術師可能覺得隱士太孤僻，隱士可能覺得魔術師太喧囂。需要尊重彼此的空間與需求。'}, 10:{score:85,type:'創造機遇',desc:'魔術師的顯化能力與命運之輪的機遇完美結合。魔術師能主動創造並抓住命運之輪帶來的機會，共同駕馭生命的流動。', challenges:'魔術師可能試圖掌控命運之輪的不可預測性，而命運之輪的變化可能打亂魔術師的計劃。學習在變化中保持彈性與信任是關鍵。'}, 11:{score:70,type:'意志與公正',desc:'魔術師的行動力需要正義牌的清晰判斷與平衡。正義能確保魔術師的創造是基於公平和真理的。', challenges:'魔術師的靈活性可能與正義的原則性產生衝突。正義的嚴謹可能讓魔術師感到受限。需要找到原則與彈性的平衡點。'}, 12:{score:65,type:'行動與臣服',desc:'魔術師的主動創造與倒吊人的被動臣服形成強烈對比。倒吊人的新視角可以啟發魔術師，魔術師可以幫助倒吊人走出停滯。', challenges:'魔術師可能不理解倒吊人的「無為」，倒吊人可能抗拒魔術師的催促。學習在適當的時候行動，在適當的時候等待與反思。'}, 13:{score:75,type:'創造與轉化',desc:'魔術師的創造力與死神的轉化力量結合，能帶來深刻的改變與新生。他們能共同結束舊模式，開創新局面。', challenges:'魔術師可能害怕死神帶來的徹底改變，死神的直接可能讓魔術師感到失控。需要勇氣去面對結束，並信任之後的新生。'}, 14:{score:80,type:'顯化與調和',desc:'魔術師的顯化能力與節制牌的調和藝術能創造出平衡且持久的成果。他們善於整合不同元素，創造和諧。', challenges:'魔術師的專注目標可能與節制的尋求多方平衡有所不同。需要耐心協商，確保行動既有效率又具包容性。'}, 15:{score:70,type:'意志與慾望',desc:'魔術師的意志力與惡魔牌的原始慾望相遇，可能爆發強大的創造力，也可能陷入束縛。關鍵在於如何引導這股能量。', challenges:'惡魔的誘惑可能讓魔術師誤用能力，或雙方陷入不健康的依賴。需要高度的自我覺察，將激情導向正面，避免沉溺。'}, 16:{score:75,type:'創造性突破',desc:'魔術師的創造力與塔的顛覆性能量結合，能帶來革命性的突破和舊有結構的瓦解，為新事物騰出空間。', challenges:'塔的突變可能打亂魔術師的計劃，甚至摧毀其成果。魔術師需學會在混亂中保持彈性，並將危機視為重建的機會。'}, 17:{score:85,type:'顯化希望',desc:'魔術師的實現能力與星星的希望靈感相結合，能將美好的願景化為現實，為自己和他人帶來光明。', challenges:'星星的理想主義可能讓魔術師的實際操作遇到困難。需要平衡夢想與現實，將希望落實於具體行動。'}, 18:{score:70,type:'意識與潛意識',desc:'魔術師的清晰意識與月亮的模糊潛意識相遇，是一場探索內在迷霧的旅程。月亮的直覺能豐富魔術師的創造，魔術師的理性有助於釐清幻象。', challenges:'月亮的幻象和恐懼可能干擾魔術師的專注力。魔術師的邏輯可能難以理解月亮的非理性。需要信任直覺，同時保持分辨能力。'}, 19:{score:90,type:'光輝創造',desc:'魔術師的創造力在太陽的光明照耀下得以充分展現。他們能共同創造充滿喜悅、成功和活力的成果，散發正能量。', challenges:'兩者都可能比較自我中心。魔術師需要確保其創造服務於太陽的整體福祉，太陽的強光不要灼傷魔術師的個別性。'}, 20:{score:80,type:'意志的覺醒',desc:'魔術師的顯化能力與審判的覺醒召喚結合，能共同響應生命的更高目的，實現深刻的轉化和人生目標的重新定義。', challenges:'審判的自我評估可能讓魔術師對過去的創造產生懷疑。魔術師需要將其能力導向新的、更有意義的方向，而非執著舊有。'}, 21:{score:85,type:'完成的創造',desc:'魔術師的創造力與世界的圓滿達成相輔相成。他們能將理念完美地實現，體驗到成就感和宇宙的合一。', challenges:'世界牌的完成感可能讓魔術師感到下一步無事可做。需要理解完成也是新循環的開始，魔術師的創造力永無止境。'}},
             2: { 2: { score: 85, type: '深層靈魂連結', desc: '兩位女祭司相遇，代表直覺、潛意識智慧與內在世界的深度共鳴。這是一段充滿神秘感、相互理解且無需過多言語的連結。她們能共同探索靈性奧秘，分享深邃的洞見。', challenges: '關係可能過於內向、被動，缺乏在現實世界的具體行動。雙方都可能壓抑情感，不願直接溝通。需要鼓勵彼此將內在智慧表達出來，並積極參與外部世界，避免陷入孤立或過度沉思。' }, 3: { score: 80, type: '直覺滋養創造', desc: '女祭司的直覺智慧與女帝的豐盛創造力形成強大的陰性力量結合。女祭司提供靈感與方向，女帝則將其實現並滋養，共同創造充滿愛與美的成果。', challenges: '女祭司的靜默可能與女帝的熱情外放產生步調不一。女帝可能覺得女祭司不夠投入物質層面，女祭司可能覺得女帝不夠深刻。需欣賞彼此的貢獻，找到內外平衡。' }, }
          };

          const fullCompatibilityMatrix = useMemo(() => {
                const matrix = JSON.parse(JSON.stringify(baseCompatibilityMatrix));
                for (let i = 0; i <= 21; i++) {
                    if (!matrix[i]) matrix[i] = {};
                    for (let j = i; j <= 21; j++) {
                        if (!matrix[j]) matrix[j] = {};
                        if (!matrix[i][j] && !matrix[j][i]) {
                             const card1 = cardDetails[i];
                             const card2 = cardDetails[j];
                             if (!card1 || !card2) continue;
            
                             if (i === j) {
                                matrix[i][j] = {
                                  score: 80,
                                  type: `同頻共振 (${card1.name})`,
                                  desc: `兩個 ${card1.name} 相遇，關於「${card1.shortMeaning}」的能量會被雙倍放大。這帶來深刻的理解與共鳴，能迅速建立連結，但也可能讓雙方共同的盲點被忽視。`,
                                  challenges: `主要挑戰在於需要有意識地覺察並平衡 ${card1.name} 能量的極端表現。例如，雙方都可能陷入『${card1.challenges}』的困境中，缺乏另一種視角來打破僵局。`
                                };
                             } else {
                                matrix[i][j] = {
                                  score: 70,
                                  type: `互補學習 (${card1.name} & ${card2.name})`,
                                  desc: `${card1.name} 所代表的「${card1.shortMeaning.split('、')[0]}」能量，與 ${card2.name} 的「${card2.shortMeaning.split('、')[0]}」主題相遇，創造了寶貴的學習與成長機會。一方的優點可以彌補另一方的不足。`,
                                  challenges: `雙方需要理解並尊重彼此本質上的差異。${card1.name}的潛在挑戰 (${card1.challenges.split('。')[0]}) 可能與 ${card2.name} 的挑戰 (${card2.challenges.split('。')[0]}) 相互作用，需要耐心地溝通和磨合。`
                                };
                             }
                        }
                    }
                }
                return matrix;
          }, []);

          const getCardName = (id) => cardDetails[id]?.name || '未知卡牌';

          const calculatePersonTarotCards = (date) => {
            const digits = date.replace(/-/g, '').split('').map(Number);
            let total = digits.reduce((sum, digit) => sum + digit, 0);
            while (total > 21) {
              const newDigits = total.toString().split('').map(Number);
              total = newDigits.reduce((sum, digit) => sum + digit, 0);
            }
            const soulCard = total;
            let personalityCard;
            if (soulCard < 10) { 
                personalityCard = soulCard;
            } else {
              const personalityDigits = soulCard.toString().split('').map(Number);
              personalityCard = personalityDigits.reduce((sum, digit) => sum + digit, 0);
            }
            
            const soulValueForCalc = soulCard === 0 ? 22 : soulCard;
            let challengeCard = 22 - soulValueForCalc;
            
            return { soulCard, personalityCard, challengeCard: challengeCard };
          };

          const getCompatibility = (card1, card2) => {
            if (card1 === null || card2 === null) return { score: 0, type: '資訊不足', desc: '無法計算，因為缺少一方或雙方的牌卡資訊。', challenges: '' };
            
            let c1 = card1, c2 = card2;
            if (c1 > c2) [c1, c2] = [c2, c1];

            if (fullCompatibilityMatrix[c1] && fullCompatibilityMatrix[c1][c2]) {
              return fullCompatibilityMatrix[c1][c2];
            }
            if (fullCompatibilityMatrix[c2] && fullCompatibilityMatrix[c2][c1]) {
                return fullCompatibilityMatrix[c2][c1];
            }
            
            return { score: 50, type: '中性關係', desc: '這是一段充滿未知與探索空間的關係。', challenges: '缺乏天然的強烈共鳴或明顯的互補性，需要更多有意識的溝通來建立深層連結。' };
          };

          const getOverallCompatibility = (soulComp, personalityComp, challengeComp) => {
            if (!soulComp || !personalityComp || !challengeComp) return { avgScore: 0, level: '無法評估', advice: '數據不足，無法生成綜合建議。'};
            const avgScore = (soulComp.score * 0.4) + (personalityComp.score * 0.4) + (challengeComp.score * 0.2);
            let level, advice;
            if (avgScore >= 85) { level = '🌟🌟🌟🌟🌟 靈魂高度共鳴'; advice = '你們在多個層面有著深刻的靈魂連結和高度契合，彼此能夠深度理解、支持與啟發。這是一段具有巨大共同進化潛力的關係，共同探索生命的奧秘。'; }
            else if (avgScore >= 75) { level = '🌟🌟🌟🌟 高度心靈契合'; advice = '你們在核心價值與生命目標上有良好的共鳴，個性上也能相互欣賞。透過坦誠溝通與共同學習，可以達到更深的親密與理解，是一段能帶來喜悅與成長的關係。'; }
            else if (avgScore >= 65) { level = '🌟🌟🌟 互補成長夥伴'; advice = '你們的差異可以成為彼此成長的催化劑和學習的鏡子。關係中可能存在一些挑戰，但只要保持開放、尊重與理解，就能將差異轉化為互補的優勢，共同進步。'; }
            else if (avgScore >= 55) { level = '🌟🌟 學習型挑戰關係'; advice = '這段關係中，挑戰與機遇並存。你們的相遇是為了學習重要的人生課題，可能需要更多的努力、耐心和有意識的溝通來化解摩擦。若能共同克服，將帶來深刻的個人成長。'; }
            else { level = '🌟 深層課題探索'; advice = '你們的連結觸及了較深的生命課題或過往模式。關係可能感覺複雜，需要極大的耐心、慈悲和自我反思。這是一段潛力巨大的靈魂功課，重點在於自我覺察與轉化，而非僅僅是關係的和諧。'; }
            return { avgScore: Math.round(avgScore), level, advice };
          };

          const handleAnalyze = () => {
            if (!person1Date || !person2Date) { alert('請填寫兩位夥伴的出生日期'); return; }
            if (!person1Name || !person2Name) { alert('請填寫兩位夥伴的姓名/暱稱'); return; }
            
            const person1Cards = calculatePersonTarotCards(person1Date);
            const person2Cards = calculatePersonTarotCards(person2Date);
            
            const targetDate = new Date(targetYear, targetMonth - 1, 1);
            const person1FortuneCards = sharedCalculateFortuneCards(person1Date, targetDate);
            const person2FortuneCards = sharedCalculateFortuneCards(person2Date, targetDate);
            
            const soulCompatibility = getCompatibility(person1Cards.soulCard, person2Cards.soulCard);
            const personalityCompatibility = getCompatibility(person1Cards.personalityCard, person2Cards.personalityCard);
            const challengeCompatibility = getCompatibility(person1Cards.challengeCard, person2Cards.challengeCard); 
            const overall = getOverallCompatibility(soulCompatibility, personalityCompatibility, challengeCompatibility);

            const yearlyCompatibility = getCompatibility(person1FortuneCards.yearlyCard, person2FortuneCards.yearlyCard);
            const monthlyCompatibility = getCompatibility(person1FortuneCards.monthlyCard, person2FortuneCards.monthlyCard);

            setResult({ 
                person1: { name: person1Name, ...person1Cards, fortuneCards: person1FortuneCards }, 
                person2: { name: person2Name, ...person2Cards, fortuneCards: person2FortuneCards }, 
                compatibility: { soul: soulCompatibility, personality: personalityCompatibility, challenge: challengeCompatibility, yearly: yearlyCompatibility, monthly: monthlyCompatibility, overall },
                timeframe: { year: targetYear, month: targetMonth }
            });
            setShowDetails({ soul: false, personality: false, challenge: false, yearly: false, monthly: false });
          };

          const getScoreColor = (score) => { if (score >= 85) return 'text-green-600'; if (score >= 75) return 'text-blue-600'; if (score >= 65) return 'text-yellow-600'; if (score >=55) return 'text-orange-600'; return 'text-red-600'; };
          const getScoreBg = (score) => { if (score >= 85) return 'bg-green-100'; if (score >= 75) return 'bg-blue-100'; if (score >= 65) return 'bg-yellow-100'; if (score >=55) return 'bg-orange-100'; return 'bg-red-100'; };
          
          const CompatibilityItem = ({ itemKey, title, icon, cards, compatibilityInfo, infoText, isOpen, onToggle }) => (
            <div className="bg-white rounded-lg p-4 sm:p-6 shadow-md">
              <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between cursor-pointer" onClick={onToggle}>
                <h3 className="font-semibold text-gray-800 flex items-center gap-2 mb-2 sm:mb-0 text-base sm:text-lg">{icon} {title}</h3>
                <div className="flex items-center gap-2 sm:gap-4 w-full sm:w-auto justify-end">
                    <span className={`text-xl sm:text-2xl font-bold ${getScoreColor(compatibilityInfo.score)}`}>{compatibilityInfo.score}%</span>
                    <span className={`px-2 py-1 sm:px-3 rounded-full text-xs sm:text-sm font-medium whitespace-nowrap ${getScoreBg(compatibilityInfo.score)} ${getScoreColor(compatibilityInfo.score)}`}>{compatibilityInfo.type}</span>
                    <span className="text-purple-600 text-xl">{isOpen ? <ChevronUp /> : <ChevronDown />}</span>
                </div>
              </div>
              {isOpen && (<div className="mt-4 pt-4 border-t animate-fade-in text-sm">
                  <div className="mb-3 p-3 bg-gray-50 rounded-md">
                    <p className="font-semibold text-gray-700">互動牌組：</p>
                    <div className="flex justify-center gap-4 my-3">
                      <div className="text-center">
                        <img src={sharedGetCardImagePath(cards[0])} alt={getCardName(cards[0])} className="w-16 h-24 object-cover rounded-md shadow-md border-2 border-white mx-auto" loading="lazy" width="64" height="96" />
                        <p className="text-xs mt-1">{getCardName(cards[0])}</p>
                      </div>
                      <HeartIcon className="text-red-500 text-2xl self-center" />
                      <div className="text-center">
                        <img src={sharedGetCardImagePath(cards[1])} alt={getCardName(cards[1])} className="w-16 h-24 object-cover rounded-md shadow-md border-2 border-white mx-auto" loading="lazy" width="64" height="96" />
                        <p className="text-xs mt-1">{getCardName(cards[1])}</p>
                      </div>
                    </div>
                    <p className="text-gray-600"> {getCardName(cards[0])} ({cards[0]}) <HeartIcon className="inline text-red-500 mx-1" /> {getCardName(cards[1])} ({cards[1]})</p>
                  </div>
                  <h5 className="font-semibold text-gray-700 mb-1">能量互動描述：</h5><p className="text-gray-600 mb-3 leading-relaxed">{compatibilityInfo.desc}</p>
                  <h5 className="font-semibold text-red-700 mb-1 flex items-center gap-1"><AlertCircleIcon className="w-4 h-4" /> 潛在挑戰與成長點：</h5><p className="text-red-600 bg-red-50 p-3 rounded-md mb-3 leading-relaxed">{compatibilityInfo.challenges || "共同探索與理解是關鍵。"}</p>
                  {infoText && (<div className="mt-3 p-3 bg-indigo-50 rounded-lg border-l-4 border-indigo-400"><p className="text-sm text-indigo-700 flex items-start"><InfoIcon className="w-4 h-4 inline mr-2 mt-0.5 flex-shrink-0" /><span>{infoText}</span></p></div>)}
              </div>)}
            </div>
          );


          return (
            <div className="max-w-4xl mx-auto p-4 sm:p-6 bg-gradient-to-br from-purple-100 via-pink-100 to-indigo-100 rounded-xl shadow-xl font-sans">
              <div className="text-center mb-8"><h1 className="text-3xl font-bold text-purple-800 mb-2 flex items-center justify-center gap-2"><HeartIcon className="w-8 h-8" />塔羅牌雙人兼容性深度分析</h1><p className="text-gray-600">依據塔羅原型互動，深入分析兩人的靈魂契合度、個性相容性與共同成長潛力</p></div>
              
              <div className="bg-white rounded-lg p-6 shadow-md mb-6">
                <div className="grid md:grid-cols-2 gap-4 md:gap-x-6 md:gap-y-8">
                      <div className="space-y-3 md:space-y-4">
                          <h3 className="font-semibold text-gray-800 flex items-center gap-2"><UsersIcon className="w-5 h-5" /> 第一位夥伴</h3>
                          <input type="text" placeholder="姓名/暱稱" value={person1Name} onChange={(e) => setPerson1Name(e.target.value)} className="w-full px-3 py-1.5 text-sm rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent md:px-4 md:py-2"/>
                          <input type="date" value={person1Date} onChange={(e) => setPerson1Date(e.target.value)} className="w-full px-3 py-1.5 text-sm rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent md:px-4 md:py-2"/>
                      </div>
                      <div className="space-y-3 md:space-y-4">
                          <h3 className="font-semibold text-gray-800 flex items-center gap-2"><UsersIcon className="w-5 h-5" /> 第二位夥伴</h3>
                          <input type="text" placeholder="姓名/暱稱" value={person2Name} onChange={(e) => setPerson2Name(e.target.value)} className="w-full px-3 py-1.5 text-sm rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent md:px-4 md:py-2"/>
                          <input type="date" value={person2Date} onChange={(e) => setPerson2Date(e.target.value)} className="w-full px-3 py-1.5 text-sm rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent md:px-4 md:py-2"/>
                      </div>
                      <div className="md:col-span-2 border-t pt-4 md:pt-6">
                          <h3 className="font-semibold text-gray-800 mb-3 flex items-center gap-2"><ClockIcon/> 選擇分析時點</h3>
                          <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                              <div>
                                  <label className="block text-sm font-medium text-gray-700 mb-0.5 sm:mb-1">年份</label>
                                  <input type="number" value={targetYear} onChange={(e) => setTargetYear(parseInt(e.target.value, 10) || new Date().getFullYear())} className="w-full px-3 py-1.5 text-sm rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent md:px-4 md:py-2"/>
                              </div>
                              <div>
                                  <label className="block text-sm font-medium text-gray-700 mb-0.5 sm:mb-1">月份</label>
                                  <select value={targetMonth} onChange={(e) => setTargetMonth(parseInt(e.target.value, 10))} className="w-full px-3 py-1.5 text-sm rounded-md border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent md:px-4 md:py-2 bg-white">
                                      {[...Array(12).keys()].map(i => <option key={i+1} value={i+1}>{i+1}月</option>)}
                                  </select>
                              </div>
                          </div>
                      </div>
                  </div>
                  <button onClick={handleAnalyze} className="w-full mt-4 py-2 text-sm bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-md hover:from-purple-700 hover:to-pink-700 transition-colors font-semibold md:mt-6 md:py-3"><Sparkles className="inline-block w-4 h-4 mr-1" /> 分析兼容性 <Sparkles className="inline-block w-4 h-4 ml-1" /></button>
              </div>
              
              {result && (
                <div className="mt-8 space-y-6 animate-fade-in">
                  <div className="grid md:grid-cols-2 gap-6">
                    <div className="bg-white rounded-lg p-6 shadow-md">
                      <h3 className="font-semibold text-gray-800 mb-4">{result.person1.name}的生命與運勢牌組</h3>
                      <div className="space-y-2 text-sm">
                        <p><span className="font-medium text-purple-700">靈魂牌：</span>{result.person1.soulCard} - {getCardName(result.person1.soulCard)}</p>
                        <p><span className="font-medium text-pink-700">個性牌：</span>{result.person1.personalityCard} - {getCardName(result.person1.personalityCard)}</p>
                        <p><span className="font-medium text-indigo-700">互補/挑戰牌 (22-Soul)：</span>{result.person1.challengeCard} - {getCardName(result.person1.challengeCard)}</p>
                        <hr className="my-2"/>
                        <p><span className="font-medium text-yellow-700">年運牌 ({result.timeframe.year})：</span>{result.person1.fortuneCards.yearlyCard} - {getCardName(result.person1.fortuneCards.yearlyCard)}</p>
                        <p><span className="font-medium text-blue-700">月運牌 ({result.timeframe.month}月)：</span>{result.person1.fortuneCards.monthlyCard} - {getCardName(result.person1.fortuneCards.monthlyCard)}</p>
                      </div>
                    </div>
                    <div className="bg-white rounded-lg p-6 shadow-md">
                      <h3 className="font-semibold text-gray-800 mb-4">{result.person2.name}的生命與運勢牌組</h3>
                      <div className="space-y-2 text-sm">
                        <p><span className="font-medium text-purple-700">靈魂牌：</span>{result.person2.soulCard} - {getCardName(result.person2.soulCard)}</p>
                        <p><span className="font-medium text-pink-700">個性牌：</span>{result.person2.personalityCard} - {getCardName(result.person2.personalityCard)}</p>
                        <p><span className="font-medium text-indigo-700">互補/挑戰牌 (22-Soul)：</span>{result.person2.challengeCard} - {getCardName(result.person2.challengeCard)}</p>
                        <hr className="my-2"/>
                        <p><span className="font-medium text-yellow-700">年運牌 ({result.timeframe.year})：</span>{result.person2.fortuneCards.yearlyCard} - {getCardName(result.person2.fortuneCards.yearlyCard)}</p>
                        <p><span className="font-medium text-blue-700">月運牌 ({result.timeframe.month}月)：</span>{result.person2.fortuneCards.monthlyCard} - {getCardName(result.person2.fortuneCards.monthlyCard)}</p>
                      </div>
                    </div>
                  </div>
                  
                  <div className="bg-gradient-to-r from-purple-100 to-pink-100 rounded-lg p-6 text-center shadow-lg">
                    <h3 className="text-xl sm:text-2xl font-bold text-purple-800 mb-2">總體兼容性評級 (基於天生牌組)</h3>
                    <div className="text-xl sm:text-2xl font-semibold text-purple-700 mb-3">{result.compatibility.overall.level}</div>
                    <div className={`text-3xl sm:text-4xl font-bold ${getScoreColor(result.compatibility.overall.avgScore)} mb-4`}>{result.compatibility.overall.avgScore}%</div>
                    <p className="text-sm sm:text-base text-gray-700 max-w-2xl mx-auto leading-relaxed">{result.compatibility.overall.advice}</p>
                  </div>
                  
                   <div className="bg-gradient-to-r from-blue-100 to-indigo-100 rounded-lg p-6 shadow-lg mt-6">
                        <h3 className="text-xl sm:text-2xl font-bold text-blue-800 mb-2 text-center">
                            天生牌組互動分析
                        </h3>
                         <p className="text-center text-sm text-gray-600 max-w-2xl mx-auto">這部分分析您們天生的核心能量如何互動，揭示關係的長期潛力與課題。</p>
                   </div>
                   <div className="space-y-4">
                        {[
                          { key: 'soul', title: '靈魂層面兼容性 (核心本質)', icon: <Sparkles className="text-purple-600" />, cards: [result.person1.soulCard, result.person2.soulCard], info:"靈魂牌代表最深層的自我，此處的兼容性揭示了你們在生命目的與核心價值上的潛在連結或差異。"},
                          { key: 'personality', title: '個性層面兼容性 (日常互動)', icon: <UsersIcon className="text-pink-600" />, cards: [result.person1.personalityCard, result.person2.personalityCard], info:"個性牌反映了外在行為模式與學習課題。此兼容性關乎你們在日常相處、溝通風格及生活方式上的和諧度。"},
                          { key: 'challenge', title: '互補/挑戰整合潛力 (成長課題)', icon: <TargetIcon className="text-indigo-600" />, cards: [result.person1.challengeCard, result.person2.challengeCard], info: "此牌由【22-靈魂牌】計算，代表靈魂為達完整而需整合的互補能量。它揭示了彼此可能觸發的深層課題及共同成長的潛力，是關係中深刻學習的領域。" }
                        ].map(item => (
                            <CompatibilityItem key={item.key} {...item} itemKey={item.key} compatibilityInfo={result.compatibility[item.key]} infoText={item.info} isOpen={showDetails[item.key]} onToggle={() => setShowDetails(prev => ({...prev, [item.key]: !prev[item.key]}))} />
                        ))}
                   </div>


                  <div className="bg-gradient-to-r from-indigo-100 to-blue-100 rounded-lg p-6 shadow-lg mt-8">
                    <h3 className="text-xl sm:text-2xl font-bold text-indigo-800 mb-2 text-center flex items-center justify-center gap-2">
                        <ClockIcon /> 當前時運互動分析 ({result.timeframe.year}年{result.timeframe.month}月)
                    </h3>
                    <p className="text-center text-sm text-gray-600 max-w-2xl mx-auto">此部分分析您們在所選時間週期下的能量互動，提供順勢而為的指引。這屬於短期、動態的能量流，會影響天生牌組的展現方式。</p>
                  </div>
                   <div className="space-y-4">
                        {[
                          { key: 'yearly', title: `年度能量共振 (${result.timeframe.year}年)`, icon: <SunIcon className="text-yellow-600" />, cards: [result.person1.fortuneCards.yearlyCard, result.person2.fortuneCards.yearlyCard], info: `年運牌揭示了兩人在 ${result.timeframe.year} 年共同面對的宏觀主題、學習課題與發展機遇。這反映了你們在這一整年中的能量基調是和諧共振還是需要磨合。`},
                          { key: 'monthly', title: `月度主題互動 (${result.timeframe.month}月)`, icon: <MoonIcon className="text-blue-600" />, cards: [result.person1.fortuneCards.monthlyCard, result.person2.fortuneCards.monthlyCard], info: `月運牌則聚焦於 ${result.timeframe.month} 月的具體能量流動。它顯示了在年度大主題下，本月您們的互動模式、情緒焦點以及可能遇到的短期事件或挑戰。` }
                        ].map(item => (
                            <CompatibilityItem key={item.key} {...item} itemKey={item.key} compatibilityInfo={result.compatibility[item.key]} infoText={item.info} isOpen={showDetails[item.key]} onToggle={() => setShowDetails(prev => ({...prev, [item.key]: !prev[item.key]}))} />
                        ))}
                   </div>


                  <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-6 shadow-lg"><h3 className="font-semibold text-gray-800 mb-4 flex items-center gap-2 text-xl"><BookOpen /> 關係發展深度建議</h3><div className="space-y-4 text-sm text-gray-700 leading-relaxed"><p>• <strong>深化靈魂連結 ({result.compatibility.soul.score}%):</strong> 定期進行深度對話，分享內心的夢想、恐懼與靈性體悟。探索你們靈魂牌 ({getCardName(result.person1.soulCard)} & {getCardName(result.person2.soulCard)}) 之間的共鳴與課題 ({result.compatibility.soul.challenges})。共同參與能滋養靈魂的活動。</p><p>• <strong>促進個性互動 ({result.compatibility.personality.score}%):</strong> 欣賞並學習彼此個性牌 ({getCardName(result.person1.personalityCard)} & {getCardName(result.person2.personalityCard)}) 的優點，尊重差異。將個性上的挑戰 ({result.compatibility.personality.challenges}) 視為學習和共同成長的機會，練習有效的溝通技巧。</p><p>• <strong>整合挑戰課題 ({result.compatibility.challenge.score}%):</strong> 當衝突或不適出現時，觀察是否觸發了彼此互補/挑戰牌 ({getCardName(result.person1.challengeCard)} & {getCardName(result.person2.challengeCard)}) 所代表的面向。這些互動 ({result.compatibility.challenge.challenges}) 提供了共同療癒和整合互補能量的寶貴機會。勇敢面對，誠實分享。</p><p>• <strong>把握當前時運:</strong> 關注您們在 {result.timeframe.year} 年的年運牌 ({getCardName(result.person1.fortuneCards.yearlyCard)} & {getCardName(result.person2.fortuneCards.yearlyCard)}) 互動，以及 {result.timeframe.month} 月月運牌 ({getCardName(result.person1.fortuneCards.monthlyCard)} & {getCardName(result.person2.fortuneCards.monthlyCard)}) 的互動。這能幫助您們順應當前的能量流，共同應對機遇與挑戰。</p><p>• <strong>共同創造與成長:</strong> 設定共同的靈性或個人成長目標。利用你們牌組的綜合力量與智慧，相互支持，共同進化。記住，任何挑戰都是關係深化與個人成熟的墊腳石。持續的愛、尊重、理解與溝通是關係長久美滿的關鍵。</p><p className="mt-4 pt-4 border-t border-purple-200 text-xs text-gray-500"><InfoIcon className="inline w-3 h-3 mr-1" />免責聲明：此分析僅供個人探索與娛樂參考，不能替代專業的心理諮詢或關係輔導。請以開放和覺察的態度來對待結果。</p></div></div>
                </div>
              )}
            </div>
          );
        };
        
        // --- FORTUNE CARD CALCULATOR ---
        const FortuneCardCalculator = () => {
          const [birthDate, setBirthDate] = useState('');
          const [targetYear, setTargetYear] = useState(new Date().getFullYear());
          const [targetMonth, setTargetMonth] = useState(new Date().getMonth() + 1);
          const [result, setResult] = useState(null);
          const [showProcess, setShowProcess] = useState(false);
          const [showInfo, setShowInfo] = useState(false);

          const formatChineseDate = (dateObj) => {
            if (!dateObj || isNaN(dateObj.getTime())) return '';
            const year = dateObj.getFullYear();
            const month = dateObj.getMonth() + 1;
            const day = dateObj.getDate();
            return `${year}年${month}月${day}日`;
          };

          const handleCalculate = () => {
            if (!birthDate) {
              alert('請輸入您的出生日期');
              return;
            }

            const targetDate = new Date(targetYear, targetMonth - 1, 1);
            // FIX #1: Correctly destructure all required parts from the function call
            const { yearlyCard, monthlyCard, cycleInfo } = sharedCalculateFortuneCards(birthDate, targetDate);
            
            // Generate steps for display
            const [bYear, bMonth, bDay] = birthDate.split('-').map(Number);
            const yearlySteps = [];
            const personalBase = sharedSumDigits(bYear) + bMonth + sharedSumDigits(bDay);
            yearlySteps.push(`個人基數 = (${sharedSumDigits(bYear)}) + (${bMonth}) + (${sharedSumDigits(bDay)}) = ${personalBase}`);
            const cycleStartYear = cycleInfo.yearly.start.getFullYear();
            const yearlyValue = personalBase + sharedSumDigits(cycleStartYear);
            yearlySteps.push(`年運數值 = 個人基數 + 生日年和 = ${personalBase} + ${sharedSumDigits(cycleStartYear)} = ${yearlyValue}`);
            let yearlyCardRaw = (yearlyValue - 1) % 22;
            yearlyCardRaw = (yearlyCardRaw < 0) ? yearlyCardRaw + 22 : yearlyCardRaw;
            yearlySteps.push(`年運卡數值 = (年運數值 - 1) % 22 = ${yearlyCardRaw}`);
            if (yearlyCardRaw === 0) yearlySteps.push(`結果為 0，對應塔羅牌 0 (愚者)`);


            const monthlySteps = [];
            const yearlyCardForCalc = yearlyCard === 0 ? 22 : yearlyCard;
            monthlySteps.push(`從年運卡數值開始: ${yearlyCardForCalc}`);
            const bDaySimplified = sharedReduceToSingleDigit(bDay);
            monthlySteps.push(`出生日化簡值: ${bDay} -> ${bDaySimplified}`);
            const monthlyAdjustment = bMonth + bDaySimplified;
            monthlySteps.push(`個人月份調整值 = 出生月 + 出生日化簡值 = ${bMonth} + ${bDaySimplified} = ${monthlyAdjustment}`);
            const monthlyValue = yearlyCardForCalc + parseInt(targetMonth, 10) + monthlyAdjustment;
            monthlySteps.push(`月運數值 = 年運卡值 + 目標月 + 調整值 = ${yearlyCardForCalc} + ${targetMonth} + ${monthlyAdjustment} = ${monthlyValue}`);
            let monthlyCardRaw = (monthlyValue - 1) % 22;
            monthlyCardRaw = (monthlyCardRaw < 0) ? monthlyCardRaw + 22 : monthlyCardRaw;
            monthlySteps.push(`月運卡數值 = (月運數值 - 1) % 22 = ${monthlyCardRaw}`);
            if (monthlyCardRaw === 0) monthlySteps.push(`結果為 0，對應塔羅牌 0 (愚者)`);
            
            setResult({
              yearlyCard,
              monthlyCard,
              cycleInfo, // FIX #1: Add cycleInfo to the result state
              steps: { yearly: yearlySteps, monthly: monthlySteps }
            });
            setShowProcess(false);
          };

          const FortuneCardInfo = () => (
             <div className="mt-8 p-6 bg-white rounded-lg shadow-md space-y-6 text-gray-700 transition-all duration-500 ease-in-out">
                <h2 className="text-2xl font-bold text-purple-800 text-center flex items-center justify-center gap-2"><BookOpen /> 年運卡和月運卡的基礎原理與具體計算方法</h2>
                <section>
                    <h3 className="text-xl font-semibold text-purple-700 mb-2">基礎原理</h3>
                    <div className="pl-4 border-l-4 border-purple-300">
                        <p><strong>核心概念:</strong> 此計算器採用基於個人生命週期的計算方式。流年（年運）週期從您當年生日開始，到次年生日結束，而非日曆年。流月（月運）週期則是在此流年週期內的逐月推進。</p>
                        <p><strong>數學基礎:</strong> 主要運用數字化簡原理（將複雜數字相加化簡）與循環映射（利用模運算建立時間與卡牌的對應關係），並以個人出生日期作為獨特的個人基數。</p>
                    </div>
                </section>
                <section>
                    <h3 className="text-xl font-semibold text-purple-700 mb-2">年運卡計算方法</h3>
                    <div className="bg-blue-50 rounded-lg p-4 text-sm text-blue-800 space-y-2">
                        <p><strong>第一步：計算個人基數</strong><br/><code>個人基數 = (出生年各位數字之和) + (出生月) + (出生日各位數字之和)</code></p>
                        <p><strong>第二步：結合流年起始年份</strong><br/><code>年運數值 = 個人基數 + (流年起始年份各位數字之和)</code></p>
                        <p><strong>第三步：化簡至塔羅範圍 (0-21)</strong><br/><code>年運卡號 = (年運數值 - 1) % 22</code></p>
                    </div>
                </section>
                <section>
                    <h3 className="text-xl font-semibold text-purple-700 mb-2">月運卡計算方法</h3>
                    <div className="bg-green-50 rounded-lg p-4 text-sm text-green-800 space-y-2">
                        <p><strong>第一步：獲得年運卡數值</strong><br/><span>使用上述方法計算出的年運卡號碼（0-21）。若為0(愚者)，計算時用22。</span></p>
                        <p><strong>第二步：計算月份調整值</strong><br/><code>個人月份調整值 = (出生月) + (出生日化簡值)</code></p>
                        <p><strong>第三步：結合目標月份</strong><br/><code>月運數值 = 年運卡數值 + 目標月份 + 個人月份調整值</code><br/><code>月運卡號 = (月運數值 - 1) % 22</code></p>
                    </div>
                </section>
             </div>
          );

          const FortuneCardDisplay = ({ icon, title, cardId, bgColor, textColor, borderColor }) => {
            if (cardId === null || cardId === undefined || !cardDetails[cardId]) return null;
            const details = cardDetails[cardId];
            return (
              <div className={`${bgColor} rounded-lg p-4 shadow-md border-l-4 ${borderColor}`}>
                <div className="mb-3 flex justify-center">
                  <img
                    src={sharedGetCardImagePath(cardId)}
                    alt={details.name}
                    className="w-full max-w-[120px] rounded-lg shadow-md object-cover border-2 border-white"
                    loading="lazy"
                    width="120"
                    height="200"
                  />
                </div>
                
                <div className="flex items-center gap-2 mb-2">
                  {icon}
                  <h3 className={`font-semibold ${textColor}`}>{title}</h3>
                </div>
                <div className={`text-3xl font-bold ${textColor} mb-1`}>
                  {cardId} - {details.name}
                </div>
                <p className={`text-md font-semibold ${textColor} mb-2`}>{details.shortMeaning}</p>
              </div>
            );
          };

          return (
            <div className="max-w-3xl mx-auto p-4 sm:p-6 bg-gradient-to-br from-indigo-100 to-blue-100 rounded-xl shadow-lg md:shadow-xl font-sans">
              <div className="text-center mb-8">
                <h1 className="text-3xl font-bold text-indigo-800 mb-2 flex items-center justify-center gap-2">
                  <ClockIcon /> 流年/流月運勢計算器
                </h1>
                <p className="text-gray-600">結合您的出生日期與特定時間，揭示年度與月度能量主題</p>
              </div>

              <div className="bg-white rounded-lg p-6 shadow-md mb-6 space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2"><Calendar />您的出生日期</label>
                        <input type="date" value={birthDate} onChange={(e) => setBirthDate(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500"/>
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2"><TargetIcon />目標年份</label>
                        <input type="number" value={targetYear} onChange={(e) => setTargetYear(parseInt(e.target.value, 10) || new Date().getFullYear())} className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500"/>
                    </div>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2"><MoonIcon />目標月份</label>
                  <select value={targetMonth} onChange={(e) => setTargetMonth(parseInt(e.target.value, 10))} className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 bg-white">
                    {[...Array(12).keys()].map(i => <option key={i+1} value={i+1}>{i+1}月</option>)}
                  </select>
                </div>
                <button onClick={handleCalculate} className="w-full bg-indigo-600 text-white py-3 rounded-md hover:bg-indigo-700 transition-colors font-semibold flex items-center justify-center gap-2">
                  <Sparkles className="w-5 h-5" /> 計算我的運勢牌卡
                </button>
              </div>

              {result && (
                <div className="space-y-6 animate-fade-in">
                  <div className="bg-white rounded-lg p-6 shadow-md">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">
                      您在 {targetYear} 年 {targetMonth} 月的運勢牌卡
                    </h2>
                    <div className="grid grid-cols-1 gap-6">
                       <FortuneCardDisplay 
                          icon={<SunIcon className="text-yellow-600" />} 
                          title={`${targetYear} 年運卡`}
                          cardId={result.yearlyCard}
                          bgColor="bg-yellow-100"
                          textColor="text-yellow-900"
                          borderColor="border-yellow-500"
                        />
                       <FortuneCardDisplay 
                          icon={<MoonIcon className="text-blue-600" />} 
                          title={`${targetMonth} 月運卡`}
                          cardId={result.monthlyCard}
                          bgColor="bg-blue-100"
                          textColor="text-blue-900"
                          borderColor="border-blue-500"
                        />
                    </div>
                     <div className="mt-6 p-4 bg-gray-50 rounded-lg text-sm">
                        <h4 className="font-semibold text-gray-700 mb-2">運勢解讀提示：</h4>
                        <div className="text-gray-600 space-y-2">
                            <p>
                                <strong>流年週期：</strong>
                                {/* FIX #2: Removed `this.` from function calls */}
                                {formatChineseDate(result.cycleInfo.yearly.start)} - {formatChineseDate(result.cycleInfo.yearly.end)}
                                <br/>
                                <strong className="text-yellow-800">{cardDetails[result.yearlyCard].name}</strong> 設定了此期間的整體基調與學習主題
                            </p>
                            <p>
                                <strong>流月週期：</strong>
                                {/* FIX #2: Removed `this.` from function calls */}
                                {formatChineseDate(result.cycleInfo.monthly.start)} - {formatChineseDate(result.cycleInfo.monthly.end)}
                                <br/>
                                <strong className="text-blue-800">{cardDetails[result.monthlyCard].name}</strong> 揭示了此期間需要關注的具體能量
                            </p>
                            <p className="pt-2">
                                請思考：<strong>{cardDetails[result.yearlyCard].shortMeaning.split('、')[0]}</strong> 的年度主題，
                                在此月是如何透過 <strong>{cardDetails[result.monthlyCard].shortMeaning.split('、')[0]}</strong> 的形式顯現？
                            </p>
                        </div>
                     </div>
                  </div>
                  
                  <button onClick={() => setShowProcess(!showProcess)} className="text-indigo-600 hover:text-indigo-800 text-sm font-medium flex items-center gap-1">
                    {showProcess ? '隱藏' : '顯示'}計算過程 <span className="text-indigo-600">{showProcess ? <ChevronUp /> : <ChevronDown />}</span>
                  </button>

                  {showProcess && (
                    <div className="mt-2 p-4 bg-white rounded-lg shadow-md animate-fade-in space-y-4">
                      <div>
                        <h4 className="font-semibold text-gray-700 mb-2 border-b pb-1">年運卡計算步驟：</h4>
                        <div className="space-y-1 font-mono text-xs sm:text-sm text-gray-600">
                          {result.steps.yearly.map((step, index) => <p key={index}>{step}</p>)}
                        </div>
                      </div>
                       <div>
                        <h4 className="font-semibold text-gray-700 mb-2 border-b pb-1">月運卡計算步驟：</h4>
                        <div className="space-y-1 font-mono text-xs sm:text-sm text-gray-600">
                          {result.steps.monthly.map((step, index) => <p key={index}>{step}</p>)}
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              )}
              
              <div className="text-center mt-8">
                <button onClick={() => setShowInfo(!showInfo)} className="inline-flex items-center gap-2 px-6 py-3 bg-white text-indigo-700 rounded-full shadow-md hover:bg-indigo-50 transition-transform transform hover:scale-105">
                  <span className="font-semibold">了解運勢卡計算原理</span>
                  {showInfo ? <ChevronUp className="w-5 h-5" /> : <ChevronDown className="w-5 h-5" />}
                </button>
              </div>
              {showInfo && <FortuneCardInfo />}
            </div>
          );
        };


        // --- COMPREHENSIVE TAROT SESSION COMPONENT ---
        const ComprehensiveTarotSession = () => {
          const [birthDate, setBirthDate] = useState('');
          const [results, setResults] = useState(null);

          const zodiacSigns = {
            aries: { name: '牡羊座', dates: '3/21-4/19', element: '火', traits: '勇敢、衝動、領導力、活力、積極主動', challenges: '急躁、自我中心、缺乏耐心、容易衝動', keywords: ['開創', '冒險', '獨立', '直接', '熱情'], lifeTheme: '我是 - 開創與領導的能量' },
            taurus: { name: '金牛座', dates: '4/20-5/20', element: '土', traits: '穩定、實際、堅持、享受、可靠', challenges: '固執、物質主義、抗拒改變、過度保守', keywords: ['穩定', '持久', '享受', '實用', '堅韌'], lifeTheme: '我擁有 - 建立與保持的能量' },
            gemini: { name: '雙子座', dates: '5/21-6/20', element: '風', traits: '聰明、好奇、溝通、多才、適應力強', challenges: '善變、表面、缺乏深度、分心', keywords: ['溝通', '學習', '多樣', '靈活', '好奇'], lifeTheme: '我思考 - 交流與學習的能量' },
            cancer: { name: '巨蟹座', dates: '6/21-7/22', element: '水', traits: '關愛、直覺、家庭、保護、同理心', challenges: '情緒化、過度敏感、依賴、防衛性強', keywords: ['關懷', '保護', '直覺', '家庭', '情感'], lifeTheme: '我感受 - 滋養與保護的能量' },
            leo: { name: '獅子座', dates: '7/23-8/22', element: '火', traits: '自信、慷慨、創造、表演、領導魅力', challenges: '自負、需要關注、戲劇化、驕傲', keywords: ['創造', '表演', '領導', '光明', '慷慨'], lifeTheme: '我創造 - 展現與領導的能量' },
            virgo: { name: '處女座', dates: '8/23-9/22', element: '土', traits: '完美、分析、服務、實用、細緻', challenges: '挑剔、焦慮、過度完美主義、過度分析', keywords: ['分析', '服務', '完美', '實用', '精確'], lifeTheme: '我分析 - 完善與服務的能量' },
            libra: { name: '天秤座', dates: '9/23-10/22', element: '風', traits: '和諧、美感、公正、夥伴、平衡', challenges: '猶豫不決、迴避衝突、依賴他人、表面和諧', keywords: ['平衡', '和諧', '美感', '合作', '公正'], lifeTheme: '我平衡 - 和諧與合作的能量' },
            scorpio: { name: '天蠍座', dates: '10/23-11/21', element: '水', traits: '深刻、熱情、轉化、神秘、洞察力', challenges: '佔有、報復、極端、控制、秘密', keywords: ['深度', '轉化', '力量', '神秘', '再生'], lifeTheme: '我轉化 - 深度與重生的能量' },
            sagittarius: { name: '射手座', dates: '11/22-12/21', element: '火', traits: '冒險、哲學、自由、樂觀、智慧', challenges: '不負責任、誇大、缺乏承諾、過度理想', keywords: ['探索', '哲學', '自由', '擴展', '智慧'], lifeTheme: '我探索 - 擴展與智慧的能量' },
            capricorn: { name: '摩羯座', dates: '12/22-1/19', element: '土', traits: '野心、紀律、責任、成功、實際', challenges: '嚴肅、悲觀、工作狂、過度控制', keywords: ['目標', '責任', '成就', '結構', '權威'], lifeTheme: '我達成 - 建構與成就的能量' },
            aquarius: { name: '水瓶座', dates: '1/20-2/18', element: '風', traits: '創新、獨立、人道、未來、友誼', challenges: '疏離、叛逆、不切實際、固執己見', keywords: ['創新', '獨立', '友誼', '人道', '未來'], lifeTheme: '我知道 - 創新與人道的能量' },
            pisces: { name: '雙魚座', dates: '2/19-3/20', element: '水', traits: '同情、想像、靈性、藝術、直覺', challenges: '逃避、犧牲、缺乏界限、過度敏感', keywords: ['靈性', '同情', '藝術', '夢想', '犧牲'], lifeTheme: '我相信 - 靈性與同情的能量' }
          };

          const getZodiacSign = (date) => {
            if (!date) return null;
            const [year, month, day] = date.split('-').map(Number);
            const dateStr = `${month.toString().padStart(2, '0')}${day.toString().padStart(2, '0')}`;
            
            if (dateStr >= '0321' && dateStr <= '0419') return 'aries';
            if (dateStr >= '0420' && dateStr <= '0520') return 'taurus';
            if (dateStr >= '0521' && dateStr <= '0621') return 'gemini'; // Corrected date
            if (dateStr >= '0622' && dateStr <= '0722') return 'cancer'; // Corrected date
            if (dateStr >= '0723' && dateStr <= '0822') return 'leo';
            if (dateStr >= '0823' && dateStr <= '0922') return 'virgo';
            if (dateStr >= '0923' && dateStr <= '1023') return 'libra'; // Corrected date
            if (dateStr >= '1024' && dateStr <= '1122') return 'scorpio'; // Corrected date
            if (dateStr >= '1123' && dateStr <= '1221') return 'sagittarius'; // Corrected date
            if (dateStr >= '1222' || dateStr <= '0119') return 'capricorn';
            if (dateStr >= '0120' && dateStr <= '0218') return 'aquarius';
            if (dateStr >= '0219' && dateStr <= '0320') return 'pisces';
            return null;
          };

          const calculateTarotCards = (date) => {
            const digits = date.replace(/-/g, '').split('').map(Number);
            let total = digits.reduce((sum, digit) => sum + digit, 0);
            while (total > 21) {
              const newDigits = total.toString().split('').map(Number);
              total = newDigits.reduce((sum, digit) => sum + digit, 0);
            }
            const soulCard = total;
            let personalityCard = null;
            let challengeCard = null;
            let giftCard = null;

            if (soulCard === 19) {
                personalityCard = 10; // 1+9=10
                giftCard = 1; // 1+0=1
            } else {
                if (soulCard >= 10) {
                    const personalityDigits = soulCard.toString().split('').map(Number);
                    personalityCard = personalityDigits.reduce((sum, digit) => sum + digit, 0);
                } else {
                    personalityCard = soulCard;
                }
                const soulValueForCalc = soulCard === 0 ? 22 : soulCard;
                challengeCard = 22 - soulValueForCalc;
            }

            return { soulCard, personalityCard, challengeCard, giftCard };
          };

          const analyzeZodiacTarotConnection = (zodiacSign, tarotCards) => {
            if (!zodiacSign || !tarotCards) return null;
            
            const zodiac = zodiacSigns[zodiacSign];
            const { soulCard, personalityCard, challengeCard, giftCard } = tarotCards;
            
            const zodiacTarotCorrelations = {
              aries: { primary: [4, 7], secondary: [1, 19], supportive: [8, 16], challenging: [2, 12], element: '火', modality: '開創', theme: '行動力與領導' },
              taurus: { primary: [3, 5], secondary: [21, 6], supportive: [9, 14], challenging: [16, 1], element: '土', modality: '固定', theme: '穩定與豐盛' },
              gemini: { primary: [6, 1], secondary: [0, 17], supportive: [5, 11], challenging: [9, 4], element: '風', modality: '變動', theme: '溝通與連結' },
              cancer: { primary: [2, 18], secondary: [7, 3], supportive: [6, 14], challenging: [4, 15], element: '水', modality: '開創', theme: '情感與保護' },
              leo: { primary: [8, 19], secondary: [11, 1], supportive: [3, 21], challenging: [2, 12], element: '火', modality: '固定', theme: '創造力與自信' },
              virgo: { primary: [9, 1], secondary: [14, 5], supportive: [11, 20], challenging: [0, 18], element: '土', modality: '變動', theme: '服務與分析' },
              libra: { primary: [11, 6], secondary: [2, 3], supportive: [17, 19], challenging: [7, 4], element: '風', modality: '開創', theme: '平衡與關係' },
              scorpio: { primary: [13, 15], secondary: [2, 8], supportive: [18, 20], challenging: [3, 19], element: '水', modality: '固定', theme: '轉化與深度' },
              sagittarius: { primary: [14, 10], secondary: [5, 9], supportive: [0, 19], challenging: [1, 18], element: '火', modality: '變動', theme: '探索與智慧' },
              capricorn: { primary: [15, 4], secondary: [21, 9], supportive: [5, 11], challenging: [7, 18], element: '土', modality: '開創', theme: '成就與責任' },
              aquarius: { primary: [17, 0], secondary: [16, 11], supportive: [1, 6], challenging: [19, 4], element: '風', modality: '固定', theme: '創新與人道' },
              pisces: { primary: [18, 12], secondary: [2, 17], supportive: [14, 13], challenging: [1, 9], element: '水', modality: '變動', theme: '靈性與慈悲' }
            };

            const correlation = zodiacTarotCorrelations[zodiacSign] || {};
            const analyzeCardInDimension = (cardId, dimension) => {
              if (cardId === null || !correlation[dimension]) return false;
              return correlation[dimension].includes(cardId);
            };
            const calculateHarmonyScore = (cardId) => {
              if (cardId === null) return 0;
              let score = 0;
              if (analyzeCardInDimension(cardId, 'primary')) score += 3;
              if (analyzeCardInDimension(cardId, 'secondary')) score += 2;
              if (analyzeCardInDimension(cardId, 'supportive')) score += 1;
              if (analyzeCardInDimension(cardId, 'challenging')) score -= 2;
              return score;
            };

            let totalHarmonyScore = 0;
            const allCards = [soulCard, personalityCard, challengeCard, giftCard].filter(c => c !== null);
            allCards.forEach(card => {
              totalHarmonyScore += calculateHarmonyScore(card);
            });

            const harmonyPercentage = Math.min(100, Math.max(0, 50 + (totalHarmonyScore * 5)));
            const overallHarmony = harmonyPercentage >= 70;

            const generateDimensionAnalysis = (cardId, cardName, role) => {
              if (cardId === null) return '';
              const primary = analyzeCardInDimension(cardId, 'primary');
              const secondary = analyzeCardInDimension(cardId, 'secondary');
              const supportive = analyzeCardInDimension(cardId, 'supportive');
              const challenging = analyzeCardInDimension(cardId, 'challenging');
              
              if (primary) return `您的${role} ${cardId}號${cardName} 強烈共振於${zodiac.name}的核心【${correlation.theme}】特質，是您天賦的重要展現。`;
              if (secondary) return `您的${role} ${cardId}號${cardName} 與${zodiac.name}的能量緊密相關，輔助了您的【${correlation.theme}】主題。`;
              if (supportive) return `您的${role} ${cardId}號${cardName} 為${zodiac.name}提供了支持性的能量，幫助您更好地發揮潛能。`;
              if (challenging) return `您的${role} ${cardId}號${cardName} 為${zodiac.name}帶來了需要整合的挑戰課題，是您成長的關鍵。`;
              return `您的${role} ${cardId}號${cardName} 與${zodiac.name}呈現互補對比，這創造了豐富的個人發展層次。`;
            };

            const soulDimensionText = generateDimensionAnalysis(soulCard, cardDetails[soulCard]?.name, '靈魂牌');
            const personalityDimensionText = generateDimensionAnalysis(personalityCard, cardDetails[personalityCard]?.name, '個性牌');
            const challengeDimensionText = generateDimensionAnalysis(challengeCard, cardDetails[challengeCard]?.name, '挑戰牌');
            const giftDimensionText = generateDimensionAnalysis(giftCard, cardDetails[giftCard]?.name, '天賦牌');
            const allAnalyses = [soulDimensionText, personalityDimensionText, challengeDimensionText, giftDimensionText].filter(Boolean).join('\n');

            return {
              zodiac, overallHarmony, harmonyPercentage,
              detailedAnalysis: `🌟 **整體和諧度**: ${harmonyPercentage}% - ${overallHarmony ? '高度和諧共振' : '動態平衡發展'}\n\n🏺 **星座原型**: ${zodiac.name} (${correlation.element}象 × ${correlation.modality}座)\n   核心主題: ${correlation.theme} | ${zodiac.lifeTheme}\n\n🔮 **多維度共鳴分析**:\n${allAnalyses}`,
              suggestions: `🎯 **整合策略**:\n\n🌟 **發揮星座優勢**: 深入發展${zodiac.name}的核心特質（${zodiac.traits.split('、').slice(0,3).join('、')}），將其作為您行動的基石。\n\n🃏 **整合塔羅智慧**: 當遇到${zodiac.name}的挑戰（如${zodiac.challenges.split('、')[0]}）時，請參考您靈魂牌【${cardDetails[soulCard]?.name}】的指引來穩定內核。同時思考您的挑戰牌【${challengeCard !== null ? cardDetails[challengeCard]?.name : 'N/A'}】能帶來何種平衡視角。\n\n🔄 **動態平衡練習**: ${overallHarmony ? `您的星座與塔羅牌組高度協調。為了全面發展，請有意識地探索塔羅牌中與您星座較不相關的能量，例如若您火象重，可多練習水象的耐心與同理。` : `擁抱星座與塔羅牌組之間的“創意張力”。它們的差異是您內在“煉金術”的原料，能在對比中激發創新的力量和更完整的自我認知。`}`
            };
          };

          const handleAnalyze = () => {
            if (!birthDate) {
              alert('請輸入出生日期');
              return;
            }
            
            const tarotCards = calculateTarotCards(birthDate);
            const zodiacSign = getZodiacSign(birthDate);
            const zodiacAnalysis = analyzeZodiacTarotConnection(zodiacSign, tarotCards);
            
            setResults({
              birthDate,
              tarotCards,
              zodiacSign,
              zodiacAnalysis
            });
          };

          const CardDisplay = ({ icon, title, cardId, bgColor, textColor, borderColor, description }) => {
            if (cardId === null || cardId === undefined || !cardDetails[cardId]) return null;
            const details = cardDetails[cardId];
            
            return (
              <div className={`${bgColor} rounded-lg p-4 shadow-md border-l-4 ${borderColor} transition-all duration-300 flex flex-col justify-between h-full`}>
                <div>
                    <div className="flex items-center gap-2 mb-2">{icon}<h3 className={`font-semibold ${textColor}`}>{title}</h3></div>
                    <div className={`text-xl font-bold ${textColor} mb-1`}>{cardId} - {details.name}</div>
                    <p className={`text-sm font-semibold ${textColor} mb-2`}>{details.shortMeaning}</p>
                    {description && <p className={`text-xs ${textColor} opacity-80`}>{description}</p>}
                </div>
                 <div className="mt-3">
                  <img src={sharedGetCardImagePath(cardId)} alt={details.name} className="w-full max-w-[100px] mx-auto rounded-lg shadow-md object-cover border-2 border-white" onError={(e) => e.target.style.display = 'none'} loading="lazy" width="100" height="167" />
                </div>
              </div>
            );
          };

          return (
            <div className="max-w-4xl mx-auto p-4 sm:p-6 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-xl shadow-xl font-sans">
              <div className="text-center mb-8">
                <h1 className="text-3xl font-bold text-purple-800 mb-2 flex items-center justify-center gap-2">
                  <Sparkles className="w-8 h-8" />塔羅生命藍圖 × 太陽星座整合解析
                </h1>
                <p className="text-gray-600">深度結合塔羅生命靈數與太陽星座特質的個人命理分析</p>
              </div>

              <div className="bg-white rounded-lg p-6 shadow-md mb-6">
                <div className="max-w-md mx-auto">
                  <label className="block text-sm font-medium text-gray-700 mb-2 text-center"><Calendar /> 請輸入您的出生日期</label>
                  <input type="date" value={birthDate} onChange={(e) => setBirthDate(e.target.value)} className="w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 text-center text-lg" />
                  <button onClick={handleAnalyze} className="w-full mt-4 bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 rounded-md hover:from-purple-700 hover:to-indigo-700 transition-colors font-semibold flex items-center justify-center gap-2"><Sparkles className="w-5 h-5" /> 開始深度解析</button>
                </div>
              </div>

              {results && (
                <div className="space-y-6 animate-fade-in">
                  <div className="grid md:grid-cols-2 gap-6">
                    <div className="bg-white rounded-lg p-6 shadow-md">
                      <h3 className="text-xl font-bold text-orange-800 mb-4 flex items-center gap-2">♈ 您的太陽星座</h3>
                      {results.zodiacSign && zodiacSigns[results.zodiacSign] && (
                        <div className="space-y-3">
                          <div className="text-center p-4 bg-orange-50 rounded-lg">
                            <h4 className="text-2xl font-bold text-orange-700 mb-1">{zodiacSigns[results.zodiacSign].name}</h4>
                            <p className="text-sm text-gray-600">{zodiacSigns[results.zodiacSign].dates}</p>
                            <p className="text-lg font-semibold text-orange-600 mt-2">{zodiacSigns[results.zodiacSign].lifeTheme}</p>
                          </div>
                          <div className="grid grid-cols-1 gap-2 text-sm">
                            <p><strong>元素:</strong> <span className="text-orange-600">{zodiacSigns[results.zodiacSign].element}</span></p>
                            <p><strong>關鍵字:</strong> <span className="text-blue-600">{zodiacSigns[results.zodiacSign].keywords.join('、')}</span></p>
                            <p><strong>優勢特質:</strong> {zodiacSigns[results.zodiacSign].traits}</p>
                            <p><strong>成長課題:</strong> <span className="text-red-600">{zodiacSigns[results.zodiacSign].challenges}</span></p>
                          </div>
                        </div>
                      )}
                    </div>
                    <div className="bg-white rounded-lg p-6 shadow-md">
                      <h3 className="text-xl font-bold text-purple-800 mb-4 flex items-center gap-2">🌟 您的塔羅生命牌組</h3>
                      <div className="grid grid-cols-1 gap-3 h-full">
                        <div className="grid grid-cols-2 gap-3">
                           <CardDisplay icon={<Hash className="w-4 h-4 text-purple-600" />} title="靈魂牌" cardId={results.tarotCards.soulCard} bgColor="bg-purple-50" textColor="text-purple-900" borderColor="border-purple-500" description="核心本質" />
                           <CardDisplay icon={<User className="w-4 h-4 text-pink-600" />} title="個性牌" cardId={results.tarotCards.personalityCard} bgColor="bg-pink-50" textColor="text-pink-900" borderColor="border-pink-500" description="外在課題" />
                        </div>
                        <div className="grid grid-cols-2 gap-3">
                            {results.tarotCards.challengeCard !== null && (
                              <CardDisplay icon={<TargetIcon className="w-4 h-4 text-indigo-600" />} title="挑戰牌" cardId={results.tarotCards.challengeCard} bgColor="bg-indigo-50" textColor="text-indigo-900" borderColor="border-indigo-500" description="整合潛能" />
                            )}
                            {results.tarotCards.giftCard !== null && (
                              <CardDisplay icon={<Gift className="w-4 h-4 text-yellow-600" />} title="天賦牌" cardId={results.tarotCards.giftCard} bgColor="bg-yellow-50" textColor="text-yellow-900" borderColor="border-yellow-500" description="創造動力" />
                            )}
                        </div>
                      </div>
                    </div>
                  </div>
                  {results.zodiacAnalysis && (
                    <div className="bg-white rounded-lg p-6 shadow-md">
                      <h3 className="text-2xl font-bold text-indigo-800 mb-4 flex items-center gap-2">🔄 太陽星座 × 塔羅生命牌 整合解析</h3>
                      <div className="mb-6 p-4 rounded-lg border-l-4" style={{backgroundColor: results.zodiacAnalysis.overallHarmony ? '#f0fdf4' : '#fffbeb', borderColor: results.zodiacAnalysis.overallHarmony ? '#4ade80' : '#facc15'}}>
                          <div className={`text-xl font-bold mb-2 ${results.zodiacAnalysis.overallHarmony ? 'text-green-700' : 'text-amber-700'}`}>
                              {results.zodiacAnalysis.overallHarmony ? `高度和諧共振 (${results.zodiacAnalysis.harmonyPercentage}%)` : `動態平衡發展 (${results.zodiacAnalysis.harmonyPercentage}%)`}
                          </div>
                          <div className="prose prose-sm max-w-none text-gray-800 whitespace-pre-line">{results.zodiacAnalysis.detailedAnalysis}</div>
                      </div>
                      <div className="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400">
                          <h4 className="font-bold text-blue-800 mb-3">🎯 個人成長整合建議</h4>
                          <div className="text-sm text-blue-900 whitespace-pre-line leading-relaxed">{results.zodiacAnalysis.suggestions}</div>
                      </div>
                    </div>
                  )}
                  <div className="text-center p-6 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg border border-purple-200">
                    <h4 className="text-lg font-bold text-purple-800 mb-3">🙏 解析說明</h4>
                    <p className="text-gray-700 leading-relaxed text-sm">此解析結合了您的太陽星座特質與塔羅生命靈數，提供一個全方位的個人特質分析。太陽星座反映您的外在表達與核心動機，塔羅生命牌則揭示您的靈魂使命與內在課題。通過理解兩者的關係，您可以更好地整合不同面向的自我，活出更完整、更真實的人生。</p>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // --- MAIN APP COMPONENT ---
        const App = () => {
          const [activeCalculator, setActiveCalculator] = useState('comprehensive'); // 'comprehensive', 'birth', 'compatibility', 'fortune'

          const navButtonBaseClass = "px-3 py-2 sm:px-6 sm:py-3 rounded-lg font-semibold transition-all text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-offset-2";
          const activeNavButtonClass = "bg-purple-600 text-white shadow-lg transform scale-105 focus:ring-purple-500";
          const inactiveNavButtonClass = "bg-white text-purple-700 hover:bg-purple-100 focus:ring-purple-400";
          
          return (
            <div className="container mx-auto p-2 sm:p-4 min-h-screen">
              <nav className="text-center mb-6 sm:mb-10 p-2 sm:p-4 bg-purple-200 rounded-lg shadow-md">
                <div className="flex flex-col sm:flex-row justify-center items-center space-y-2 sm:space-y-0 sm:space-x-2 md:space-x-4">
                    <button 
                        onClick={() => setActiveCalculator('comprehensive')}
                        className={`${navButtonBaseClass} ${activeCalculator === 'comprehensive' ? activeNavButtonClass : inactiveNavButtonClass}`}
                    >
                        <Sparkles className="inline-block w-4 h-4 sm:w-5 sm:h-5 mr-2" /> 綜合命理解析
                    </button>
                    <button 
                        onClick={() => setActiveCalculator('birth')}
                        className={`${navButtonBaseClass} ${activeCalculator === 'birth' ? activeNavButtonClass : inactiveNavButtonClass}`}
                    >
                        <User className="inline-block w-4 h-4 sm:w-5 sm:h-5 mr-2" /> 個體生命藍圖
                    </button>
                    <button 
                        onClick={() => setActiveCalculator('compatibility')}
                        className={`${navButtonBaseClass} ${activeCalculator === 'compatibility' ? activeNavButtonClass : inactiveNavButtonClass}`}
                    >
                        <HeartIcon className="inline-block w-4 h-4 sm:w-5 sm:h-5 mr-2" /> 雙人合盤解析
                    </button>
                    <button 
                        onClick={() => setActiveCalculator('fortune')}
                        className={`${navButtonBaseClass} ${activeCalculator === 'fortune' ? activeNavButtonClass : inactiveNavButtonClass}`}
                    >
                        <ClockIcon className="inline-block w-4 h-4 sm:w-5 sm:h-5 mr-2" /> 流年運勢分析
                    </button>
                </div>
              </nav>

              <div className="animate-fade-in">
                  {activeCalculator === 'comprehensive' && <ComprehensiveTarotSession />}
                  {activeCalculator === 'birth' && <TarotBirthCardsCalculator />}
                  {activeCalculator === 'compatibility' && <TarotCompatibilitySystem />}
                  {activeCalculator === 'fortune' && <FortuneCardCalculator />}
              </div>
              
              <footer className="text-center text-gray-500 mt-12 pb-6 text-xs sm:text-sm">
                塔羅靈數啟迪工具 © {new Date().getFullYear()} 探索自我，深化連結，洞悉運勢。
              </footer>
            </div>
          );
        };
        
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
    <script>
        // Global error handler to catch any uncaught errors
        window.addEventListener('error', (event) => {
            console.error('Global error caught:', event.error);
            const errorContainer = document.getElementById('root');
            if(errorContainer) {
                errorContainer.innerHTML = `<div style="padding: 2rem; text-align: center; background-color: #fdd; border: 1px solid #f00; border-radius: 8px; margin: 2rem;">
                    <h2 style="color: #c00; font-size: 1.5rem;">應用程式發生錯誤</h2>
                    <p style="margin-top: 1rem;">很抱歉，程式出現了一些問題，請嘗試刷新頁面。</p>
                    <p style="margin-top: 0.5rem; font-family: monospace; font-size: 0.8rem; color: #555;">錯誤訊息: ${event.error.message}</p>
                </div>`;
            }
        });
    </script>
</body>
</html>
```
